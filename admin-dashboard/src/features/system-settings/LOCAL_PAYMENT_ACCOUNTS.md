# ูุธุงู ุงูุฏูุน ุงููุญูู - Frontend Documentation

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุฏูุซ ูุธุงู ุฅุฏุงุฑุฉ ุงูุญุณุงุจุงุช ุงููุญููุฉ ูู ููุญุฉ ุงูุชุญูู ูุฏุนู ุฅุฏุงุฑุฉ ุญุณุงุจุงุช ุงูุฏูุน ุงููุญููุฉ (ุงูุจููู ูุงููุญุงูุธ) ุจุดูู ูุงูู.

## ๐๏ธ ุงููููุงุช ุงููุนุฏูุฉ/ุงููุถุงูุฉ

### 1. API (`api/systemSettingsApi.ts`)

#### ุงูุฃููุงุน ุงููุถุงูุฉ:

```typescript
// ุญุณุงุจ ุฏูุน ูุญูู
export interface LocalPaymentAccount {
  _id: string;
  providerName: string;
  iconUrl?: string;
  accountNumber: string;
  type: 'bank' | 'wallet';
  currency: 'YER' | 'SAR' | 'USD';
  isActive: boolean;
  notes?: string;
  displayOrder: number;
  updatedBy?: string;
  createdAt?: Date;
  updatedAt?: Date;
}

// ุญุณุงุจ ูุฌูุน (ูุฌูุนุฉ ุญุณุจ providerName)
export interface GroupedPaymentAccount {
  providerName: string;
  iconUrl?: string;
  type: 'bank' | 'wallet';
  accounts: Array<{
    id: string;
    accountNumber: string;
    currency: 'YER' | 'SAR' | 'USD';
    isActive: boolean;
    displayOrder: number;
  }>;
}
```

#### API Functions:

```typescript
localPaymentAccountsApi = {
  // ุฌูุจ ุฌููุน ุงูุญุณุงุจุงุช (ููุตูุฉ)
  getAllAccounts(activeOnly?: boolean): Promise<LocalPaymentAccount[]>

  // ุฌูุจ ุงูุญุณุงุจุงุช ูุฌูุนุฉ ุญุณุจ providerName
  getGroupedAccounts(activeOnly?: boolean): Promise<GroupedPaymentAccount[]>

  // ุฌูุจ ุงูุญุณุงุจุงุช ุงูุนุงูุฉ ููุนููุงุก
  getPublicAccounts(currency?: string): Promise<GroupedPaymentAccount[]>

  // ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ
  createAccount(data: CreatePaymentAccountDto): Promise<LocalPaymentAccount>

  // ุชุญุฏูุซ ุญุณุงุจ ููุฌูุฏ
  updateAccount(id: string, data: UpdatePaymentAccountDto): Promise<LocalPaymentAccount>

  // ุญุฐู ุญุณุงุจ
  deleteAccount(id: string): Promise<void>
}
```

### 2. SystemSettingsPage (`pages/SystemSettingsPage.tsx`)

#### Tab ุฌุฏูุฏ: "ุญุณุงุจุงุช ุงูุฏูุน ุงููุญููุฉ"

**ุงูููุฒุงุช:**
- ุฌุฏูู ูุนุฑุถ ุงูุญุณุงุจุงุช ูุฌูุนุฉ ุญุณุจ ุงุณู ุงูุจูู
- ุนุฑุถ ุงูุฃููููุงุช ุฅุฐุง ูุงูุช ูุชููุฑุฉ
- ุนุฑุถ ุฌููุน ุงูุญุณุงุจุงุช ููู ุจูู ูุน:
  - ุงูุนููุฉ (Chip ูููู)
  - ุฑูู ุงูุญุณุงุจ
  - ุญุงูุฉ ุงูุชูุนูู
- ุฃุฒุฑุงุฑ ุชุญุฑูุฑ ูุญุฐู ููู ุญุณุงุจ

**Dialog ูุฅุถุงูุฉ/ุชุนุฏูู ุงูุญุณุงุจุงุช:**
- ุงุณู ุงูุจูู/ุงููุญูุธุฉ (ูุทููุจ)
- ุฑุงุจุท ุงูุฃููููุฉ (ุงุฎุชูุงุฑู)
- ุงูููุน: ุจูู/ูุญูุธุฉ
- ุฑูู ุงูุญุณุงุจ (ูุทููุจ)
- ุงูุนููุฉ: YER/SAR/USD
- ุชุฑุชูุจ ุงูุนุฑุถ
- ููุงุญุธุงุช (ุงุฎุชูุงุฑู)
- ุญุงูุฉ ุงูุชูุนูู (Switch)

## ๐จ UI Components

### ุงูุฌุฏูู
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุงุณู ุงูุจูู    โ ุงูููุน  โ ุงูุญุณุงุจุงุช          โ ุงูุฅุฌุฑุงุกุงุช    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุงููุฑููู ๐ฆ  โ ุจูู    โ YER: 1234567890   โ โ๏ธ ๐๏ธ       โ
โ              โ        โ SAR: 9876543210   โ              โ
โ              โ        โ USD: 5555555555   โ              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Dialog ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู
- ูููุฐุฌ ููุธู ูุน ุฌููุน ุงูุญููู
- Validation: ุงุณู ุงูุจูู ูุฑูู ุงูุญุณุงุจ ูุทููุจุงู
- Switch ูุชูุนูู/ุชุนุทูู ุงูุญุณุงุจ

## ๐ State Management

```typescript
// State ููุจูุงูุงุช
const [paymentAccounts, setPaymentAccounts] = useState<GroupedPaymentAccount[]>([]);
const [allAccounts, setAllAccounts] = useState<LocalPaymentAccount[]>([]);

// State ููู Dialog
const [accountDialogOpen, setAccountDialogOpen] = useState(false);
const [editingAccount, setEditingAccount] = useState<LocalPaymentAccount | null>(null);

// State ููู Form
const [accountForm, setAccountForm] = useState<CreatePaymentAccountDto>({...});
```

## ๐ก API Calls

### ุฌูุจ ุงูุญุณุงุจุงุช
```typescript
const fetchPaymentAccounts = async () => {
  const [grouped, all] = await Promise.all([
    localPaymentAccountsApi.getGroupedAccounts(),
    localPaymentAccountsApi.getAllAccounts(),
  ]);
  setPaymentAccounts(grouped);
  setAllAccounts(all);
};
```

### ุฅูุดุงุก/ุชุญุฏูุซ ุญุณุงุจ
```typescript
const handleSaveAccount = async () => {
  if (editingAccount) {
    await localPaymentAccountsApi.updateAccount(editingAccount._id, accountForm);
  } else {
    await localPaymentAccountsApi.createAccount(accountForm);
  }
  fetchPaymentAccounts(); // Refresh
};
```

## ๐ฏ Use Cases

### Use Case 1: ุฅุถุงูุฉ ุจูู ุฌุฏูุฏ
1. ุงูุงูุชูุงู ุฅูู: ุงูุฅุนุฏุงุฏุงุช > ุญุณุงุจุงุช ุงูุฏูุน ุงููุญููุฉ
2. ุงูุถุบุท ุนูู "ุฅุถุงูุฉ ุญุณุงุจ"
3. ููุก ุงูุจูุงูุงุช:
   - ุงุณู ุงูุจูู: "ุงููุฑููู"
   - ุฑูู ุงูุญุณุงุจ: "1234567890"
   - ุงูุนููุฉ: "YER"
   - ุงูููุน: "ุจูู"
4. ุญูุธ

### Use Case 2: ุฅุถุงูุฉ ุญุณุงุจ ุฅุถุงูู ูููุณ ุงูุจูู
1. ููุณ ุงูุฎุทูุงุช ุฃุนูุงู
2. ุงุณุชุฎุฏุงู ููุณ `providerName` (ุงููุฑููู)
3. ุงุฎุชูุงุฑ ุนููุฉ ูุฎุชููุฉ (ูุซู SAR)
4. ุณูุชู ุนุฑุถู ูุน ุงูุญุณุงุจุงุช ุงูุฃุฎุฑู ููุจูู ููุณู

### Use Case 3: ุชุนุฏูู ุญุณุงุจ
1. ุงูุถุบุท ุนูู ุฒุฑ ุงูุชุญุฑูุฑ ุจุฌุงูุจ ุงูุญุณุงุจ
2. ุชุนุฏูู ุงูุจูุงูุงุช
3. ุญูุธ

### Use Case 4: ุญุฐู ุญุณุงุจ
1. ุงูุถุบุท ุนูู ุฒุฑ ุงูุญุฐู
2. ุชุฃููุฏ ุงูุญุฐู
3. ูุชู ุงูุญุฐู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐ Orders Module Updates

### 1. Types (`orders/types/order.types.ts`)

**ุงูุญููู ุงููุถุงูุฉ ุฅูู Order:**
```typescript
// Local Payment
localPaymentAccountId?: string;
paymentReference?: string;
verifiedPaymentAmount?: number;
verifiedPaymentCurrency?: string;
paymentVerifiedAt?: Date;
paymentVerifiedBy?: string;
paymentVerificationNotes?: string;
```

**Type ุฌุฏูุฏ:**
```typescript
export interface VerifyPaymentDto {
  verifiedAmount: number;
  verifiedCurrency: 'YER' | 'SAR' | 'USD';
  notes?: string;
}
```

### 2. API (`orders/api/ordersApi.ts`)

**Function ุฌุฏูุฏ:**
```typescript
verifyPayment(id: string, data: VerifyPaymentDto): Promise<Order>
```

### 3. Hooks (`orders/hooks/useOrders.ts`)

**Hook ุฌุฏูุฏ:**
```typescript
export const useVerifyPayment = () => {
  // Mutation ูููุทุงุจูุฉ
  // ุฑุณุงูุฉ ูุฌุงุญ/ูุดู ุจูุงุกู ุนูู paymentStatus
  // ุชุญุฏูุซ ุชููุงุฆู ููุจูุงูุงุช
}
```

### 4. OrderDetailsPage (`orders/pages/OrderDetailsPage.tsx`)

#### ูุณู "ูุนูููุงุช ุงูุฏูุน ุงููุญูู"

**ูุธูุฑ ููุท ุฅุฐุง:**
- `paymentMethod === BANK_TRANSFER`
- `localPaymentAccountId` ููุฌูุฏ

**ูุนุฑุถ:**
- ุฑูู ุงูุญูุงูุฉ/ุงููุฑุฌุน
- ูุนูููุงุช ุงููุทุงุจูุฉ (ุฅุฐุง ุชูุช):
  - ุงููุจูุบ ุงููุทุงุจู
  - ุงูุนููุฉ ุงููุทุงุจูุฉ
  - ุชุงุฑูุฎ ุงููุทุงุจูุฉ
  - ููุงุญุธุงุช ุงููุทุงุจูุฉ
- ุญุงูุฉ ุงููุจูู/ุงูุฑูุถ:
  - Alert ุฃุฎุถุฑ: "ุชู ูุจูู ุงูุฏูุน - ุงููุจูุบ ูุงูู"
  - Alert ุฃุญูุฑ: "ุชู ุฑูุถ ุงูุฏูุน - ุงููุจูุบ ุบูุฑ ูุงูู"
- Alert ุชุญุฐูุฑู: "ูู ุงูุชุธุงุฑ ูุฑุงุฌุนุฉ ููุทุงุจูุฉ ุงูุฏูุน"

#### ุฒุฑ "ูุทุงุจูุฉ ุงูุฏูุน"

**ูุธูุฑ ููุท ุฅุฐุง:**
- `paymentStatus === PENDING`

**ุนูุฏ ุงูุถุบุท:**
- ููุชุญ Dialog ุงููุทุงุจูุฉ

#### Dialog ุงููุทุงุจูุฉ

**ุงูุญููู:**
1. **ุงููุจูุบ ุงููุทุงุจู** (number, required)
   - Input type: number
   - Step: 0.01
   - Min: 0

2. **ุงูุนููุฉ** (select, required)
   - Options: YER, SAR, USD

3. **ููุงุญุธุงุช** (text, optional)
   - Multiline
   - 3 rows

**ุงูููุฒุงุช:**
- ูุนุฑุถ ุงููุจูุบ ุงููุทููุจ ูู Alert
- ุชูุจูู ููุฑู ุฃุซูุงุก ุงูุฅุฏุฎุงู:
  - ุฅุฐุง ุงููุจูุบ >= ุงููุทููุจ โ Alert ุฃุฎุถุฑ: "ุงููุจูุบ ูุงูู - ุณูุชู ูุจูู ุงูุฏูุน"
  - ุฅุฐุง ุงููุจูุบ < ุงููุทููุจ โ Alert ุฃุตูุฑ: "ุงููุจูุบ ุบูุฑ ูุงูู - ุณูุชู ุฑูุถ ุงูุฏูุน (ููุต: X)"
- ุฒุฑ "ูุทุงุจูุฉ" ูุนุทูู ุฅุฐุง ูู ูุชู ุฅุฏุฎุงู ูุจูุบ

**ุนูุฏ ุงูุญูุธ:**
- ูุชู ุงุณุชุฏุนุงุก `verifyPayment` API
- ูุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุชููุงุฆูุงู
- ูุชู ุฅุบูุงู Dialog
- ูุชู ุชุญุฏูุซ ุงูุจูุงูุงุช

## ๐ Complete Flow Example

### Scenario: ุทูุจ ุฌุฏูุฏ ูุน ุฏูุน ูุญูู

1. **ุงูุนููู ูุฎุชุงุฑ ุงูุฏูุน ุงููุญูู:**
   - ูุฎุชุงุฑ "ุงููุฑููู" > ุญุณุงุจ YER
   - ูุฏุฎู ุฑูู ุงูุญูุงูุฉ: "REF123456"

2. **ุงูุทูุจ ูุตู ูููุญุฉ ุงูุชุญูู:**
   - ุงูุญุงูุฉ: `PENDING_PAYMENT`
   - ุญุงูุฉ ุงูุฏูุน: `PENDING`
   - ูุธูุฑ ูุณู "ูุนูููุงุช ุงูุฏูุน ุงููุญูู"
   - ูุธูุฑ ุฒุฑ "ูุทุงุจูุฉ ุงูุฏูุน"

3. **ุงูุฅุฏุงุฑุฉ ุชุฑุงุฌุน:**
   - ุชูุชุญ ุงูุทูุจ
   - ุชุฑู ุฑูู ุงูุญูุงูุฉ: "REF123456"
   - ุชูุชุญ Dialog ุงููุทุงุจูุฉ

4. **ุงูุฅุฏุงุฑุฉ ุชุทุงุจู:**
   - ุชุฏุฎู ุงููุจูุบ: 50000
   - ุงูุนููุฉ: YER
   - ููุงุญุธุงุช: "ุชู ุงูุชุญูู ูู ุงูุญูุงูุฉ"

5. **ุงููุธุงู ูุชุฎุฐ ุงููุฑุงุฑ:**
   - ููุงุฑู: 50000 >= 45000 (ูุซุงู)
   - ุงููุชูุฌุฉ: ูุจูู
   - ุงูุชุญุฏูุซุงุช:
     - `paymentStatus`: `PAID`
     - `status`: `CONFIRMED`
     - `verifiedPaymentAmount`: 50000
     - `paymentVerifiedAt`: ุงูุขู
     - Alert ุฃุฎุถุฑ: "ุชู ูุจูู ุงูุฏูุน ุจูุฌุงุญ"

6. **ุงููุชูุฌุฉ:**
   - ุงูุทูุจ ุฃุตุจุญ `CONFIRMED`
   - ุงูุฏูุน `PAID`
   - ุฌุงูุฒ ูููุนุงูุฌุฉ

## ๐จ UI Screenshots (Description)

### ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุญุณุงุจุงุช
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ุญุณุงุจุงุช ุงูุฏูุน ุงููุญููุฉ          [ุฅุถุงูุฉ ุญุณุงุจ]        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุงููุฑููู ๐ฆ                                          โ
โ   ููุน: ุจูู                                          โ
โ   ุงูุญุณุงุจุงุช:                                         โ
โ   โข YER: 1234567890        [โ๏ธ] [๐๏ธ]              โ
โ   โข SAR: 9876543210        [โ๏ธ] [๐๏ธ]              โ
โ   โข USD: 5555555555        [โ๏ธ] [๐๏ธ]              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Dialog ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ุฅุถุงูุฉ ุญุณุงุจ ุฌุฏูุฏ                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ุงุณู ุงูุจูู/ุงููุญูุธุฉ: [________]    โ
โ  ุฑุงุจุท ุงูุฃููููุฉ: [________]        โ
โ  ุงูููุน: [ุจูู โผ]                   โ
โ  ุฑูู ุงูุญุณุงุจ: [________]           โ
โ  ุงูุนููุฉ: [YER โผ]                  โ
โ  ุชุฑุชูุจ ุงูุนุฑุถ: [0]                 โ
โ  ููุงุญุธุงุช: [________]              โ
โ                                    โ
โ  โ ุงูุญุณุงุจ ููุนู                     โ
โ                                    โ
โ  [ุฅูุบุงุก]  [ุฅุถุงูุฉ]                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุตูุญุฉ ุชูุงุตูู ุงูุทูุจ - ูุณู ุงูุฏูุน ุงููุญูู
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ูุนูููุงุช ุงูุฏูุน ุงููุญูู    [ูุทุงุจูุฉ ุงูุฏูุน]       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ุฑูู ุงูุญูุงูุฉ / ุงููุฑุฌุน: REF123456               โ
โ                                                 โ
โ  โ๏ธ ูู ุงูุชุธุงุฑ ูุฑุงุฌุนุฉ ููุทุงุจูุฉ ุงูุฏูุน            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Dialog ุงููุทุงุจูุฉ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ูุทุงุจูุฉ ุงูุฏูุน ุงููุญูู               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โน๏ธ ุงููุจูุบ ุงููุทููุจ: 45,000 YER    โ
โ                                    โ
โ  ุงููุจูุบ ุงููุทุงุจู: [50000]          โ
โ  ุงูุนููุฉ: [YER โผ]                  โ
โ  ููุงุญุธุงุช: [________]              โ
โ                                    โ
โ  โ ุงููุจูุบ ูุงูู - ุณูุชู ูุจูู ุงูุฏูุน โ
โ                                    โ
โ  [ุฅูุบุงุก]  [ูุทุงุจูุฉ]                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ง Configuration

ูุง ูุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ. ุงููุธุงู ูุนูู ูุจุงุดุฑุฉ ุจุนุฏ ุงูุชุญุฏูุซุงุช.

## ๐ Notes

1. **ุงูุญุณุงุจุงุช ุงููุฌูุนุฉ:** ูุชู ุงูุฌูุน ุนูู ูุณุชูู Backendุ Frontend ูุนุฑุถ ุงูุจูุงูุงุช ููุง ูู.

2. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู:** ุจุนุฏ ุฃู ุนูููุฉ (ุฅูุดุงุก/ุชุญุฏูุซ/ุญุฐู)ุ ูุชู ุฅุนุงุฏุฉ ุฌูุจ ุงูุจูุงูุงุช ุชููุงุฆูุงู.

3. **ุงูุชุญุฑูุฑ:** ููุชุญุฑูุฑุ ูุญุชุงุฌ ุงูุญุณุงุจ ุงููุงูู (ูู `allAccounts`)ุ ูุฐูู ูุชู ุฌูุจ `grouped` ู `all` ูุนุงู.

4. **ุงูุฃูุงู:** ุฌููุน endpoints ุชุชุทูุจ Admin authentication.

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2024  
**ุขุฎุฑ ุชุญุฏูุซ:** 2024

