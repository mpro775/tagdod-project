# وحدة الإشعارات (Notifications Module)

## نظرة عامة
وحدة الإشعارات مسؤولة عن إدارة جميع أنواع الإشعارات في نظام Tagadodo. تتيح هذه الوحدة إرسال وإدارة الإشعارات للمستخدمين عبر قنوات متعددة مثل الإشعارات داخل التطبيق، البريد الإلكتروني، والرسائل النصية.

## المكونات الرئيسية
- **خدمات الإشعارات**: مسؤولة عن إنشاء وإرسال وتتبع الإشعارات
- **وحدات التحكم**: توفر واجهات API لإدارة الإشعارات
- **نماذج البيانات (DTOs)**: تحدد هيكل بيانات الإشعارات
- **القوالب**: قوالب للإشعارات المختلفة

## أنواع الإشعارات
- إشعارات النظام
- إشعارات الطلبات
- إشعارات المنتجات
- إشعارات العروض والخصومات
- إشعارات المستخدم

## تفاصيل العمليات

### 1. إنشاء الإشعارات
تبدأ عملية الإشعارات عندما يحدث حدث معين في النظام (مثل إكمال طلب، تغيير حالة طلب، إضافة منتج جديد). يتم استدعاء خدمة الإشعارات مع المعلومات اللازمة لإنشاء الإشعار:
- نوع الإشعار
- المستلم/المستلمين
- البيانات المتعلقة بالإشعار
- مستوى الأولوية

### 2. معالجة الإشعارات
بعد إنشاء الإشعار، تقوم وحدة المعالجة بما يلي:
- تحديد قنوات الإرسال المناسبة (تطبيق، بريد إلكتروني، رسائل نصية)
- تجهيز محتوى الإشعار باستخدام القوالب المناسبة
- تطبيق قواعد التصفية والتخصيص حسب إعدادات المستخدم
- جدولة الإشعارات حسب الأولوية والتوقيت المناسب

### 3. إرسال الإشعارات
تتم عملية الإرسال عبر مزودي خدمات مختلفين:
- **إشعارات التطبيق**: تُخزن في قاعدة البيانات وتُعرض للمستخدم عند تسجيل الدخول
- **البريد الإلكتروني**: يتم إرسالها عبر خدمة SMTP
- **الرسائل النصية**: تُرسل عبر مزود خدمة SMS

### 4. تتبع وتحليل الإشعارات
يتم تتبع حالة كل إشعار:
- تم الإرسال
- تم التسليم
- تم الفتح/القراءة
- تم التفاعل معه

### 5. إدارة تفضيلات الإشعارات
يمكن للمستخدمين إدارة تفضيلات الإشعارات الخاصة بهم:
- تفعيل/تعطيل أنواع معينة من الإشعارات
- اختيار قنوات الإشعار المفضلة
- تحديد أوقات استلام الإشعارات

## التكامل
تتكامل وحدة الإشعارات مع وحدات أخرى في النظام مثل وحدة المستخدمين، الطلبات، والمنتجات لإرسال إشعارات مخصصة بناءً على أحداث محددة.

## الاستخدام
يمكن استخدام هذه الوحدة من خلال حقن خدمة الإشعارات في الوحدات الأخرى واستدعاء الدوال المناسبة لإرسال الإشعارات.

### مثال على استخدام خدمة الإشعارات

```typescript
// في وحدة الطلبات
import { NotificationsService } from '../notifications/notifications.service';

@Injectable()
export class OrdersService {
  constructor(private notificationsService: NotificationsService) {}

  async updateOrderStatus(orderId: string, status: OrderStatus): Promise<Order> {
    // تحديث حالة الطلب
    const order = await this.orderRepository.updateStatus(orderId, status);
    
    // إرسال إشعار للمستخدم
    await this.notificationsService.sendNotification({
      type: NotificationType.ORDER_STATUS_CHANGE,
      recipient: order.userId,
      data: {
        orderId: order.id,
        newStatus: status,
        orderNumber: order.orderNumber
      },
      priority: NotificationPriority.HIGH
    });
    
    return order;
  }
}
