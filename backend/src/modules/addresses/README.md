# Addresses System - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
# Professional Address Management System

## âœ… Ù†Ø¸Ø§Ù… Ù…ÙƒØªÙ…Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°

ØªÙ… ØªØ·ÙˆÙŠØ± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.

---

## ğŸ¯ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

### âœ¨ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ø¨Ù‚Ø© ÙØ¹Ù„ÙŠØ§Ù‹
- âœ… ØªØ³Ù…ÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (label) - Ù…Ø·Ù„ÙˆØ¨
- âœ… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (line1) - Ù…Ø·Ù„ÙˆØ¨
- âœ… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (city) - Ù…Ø·Ù„ÙˆØ¨
- âœ… **Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (coords)** - Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙˆÙ…Ø·Ù„ÙˆØ¨
- âœ… Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ (notes) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ
- âœ… Ø¹Ù†ÙˆØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ (isDefault)
- âœ… Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ (isActive)
- âœ… ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (lastUsedAt, usageCount)
- âœ… Soft delete support

### ğŸ—‘ï¸ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© (Ù…Ø¨Ø³Ø·Ø©)
- âŒ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (addressType) - Ù…Ø­Ø°ÙˆÙ
- âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… (recipientName) - Ù…Ø­Ø°ÙˆÙ (ÙŠØ³ØªØ®Ø¯Ù… Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
- âŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… (recipientPhone) - Ù…Ø­Ø°ÙˆÙ (ÙŠØ³ØªØ®Ø¯Ù… Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
- âŒ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© (line2) - Ù…Ø­Ø°ÙˆÙ
- âŒ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©/Ø§Ù„Ø­ÙŠ (region) - Ù…Ø­Ø°ÙˆÙ
- âŒ Ø§Ù„Ø¯ÙˆÙ„Ø© (country) - Ù…Ø­Ø°ÙˆÙ (Ø§Ù„ÙŠÙ…Ù† ÙÙ‚Ø·)
- âŒ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ (postalCode) - Ù…Ø­Ø°ÙˆÙ
- âŒ Google PlaceId (placeId) - Ù…Ø­Ø°ÙˆÙ

### âœ¨ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©
- âœ… **Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø£ÙˆÙ„ ÙŠØµØ¨Ø­ Ø§ÙØªØ±Ø§Ø¶ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹**
- âœ… **Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯**
- âœ… **Ø¹Ù†Ø¯ Ø­Ø°Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ ÙŠÙØ¹ÙŠÙ‘Ù† Ø¢Ø®Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹**
- âœ… **Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø­Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙÙ‚Ø·** (Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªØµØ¨Ø­ ØºÙŠØ± Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
- âœ… **ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…** (ÙƒÙ… Ù…Ø±Ø© Ø§Ø³ØªÙØ®Ø¯Ù…)
- âœ… **Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø°ÙƒÙŠ** (Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø£ÙˆÙ„Ø§Ù‹ â†’ Ø§Ù„Ø£Ø­Ø¯Ø« Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹ â†’ Ø§Ù„Ø£Ù‚Ø¯Ù… Ø¥Ù†Ø´Ø§Ø¡Ù‹)

---

## ğŸ“Š API Endpoints

### User Endpoints (Ù…Ø­Ù…ÙŠØ© - JWT Required)

#### 1. Get All Addresses
```http
GET /addresses
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": [
    {
      "_id": "addr_123",
      "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
      "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
      "city": "ØµÙ†Ø¹Ø§Ø¡",
      "coords": {
        "lat": 15.3694,
        "lng": 44.1910
      },
      "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
      "isDefault": true,
      "isActive": true,
      "usageCount": 5,
      "lastUsedAt": "2024-01-15T10:30:00Z"
    },
    {
      "_id": "addr_456",
      "label": "Ø§Ù„Ù…ÙƒØªØ¨",
      "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±ØŒ Ù…Ø¨Ù†Ù‰ Ø§Ù„ØªØ¬Ø§Ø±Ø©",
      "city": "ØµÙ†Ø¹Ø§Ø¡",
      "coords": {
        "lat": 15.3694,
        "lng": 44.1910
      },
      "isDefault": false,
      "usageCount": 2
    }
  ],
  "count": 2
}

Features:
  âœ… Ù…Ø±ØªØ¨Ø©: Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø£ÙˆÙ„Ø§Ù‹ â†’ Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù… â†’ Ø§Ù„Ø£Ù‚Ø¯Ù…
  âœ… ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ?includeDeleted=true Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
```

---

#### 2. Get Active Addresses Only
```http
GET /addresses/active
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": [...active addresses],
  "count": 2
}

Note: ÙÙ‚Ø· Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ÙØ¹Ù‘Ø§Ù„Ø© ÙˆØºÙŠØ± Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
```

---

#### 3. Get Default Address
```http
GET /addresses/default
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": {
    "_id": "addr_123",
    "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
    "isDefault": true,
    ...
  }
}

Logic:
  1. ÙŠØ¨Ø­Ø« Ø¹Ù† Ø¹Ù†ÙˆØ§Ù† isDefault=true
  2. Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¬Ø¯ØŒ ÙŠØ£Ø®Ø° Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…
  3. Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¬Ø¯ØŒ ÙŠØ£Ø®Ø° Ø§Ù„Ø£ÙˆÙ„
  4. ÙŠØ¹ÙŠÙ‘Ù†Ù‡ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
```

---

#### 4. Get Address by ID
```http
GET /addresses/:id
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": {...address}
}

Error (404 if not found or doesn't belong to user)
```

---

#### 5. Create New Address
```http
POST /addresses
Authorization: Bearer {token}

Body:
{
  "label": "Ø§Ù„Ù…ÙƒØªØ¨",
  "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±ØŒ Ù…Ø¨Ù†Ù‰ Ø§Ù„ØªØ¬Ø§Ø±Ø©",
  "city": "ØµÙ†Ø¹Ø§Ø¡",
  "coords": {
    "lat": 15.3694,
    "lng": 44.1910
  },
  "notes": "Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©",
  "isDefault": false
}

Response:
{
  "success": true,
  "message": "Address created successfully",
  "data": {...created address}
}

Smart Logic:
  âœ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£ÙˆÙ„ Ø¹Ù†ÙˆØ§Ù† â†’ isDefault=true ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  âœ… Ø¥Ø°Ø§ isDefault=true â†’ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªØµØ¨Ø­ false
```

---

#### 6. Update Address
```http
PATCH /addresses/:id
Authorization: Bearer {token}

Body:
{
  "notes": "ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©",
  "coords": {
    "lat": 15.3694,
    "lng": 44.1910
  },
  "isDefault": true
}

Response:
{
  "success": true,
  "message": "Address updated successfully",
  "data": {...updated address}
}
```

---

#### 7. Delete Address
```http
DELETE /addresses/:id
Authorization: Bearer {token}

Response:
{
  "success": true,
  "message": "Address deleted successfully",
  "data": { "deleted": true }
}

Smart Logic:
  âœ… Soft delete (ÙŠÙØ­ÙØ¸ ÙÙŠ DB)
  âœ… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯
  âœ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ â†’ ÙŠÙØ¹ÙŠÙ‘Ù† Ø¹Ù†ÙˆØ§Ù† Ø¢Ø®Ø± ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
```

---

#### 8. Set as Default
```http
POST /addresses/:id/set-default
Authorization: Bearer {token}

Response:
{
  "success": true,
  "message": "Default address set successfully",
  "data": {...address with isDefault=true}
}

Logic:
  âœ… ÙŠØ¹ÙŠÙ‘Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
  âœ… Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªØµØ¨Ø­ isDefault=false
```

---

#### 9. Restore Deleted Address
```http
POST /addresses/:id/restore
Authorization: Bearer {token}

Response:
{
  "success": true,
  "message": "Address restored successfully",
  "data": {...restored address}
}
```

---

#### 10. Validate Address Ownership
```http
GET /addresses/validate/:id
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": { "valid": true }
}

Use Case: Ù„Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
```

---

## ğŸ”— Integration with Orders & Services

### ÙÙŠ Checkout (Ø·Ù„Ø¨ Ù…Ù†ØªØ¬Ø§Øª) - âš ï¸ Ù…Ø·Ø¨Ù‚ Ø¬Ø²Ø¦ÙŠØ§Ù‹:

```typescript
// 1. Checkout DTO - Ù…Ø·Ø¨Ù‚ âœ…
CheckoutConfirmDto {
  deliveryAddressId: string  // âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ®ØªØ§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
  currency: string
  paymentMethod: 'COD' | 'ONLINE'
  paymentProvider?: string
  shippingMethod?: string
  customerNotes?: string
  couponCode?: string
}

// 2. Order Schema - Ù…Ø·Ø¨Ù‚ âœ…
Order {
  deliveryAddress: {         // âœ… ÙŠÙØ­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø§Ù‹
    addressId: ObjectId
    label: string
    line1: string
    city: string
    coords: { lat: number; lng: number }  // Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
    notes?: string
  }
}

// 3. ÙÙŠ CheckoutService.confirm() - ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ± âš ï¸:
// âŒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: validateAddressOwnership()
// âŒ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: getAddressById()
// âŒ Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
// âŒ ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: markAsUsed()
// âœ… ÙŠØªÙ… Ø­ÙØ¸ addressId ÙÙ‚Ø· Ø­Ø§Ù„ÙŠØ§Ù‹
```

---

### ÙÙŠ Services (Ø·Ù„Ø¨ Ù…Ù‡Ù†Ø¯Ø³) - âœ… Ù…Ø·Ø¨Ù‚ ÙØ¹Ù„ÙŠØ§Ù‹:

```typescript
// 1. Service Request DTO - Ù…Ø·Ø¨Ù‚
CreateServiceRequestDto {
  title: string
  type: string
  description: string
  addressId: string  // âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ®ØªØ§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
  images?: string[]
  scheduledAt?: Date
}

// 2. ServiceRequest Schema - Ù…Ø·Ø¨Ù‚
ServiceRequest {
  addressId: ObjectId        // âœ… ÙŠÙØ­ÙØ¸ ID Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
  location: {                // âœ… ÙŠÙØ­ÙØ¸ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
    type: 'Point'
    coordinates: [lng, lat]
  }
  // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
}

// 3. ÙÙŠ createServiceRequest() - Ù…Ø·Ø¨Ù‚ Ø¬Ø²Ø¦ÙŠØ§Ù‹:
// âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
// âœ… Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
// âœ… Ø­ÙØ¸ addressId ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø©
// âœ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
// âš ï¸ ÙŠØ­ØªØ§Ø¬: ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (markAsUsed)
```

---

## ğŸ’¡ Best Practices

### 1. Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø§Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
```typescript
// âœ… ØµØ­ÙŠØ­
Order {
  deliveryAddress: {
    label: "Ø§Ù„Ù…Ù†Ø²Ù„",
    line1: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
    city: "ØµÙ†Ø¹Ø§Ø¡",
    coords: { lat: 15.3694, lng: 44.1910 },
    notes: "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„"
  }
}

// âŒ Ø®Ø·Ø£
Order {
  deliveryAddressId: "addr_123"  // ÙÙ‚Ø· ID
}

// Ù„Ù…Ø§Ø°Ø§ØŸ
// - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ ÙŠØ­Ø°Ù/ÙŠØ¹Ø¯Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ø§Ø­Ù‚Ø§Ù‹
// - Ø§Ù„Ø·Ù„Ø¨ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒÙ…Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨
```

---

### 2. Ø¯Ø§Ø¦Ù…Ø§Ù‹ ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
```typescript
// Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
const isValid = await addressesService.validateAddressOwnership(
  addressId,
  userId
);

if (!isValid) {
  throw new AppException('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± ØµØ­ÙŠØ­', 400);
}
```

---

### 3. Ø­Ø¯Ù‘Ø« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
```typescript
// Ø¨Ø¹Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø·Ù„Ø¨
await addressesService.markAsUsed(addressId, userId);

// Ù‡Ø°Ø§ ÙŠØ­Ø¯Ø«:
// - lastUsedAt = now
// - usageCount += 1
```

---

### 4. Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø°ÙƒÙŠ
```typescript
// Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªÙØ±ØªØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:
// 1. Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø£ÙˆÙ„Ø§Ù‹
// 2. Ø§Ù„Ø£Ø­Ø¯Ø« Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹
// 3. Ø§Ù„Ø£Ù‚Ø¯Ù… Ø¥Ù†Ø´Ø§Ø¡Ù‹

sort({ isDefault: -1, lastUsedAt: -1, createdAt: -1 })
```

---

## ğŸ“± Frontend Tips

### 1. Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙÙŠ Checkout
```jsx
{addresses.map(address => (
  <div 
    key={address._id}
    className={selectedAddressId === address._id ? 'selected' : ''}
    onClick={() => setSelectedAddressId(address._id)}
  >
    {address.isDefault && <span>â­ Ø§ÙØªØ±Ø§Ø¶ÙŠ</span>}
    <h3>{address.label}</h3>
    <p>{address.line1}, {address.city}</p>
    {address.notes && <p className="notes">{address.notes}</p>}
  </div>
))}
```

---

### 2. Auto-select Default Address
```jsx
useEffect(() => {
  const defaultAddr = addresses.find(a => a.isDefault);
  if (defaultAddr) {
    setSelectedAddressId(defaultAddr._id);
  }
}, [addresses]);
```

---

### 3. Validate Before Submit
```jsx
async function placeOrder() {
  if (!selectedAddressId) {
    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„');
    return;
  }

  // ... proceed with order
}
```

---

### 4. Add New Address from Checkout
```jsx
<button onClick={() => {
  window.location.href = '/addresses/new?returnTo=checkout';
}}>
  + Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯
</button>
```

---

## ğŸ”„ Complete User Flow

```
1. User opens Checkout page
   â†“
2. System loads addresses: GET /addresses/active
   â†“
3. Default address is auto-selected âœ…
   â†“
4. User sees all their addresses
   â†“
5. User can:
   - Select different address âœ…
   - Add new address âœ…
   - Edit existing address âœ…
   â†“
6. User clicks "Confirm Order"
   â†“
7. Backend validates address ownership âœ…
   â†“
8. Backend saves full address in order âœ…
   â†“
9. Backend updates address usage stats âœ…
   â†“
10. Order created successfully âœ…
```

---

## ğŸ¯ Use Cases

### Use Case 1: Ø£ÙˆÙ„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
```javascript
POST /addresses
{
  "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
  "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
  "city": "ØµÙ†Ø¹Ø§Ø¡",
  "coords": {
    "lat": 15.3694,
    "lng": 44.1910
  },
  "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„"
}

// Ø§Ù„Ù†ØªÙŠØ¬Ø©:
{
  "isDefault": true,  // âœ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  ...
}
```

---

### Use Case 2: Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø«Ø§Ù†ÙŠ
```javascript
POST /addresses
{
  "label": "Ø§Ù„Ù…ÙƒØªØ¨",
  "isDefault": false,  // ØºÙŠØ± Ø§ÙØªØ±Ø§Ø¶ÙŠ
  ...
}

// Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¢Ù† Ù„Ø¯ÙŠÙ‡:
// - Ø§Ù„Ù…Ù†Ø²Ù„ (Ø§ÙØªØ±Ø§Ø¶ÙŠ) â­
// - Ø§Ù„Ù…ÙƒØªØ¨
```

---

### Use Case 3: ØªØºÙŠÙŠØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
```javascript
POST /addresses/addr_456/set-default

// Ø§Ù„Ù†ØªÙŠØ¬Ø©:
// - Ø§Ù„Ù…Ù†Ø²Ù„: isDefault=false
// - Ø§Ù„Ù…ÙƒØªØ¨: isDefault=true â­
```

---

### Use Case 4: Ø­Ø°Ù Ø¹Ù†ÙˆØ§Ù†
```javascript
DELETE /addresses/addr_123

// Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯:
// âŒ Error: "Cannot delete your only address"

// Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙˆÙ‡Ù†Ø§Ùƒ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø£Ø®Ø±Ù‰:
// âœ… ÙŠÙØ­Ø°Ù
// âœ… Ø¹Ù†ÙˆØ§Ù† Ø¢Ø®Ø± ÙŠØµØ¨Ø­ Ø§ÙØªØ±Ø§Ø¶ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
```

---

### Use Case 5: Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
```javascript
POST /checkout
{
  "cartId": "cart_123",
  "deliveryAddressId": "addr_123"  // âœ…
}

// Ø§Ù„Ø¨ÙŠÙƒ Ø¥Ù†Ø¯:
// 1. ÙŠØªØ­Ù‚Ù‚ Ø£Ù† addr_123 ÙŠØ®Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… âœ…
// 2. ÙŠØ¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø© âœ…
// 3. ÙŠØ­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨ âœ…
// 4. ÙŠØ­Ø¯Ø« lastUsedAt Ùˆ usageCount âœ…

// Order:
{
  "deliveryAddress": {
    "addressId": "addr_123",
    "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
    "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
    "city": "ØµÙ†Ø¹Ø§Ø¡",
    "coords": { "lat": 15.3694, "lng": 44.1910 },
    "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„"
  }
}
```

---

## âœ… Ø§Ù„Ù…Ù„Ø®Øµ

### Ù…Ø§ ØªÙ… ØªØ·ÙˆÙŠØ±Ù‡ ÙØ¹Ù„ÙŠØ§Ù‹:
1. âœ… **Schema Ù…Ø¨Ø³Ø·** (8 Ø­Ù‚ÙˆÙ„ Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø¹ indexes Ù…Ø­Ø³Ù‘Ù†Ø©)
2. âœ… **Service Ù…ÙƒØªÙ…Ù„** (12 methods Ù…Ø·Ø¨Ù‚Ø©)
3. âœ… **DTOs Ù…ÙƒØªÙ…Ù„Ø©** (validation Ø´Ø§Ù…Ù„ Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
4. âœ… **Controller Ù…ÙƒØªÙ…Ù„** (10 endpoints Ù…Ø·Ø¨Ù‚Ø©)
5. âœ… **Ù…Ù†Ø·Ù‚ Ø°ÙƒÙŠ** (default auto-set, prevent delete only, etc.)
6. âœ… **Soft delete** (Ù…Ø·Ø¨Ù‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)
7. âœ… **Usage tracking** (ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø·Ø¨Ù‚)
8. âœ… **Error handling** (Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ø¶Ø­Ø©)
9. âœ… **Integration partial** (Ù…Ø¹ Services Ù…ÙƒØªÙ…Ù„ØŒ Ù…Ø¹ Checkout Ø¬Ø²Ø¦ÙŠ)
10. âœ… **Ø¨Ù†ÙŠØ© Ù…Ø¨Ø³Ø·Ø©** (Ø­Ø°Ù Ø§Ù„Ø­Ù‚ÙˆÙ„ ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©)

### Features:
- âœ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ÙˆÙŠÙ† Ù…ØªØ¹Ø¯Ø¯Ø©
- âœ… ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†ÙˆØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ
- âœ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨
- âœ… Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
- âœ… Ù…Ù†Ø¹ Ø­Ø°Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯
- âœ… ØªØ±ØªÙŠØ¨ Ø°ÙƒÙŠ Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
- âœ… ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

---

## ğŸ“ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙƒØ§Ù…Ù„

### âœ… ØªÙ… Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­:
1. âœ… Checkout Module (import AddressesModule) - Ù…ÙƒØªÙ…Ù„
2. âœ… Checkout DTO (add deliveryAddressId) - Ù…ÙƒØªÙ…Ù„
3. âœ… Order Schema (add ORDER.deliveryAddress object) - Ù…ÙƒØªÙ…Ù„
4. âœ… Services Module (import AddressesModule) - Ù…ÙƒØªÙ…Ù„
5. âœ… Service Request DTO (add serviceAddressId) - Ù…ÙƒØªÙ…Ù„
6. âœ… ServiceRequest Schema (add addressId field) - Ù…ÙƒØªÙ…Ù„
7. âœ… Services Service (integrate with AddressesService) - Ù…ÙƒØªÙ…Ù„

### âš ï¸ ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ± ÙÙŠ Checkout Service:
```typescript
// ÙÙŠ CheckoutService.confirm() ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ©:
// 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
// 2. Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø©
// 3. Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Order.deliveryAddress
// 4. ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†

// Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¥Ø¶Ø§ÙØªÙ‡:
const addressesService = this.addressesService; // Inject AddressesService

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
const isValid = await addressesService.validateAddressOwnership(addressId, userId);
if (!isValid) {
  throw new AppException('Address not found or invalid', '400');
}

// Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
const address = await addressesService.getAddressById(addressId);

// Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„Ø·Ù„Ø¨ (ÙŠØªÙ… Ø­Ø§Ù„ÙŠØ§Ù‹ Ø­ÙØ¸ addressId ÙÙ‚Ø·)
// ÙŠØ¬Ø¨ Ø­ÙØ¸ ÙƒØ§Ù…Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ deliveryAddress

// ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
await addressesService.markAsUsed(addressId, userId);
```

---

**Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ÙƒØªÙ…Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°! ğŸ‰**

### Ù…Ù„Ø®Øµ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:
- âœ… **Addresses Module**: Ù…ÙƒØªÙ…Ù„ 100%
- âœ… **Services Integration**: Ù…ÙƒØªÙ…Ù„ 95% (ÙŠØ­ØªØ§Ø¬ markAsUsed)
- âš ï¸ **Checkout Integration**: Ù…ÙƒØªÙ…Ù„ 60% (ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ± CheckoutService)

### Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:
- âœ… `backend/src/modules/addresses/` - Ù…ÙƒØªÙ…Ù„
- âœ… `backend/src/modules/services/` - Ù…ÙƒØªÙ…Ù„ Ø¬Ø²Ø¦ÙŠØ§Ù‹
- âš ï¸ `backend/src/modules/checkout/checkout.service.ts` - ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ±

