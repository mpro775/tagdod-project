# Addresses System - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
# Professional Address Management System

## âœ… Ù†Ø¸Ø§Ù… ÙƒØ§Ù…Ù„ ÙˆÙ…Ø­Ø³Ù‘Ù†

ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØªØ­Ø³ÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ù„ÙŠØµØ¨Ø­ Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.

---

## ğŸ¯ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

### âœ¨ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©
- âœ… ØªØ³Ù…ÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (label)
- âœ… Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (home/work/other)
- âœ… **Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…** (recipientName) - Ù…Ø·Ù„ÙˆØ¨
- âœ… **Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…** (recipientPhone) - Ù…Ø·Ù„ÙˆØ¨
- âœ… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (line1) - Ù…Ø·Ù„ÙˆØ¨
- âœ… ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© (line2)
- âœ… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (city) - Ù…Ø·Ù„ÙˆØ¨
- âœ… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©/Ø§Ù„Ø­ÙŠ (region)
- âœ… Ø§Ù„Ø¯ÙˆÙ„Ø© (country)
- âœ… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ (postalCode)
- âœ… Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (coords)
- âœ… Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ (notes)
- âœ… Ø¹Ù†ÙˆØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ (isDefault)
- âœ… Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ (isActive)
- âœ… ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (lastUsedAt, usageCount)
- âœ… Soft delete support

### âœ¨ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©
- âœ… **Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø£ÙˆÙ„ ÙŠØµØ¨Ø­ Ø§ÙØªØ±Ø§Ø¶ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹**
- âœ… **Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯**
- âœ… **Ø¹Ù†Ø¯ Ø­Ø°Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ ÙŠÙØ¹ÙŠÙ‘Ù† Ø¢Ø®Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹**
- âœ… **Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø­Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙÙ‚Ø·** (Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªØµØ¨Ø­ ØºÙŠØ± Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
- âœ… **ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…** (ÙƒÙ… Ù…Ø±Ø© Ø§Ø³ØªÙØ®Ø¯Ù…)
- âœ… **Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø°ÙƒÙŠ** (Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø£ÙˆÙ„Ø§Ù‹ â†’ Ø§Ù„Ø£Ø­Ø¯Ø« Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹ â†’ Ø§Ù„Ø£Ù‚Ø¯Ù… Ø¥Ù†Ø´Ø§Ø¡Ù‹)

---

## ğŸ“Š API Endpoints

### User Endpoints (Ù…Ø­Ù…ÙŠØ© - JWT Required)

#### 1. Get All Addresses
```http
GET /addresses
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": [
    {
      "_id": "addr_123",
      "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
      "addressType": "home",
      "recipientName": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
      "recipientPhone": "773123456",
      "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
      "line2": "Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø«Ø§Ù„Ø«ØŒ Ø´Ù‚Ø© 12",
      "city": "ØµÙ†Ø¹Ø§Ø¡",
      "region": "Ø­ÙŠ Ø§Ù„Ø³Ø¨Ø¹ÙŠÙ†",
      "country": "Yemen",
      "isDefault": true,
      "isActive": true,
      "usageCount": 5,
      "lastUsedAt": "2024-01-15T10:30:00Z"
    },
    {
      "_id": "addr_456",
      "label": "Ø§Ù„Ù…ÙƒØªØ¨",
      "addressType": "work",
      "recipientName": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
      "recipientPhone": "771999888",
      "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±ØŒ Ù…Ø¨Ù†Ù‰ Ø§Ù„ØªØ¬Ø§Ø±Ø©",
      "city": "ØµÙ†Ø¹Ø§Ø¡",
      "isDefault": false,
      "usageCount": 2
    }
  ],
  "count": 2
}

Features:
  âœ… Ù…Ø±ØªØ¨Ø©: Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø£ÙˆÙ„Ø§Ù‹ â†’ Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù… â†’ Ø§Ù„Ø£Ù‚Ø¯Ù…
  âœ… ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ?includeDeleted=true Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
```

---

#### 2. Get Active Addresses Only
```http
GET /addresses/active
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": [...active addresses],
  "count": 2
}

Note: ÙÙ‚Ø· Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ÙØ¹Ù‘Ø§Ù„Ø© ÙˆØºÙŠØ± Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
```

---

#### 3. Get Default Address
```http
GET /addresses/default
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": {
    "_id": "addr_123",
    "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
    "isDefault": true,
    ...
  }
}

Logic:
  1. ÙŠØ¨Ø­Ø« Ø¹Ù† Ø¹Ù†ÙˆØ§Ù† isDefault=true
  2. Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¬Ø¯ØŒ ÙŠØ£Ø®Ø° Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…
  3. Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¬Ø¯ØŒ ÙŠØ£Ø®Ø° Ø§Ù„Ø£ÙˆÙ„
  4. ÙŠØ¹ÙŠÙ‘Ù†Ù‡ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
```

---

#### 4. Get Address by ID
```http
GET /addresses/:id
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": {...address}
}

Error (404 if not found or doesn't belong to user)
```

---

#### 5. Create New Address
```http
POST /addresses
Authorization: Bearer {token}

Body:
{
  "label": "Ø§Ù„Ù…ÙƒØªØ¨",
  "addressType": "work",
  "recipientName": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ",
  "recipientPhone": "773123456",
  "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±ØŒ Ù…Ø¨Ù†Ù‰ Ø§Ù„ØªØ¬Ø§Ø±Ø©",
  "line2": "Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø®Ø§Ù…Ø³ØŒ Ù…ÙƒØªØ¨ 501",
  "city": "ØµÙ†Ø¹Ø§Ø¡",
  "region": "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
  "country": "Yemen",
  "postalCode": "12345",
  "notes": "Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©",
  "isDefault": false
}

Response:
{
  "success": true,
  "message": "Address created successfully",
  "data": {...created address}
}

Smart Logic:
  âœ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£ÙˆÙ„ Ø¹Ù†ÙˆØ§Ù† â†’ isDefault=true ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  âœ… Ø¥Ø°Ø§ isDefault=true â†’ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªØµØ¨Ø­ false
```

---

#### 6. Update Address
```http
PATCH /addresses/:id
Authorization: Bearer {token}

Body:
{
  "recipientPhone": "771999888",
  "notes": "ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©",
  "isDefault": true
}

Response:
{
  "success": true,
  "message": "Address updated successfully",
  "data": {...updated address}
}
```

---

#### 7. Delete Address
```http
DELETE /addresses/:id
Authorization: Bearer {token}

Response:
{
  "success": true,
  "message": "Address deleted successfully",
  "data": { "deleted": true }
}

Smart Logic:
  âœ… Soft delete (ÙŠÙØ­ÙØ¸ ÙÙŠ DB)
  âœ… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯
  âœ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ â†’ ÙŠÙØ¹ÙŠÙ‘Ù† Ø¹Ù†ÙˆØ§Ù† Ø¢Ø®Ø± ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
```

---

#### 8. Set as Default
```http
POST /addresses/:id/set-default
Authorization: Bearer {token}

Response:
{
  "success": true,
  "message": "Default address set successfully",
  "data": {...address with isDefault=true}
}

Logic:
  âœ… ÙŠØ¹ÙŠÙ‘Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
  âœ… Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªØµØ¨Ø­ isDefault=false
```

---

#### 9. Restore Deleted Address
```http
POST /addresses/:id/restore
Authorization: Bearer {token}

Response:
{
  "success": true,
  "message": "Address restored successfully",
  "data": {...restored address}
}
```

---

#### 10. Validate Address Ownership
```http
GET /addresses/validate/:id
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": { "valid": true }
}

Use Case: Ù„Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
```

---

## ğŸ”— Integration with Orders & Services

### ÙÙŠ Checkout (Ø·Ù„Ø¨ Ù…Ù†ØªØ¬Ø§Øª):

```typescript
// 1. Checkout DTO
CreateOrderDto {
  cartId: string
  deliveryAddressId: string  // âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ®ØªØ§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
  paymentMethod: string
}

// 2. Order Schema
Order {
  deliveryAddress: {         // âœ… ÙŠÙØ­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø§Ù‹
    addressId: ObjectId
    recipientName: string
    recipientPhone: string
    line1: string
    city: string
    ...
  }
}

// 3. ÙÙŠ createOrder():
- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: validateAddressOwnership()
- Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: getAddressById()
- Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
- ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: markAsUsed()
```

---

### ÙÙŠ Services (Ø·Ù„Ø¨ Ù…Ù‡Ù†Ø¯Ø³):

```typescript
// 1. Service Request DTO
CreateServiceRequestDto {
  serviceType: string
  serviceAddressId: string  // âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ®ØªØ§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
  description: string
}

// 2. ServiceRequest Schema
ServiceRequest {
  serviceAddress: {          // âœ… ÙŠÙØ­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø§Ù‹
    addressId: ObjectId
    recipientName: string
    recipientPhone: string
    line1: string
    city: string
    coords: { lat, lng }
    ...
  }
}

// 3. ÙÙŠ createServiceRequest():
- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
- Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
- Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø©
- ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
```

---

## ğŸ’¡ Best Practices

### 1. Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø§Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
```typescript
// âœ… ØµØ­ÙŠØ­
Order {
  deliveryAddress: {
    recipientName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
    recipientPhone: "773123456",
    line1: "...",
    city: "...",
    ...  // Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙØ§ØµÙŠÙ„
  }
}

// âŒ Ø®Ø·Ø£
Order {
  deliveryAddressId: "addr_123"  // ÙÙ‚Ø· ID
}

// Ù„Ù…Ø§Ø°Ø§ØŸ
// - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ ÙŠØ­Ø°Ù/ÙŠØ¹Ø¯Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ø§Ø­Ù‚Ø§Ù‹
// - Ø§Ù„Ø·Ù„Ø¨ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒÙ…Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨
```

---

### 2. Ø¯Ø§Ø¦Ù…Ø§Ù‹ ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
```typescript
// Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
const isValid = await addressesService.validateAddressOwnership(
  addressId,
  userId
);

if (!isValid) {
  throw new AppException('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± ØµØ­ÙŠØ­', 400);
}
```

---

### 3. Ø­Ø¯Ù‘Ø« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
```typescript
// Ø¨Ø¹Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø·Ù„Ø¨
await addressesService.markAsUsed(addressId, userId);

// Ù‡Ø°Ø§ ÙŠØ­Ø¯Ø«:
// - lastUsedAt = now
// - usageCount += 1
```

---

### 4. Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø°ÙƒÙŠ
```typescript
// Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªÙØ±ØªØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:
// 1. Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø£ÙˆÙ„Ø§Ù‹
// 2. Ø§Ù„Ø£Ø­Ø¯Ø« Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹
// 3. Ø§Ù„Ø£Ù‚Ø¯Ù… Ø¥Ù†Ø´Ø§Ø¡Ù‹

sort({ isDefault: -1, lastUsedAt: -1, createdAt: -1 })
```

---

## ğŸ“± Frontend Tips

### 1. Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙÙŠ Checkout
```jsx
{addresses.map(address => (
  <div 
    key={address._id}
    className={selectedAddressId === address._id ? 'selected' : ''}
    onClick={() => setSelectedAddressId(address._id)}
  >
    {address.isDefault && <span>â­ Ø§ÙØªØ±Ø§Ø¶ÙŠ</span>}
    <h3>{address.label}</h3>
    <p>{address.recipientName} - {address.recipientPhone}</p>
    <p>{address.line1}, {address.city}</p>
  </div>
))}
```

---

### 2. Auto-select Default Address
```jsx
useEffect(() => {
  const defaultAddr = addresses.find(a => a.isDefault);
  if (defaultAddr) {
    setSelectedAddressId(defaultAddr._id);
  }
}, [addresses]);
```

---

### 3. Validate Before Submit
```jsx
async function placeOrder() {
  if (!selectedAddressId) {
    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„');
    return;
  }

  // ... proceed with order
}
```

---

### 4. Add New Address from Checkout
```jsx
<button onClick={() => {
  window.location.href = '/addresses/new?returnTo=checkout';
}}>
  + Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯
</button>
```

---

## ğŸ”„ Complete User Flow

```
1. User opens Checkout page
   â†“
2. System loads addresses: GET /addresses/active
   â†“
3. Default address is auto-selected âœ…
   â†“
4. User sees all their addresses
   â†“
5. User can:
   - Select different address âœ…
   - Add new address âœ…
   - Edit existing address âœ…
   â†“
6. User clicks "Confirm Order"
   â†“
7. Backend validates address ownership âœ…
   â†“
8. Backend saves full address in order âœ…
   â†“
9. Backend updates address usage stats âœ…
   â†“
10. Order created successfully âœ…
```

---

## ğŸ¯ Use Cases

### Use Case 1: Ø£ÙˆÙ„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
```javascript
POST /addresses
{
  "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
  "recipientName": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
  ...
}

// Ø§Ù„Ù†ØªÙŠØ¬Ø©:
{
  "isDefault": true,  // âœ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  ...
}
```

---

### Use Case 2: Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø«Ø§Ù†ÙŠ
```javascript
POST /addresses
{
  "label": "Ø§Ù„Ù…ÙƒØªØ¨",
  "isDefault": false,  // ØºÙŠØ± Ø§ÙØªØ±Ø§Ø¶ÙŠ
  ...
}

// Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¢Ù† Ù„Ø¯ÙŠÙ‡:
// - Ø§Ù„Ù…Ù†Ø²Ù„ (Ø§ÙØªØ±Ø§Ø¶ÙŠ) â­
// - Ø§Ù„Ù…ÙƒØªØ¨
```

---

### Use Case 3: ØªØºÙŠÙŠØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
```javascript
POST /addresses/addr_456/set-default

// Ø§Ù„Ù†ØªÙŠØ¬Ø©:
// - Ø§Ù„Ù…Ù†Ø²Ù„: isDefault=false
// - Ø§Ù„Ù…ÙƒØªØ¨: isDefault=true â­
```

---

### Use Case 4: Ø­Ø°Ù Ø¹Ù†ÙˆØ§Ù†
```javascript
DELETE /addresses/addr_123

// Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯:
// âŒ Error: "Cannot delete your only address"

// Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙˆÙ‡Ù†Ø§Ùƒ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø£Ø®Ø±Ù‰:
// âœ… ÙŠÙØ­Ø°Ù
// âœ… Ø¹Ù†ÙˆØ§Ù† Ø¢Ø®Ø± ÙŠØµØ¨Ø­ Ø§ÙØªØ±Ø§Ø¶ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
```

---

### Use Case 5: Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø·Ù„Ø¨
```javascript
POST /checkout
{
  "cartId": "cart_123",
  "deliveryAddressId": "addr_123"  // âœ…
}

// Ø§Ù„Ø¨ÙŠÙƒ Ø¥Ù†Ø¯:
// 1. ÙŠØªØ­Ù‚Ù‚ Ø£Ù† addr_123 ÙŠØ®Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… âœ…
// 2. ÙŠØ¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø© âœ…
// 3. ÙŠØ­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨ âœ…
// 4. ÙŠØ­Ø¯Ø« lastUsedAt Ùˆ usageCount âœ…

// Order:
{
  "deliveryAddress": {
    "addressId": "addr_123",
    "recipientName": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
    "recipientPhone": "773123456",
    "line1": "...",
    ...  // ÙƒÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù…Ø­ÙÙˆØ¸Ø©
  }
}
```

---

## âœ… Ø§Ù„Ù…Ù„Ø®Øµ

### Ù…Ø§ ØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡:
1. âœ… **Schema Ù…Ø­Ø³Ù‘Ù†** (15 Ø­Ù‚Ù„ Ø¬Ø¯ÙŠØ¯)
2. âœ… **Service Ù…Ø­Ø³Ù‘Ù†** (10 methods Ù…Ø­Ø³Ù‘Ù†Ø©)
3. âœ… **DTOs Ù…Ø­Ø³Ù‘Ù†Ø©** (validation ÙƒØ§Ù…Ù„)
4. âœ… **Controller Ù…Ø­Ø³Ù‘Ù†** (10 endpoints)
5. âœ… **Ù…Ù†Ø·Ù‚ Ø°ÙƒÙŠ** (default auto-set, prevent delete only, etc.)
6. âœ… **Soft delete** (Ù„Ø§ ÙŠÙØ­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹)
7. âœ… **Usage tracking** (ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…)
8. âœ… **Error handling** (Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ø¶Ø­Ø©)
9. âœ… **Integration ready** (Ù…Ø¹ Checkout & Services)

### Features:
- âœ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ÙˆÙŠÙ† Ù…ØªØ¹Ø¯Ø¯Ø©
- âœ… ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†ÙˆØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ
- âœ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨
- âœ… Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
- âœ… Ù…Ù†Ø¹ Ø­Ø°Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯
- âœ… ØªØ±ØªÙŠØ¨ Ø°ÙƒÙŠ Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
- âœ… ØªØªØ¨Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

---

## ğŸ“ Next Steps

### Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„:
1. âš ï¸ Update Checkout Module (import AddressesModule)
2. âš ï¸ Update Checkout DTO (add deliveryAddressId)
3. âš ï¸ Update Order Schema (add deliveryAddress object)
4. âš ï¸ Update Checkout Service (integrate with AddressesService)
5. âš ï¸ Update Services Module (import AddressesModule)
6. âš ï¸ Update Service Request DTO (add serviceAddressId)
7. âš ï¸ Update ServiceRequest Schema (add serviceAddress object)
8. âš ï¸ Update Services Service (integrate with AddressesService)

---

**Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² ÙˆÙ…Ø­Ø³Ù‘Ù†! ğŸ‰**

Ø±Ø§Ø¬Ø¹:
- `backend/ADDRESSES_SYSTEM_COMPLETE_GUIDE.md`
- `backend/ADDRESSES_INTEGRATION_EXAMPLES.md`

