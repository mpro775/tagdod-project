# Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ ğŸ“¦âœ¨
# Complete Professional Orders System

## ğŸ¯ **Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ ÙˆØ§Ù„Ø®Ø·Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©**

---

## âœ… Ù…Ø§ ØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡

### Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯):
```
âœ… Order Schema Ø£Ø³Ø§Ø³ÙŠ
âœ… Inventory management Ù…Ù…ØªØ§Ø²
âœ… Reservation system Ù‚ÙˆÙŠ
âœ… Payment integration Ù…ÙˆØ¬ÙˆØ¯
âœ… Basic order statuses
```

### Ù…Ø§ ÙŠÙ†Ù‚Øµ (Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¥Ø¶Ø§ÙØªÙ‡):
```
âŒ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„
âŒ ØªÙƒØ§Ù…Ù„ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª
âŒ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„Ø©
âŒ ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†
âŒ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª
âŒ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹
âŒ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
âŒ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„ØªÙˆØ§ØµÙ„
âŒ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
âŒ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
```

---

## ğŸ—ï¸ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©

### Order Schema Ø§Ù„Ø¬Ø¯ÙŠØ¯ (100+ Ø­Ù‚Ù„)

```typescript
Order {
  // ===== 1. Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =====
  orderNumber: "ORD-2024-00001"    // ğŸ†• Ø±Ù‚Ù… Ø³Ù‡Ù„
  userId: ObjectId
  accountType: "retail"            // ğŸ†• retail/wholesale/engineer
  source: "web"                    // ğŸ†• web/mobile/app
  
  // ===== 2. Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© (16 Ø­Ø§Ù„Ø©) =====
  status: OrderStatus {
    draft, pending_payment,        // Ø¥Ù†Ø´Ø§Ø¡
    confirmed, payment_failed,     // ØªØ£ÙƒÙŠØ¯
    processing, ready_to_ship,     // ØªØ¬Ù‡ÙŠØ²
    shipped, out_for_delivery,     // Ø´Ø­Ù†
    delivered, completed,          // ØªØ³Ù„ÙŠÙ…
    on_hold, cancelled,            // Ø®Ø§ØµØ©
    refunded, partially_refunded,  // Ø§Ø³ØªØ±Ø¯Ø§Ø¯
    returned                       // Ø¥Ø±Ø¬Ø§Ø¹
  }
  
  paymentStatus: PaymentStatus {   // ğŸ†• 7 Ø­Ø§Ù„Ø§Øª
    pending, authorized, paid,
    failed, refunded,
    partially_refunded, cancelled
  }
  
  // ğŸ†• Ø³Ø¬Ù„ ÙƒØ§Ù…Ù„ Ù„Ù„Ø­Ø§Ù„Ø§Øª
  statusHistory: [{
    status: "processing",
    changedAt: Date,
    changedBy: ObjectId,
    changedByRole: "admin",
    notes: "ØªÙ… Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„ØªØ¬Ù‡ÙŠØ²",
    metadata: {}
  }]
  
  // ===== 3. Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ =====
  deliveryAddress: {               // ğŸ†• Ø­ÙØ¸ ÙƒØ§Ù…Ù„
    addressId: ObjectId,
    recipientName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
    recipientPhone: "773123456",
    line1: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†",
    line2: "Ø§Ù„Ø¯ÙˆØ± 3ØŒ Ø´Ù‚Ø© 12",
    city: "ØµÙ†Ø¹Ø§Ø¡",
    region: "Ø­ÙŠ Ø§Ù„Ø³Ø¨Ø¹ÙŠÙ†",
    country: "Yemen",
    postalCode: "12345",
    coords: { lat: 15.3694, lng: 44.1910 },
    notes: "Ø§Ù„Ø§ØªØµØ§Ù„ Ù‚Ø¨Ù„ Ø§Ù„ÙˆØµÙˆÙ„"
  }
  
  // ===== 4. Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø© =====
  items: [{
    productId: ObjectId,
    variantId: ObjectId,
    qty: 2,
    
    // ğŸ†• Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
    basePrice: 100000,             // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ
    discount: 20000,               // Ø§Ù„Ø®ØµÙ…
    finalPrice: 80000,             // Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    lineTotal: 160000,             // Ã— qty
    currency: "YER",
    
    // ğŸ†• Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø·Ø¨Ù‚
    appliedPromotionId: ObjectId,
    promotionDiscount: 20000,
    
    // ğŸ†• Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙƒØ§Ù…Ù„Ø©
    snapshot: {
      name: "iPhone 15 Pro",
      sku: "IP15PRO-256-BLK",
      slug: "iphone-15-pro",
      image: "https://...",
      brandId: ObjectId,
      brandName: "Apple",
      categoryId: ObjectId,
      categoryName: "Smartphones",
      attributes: {
        color: "Black",
        storage: "256GB"
      }
    },
    
    // ğŸ†• Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬
    itemStatus: "fulfilled",       // pending/fulfilled/cancelled/returned
    
    // ğŸ†• Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹
    isReturned: false,
    returnQty: 0,
    returnReason: null,
    returnedAt: null
  }]
  
  // ===== 5. Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© =====
  currency: "YER",
  
  subtotal: 200000,                // ğŸ†• Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ØµÙ„ÙŠ
  itemsDiscount: 40000,            // ğŸ†• Ø®ØµÙ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  
  // Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
  appliedCouponCode: "SUMMER20",   // ğŸ†•
  couponDiscount: 32000,           // ğŸ†•
  couponDetails: {                 // ğŸ†• ØªÙØ§ØµÙŠÙ„ ÙƒØ§Ù…Ù„Ø©
    code: "SUMMER20",
    title: "Ø®ØµÙ… Ø§Ù„ØµÙŠÙ 20%",
    type: "percentage",
    discountPercentage: 20
  },
  
  // ÙƒÙˆØ¨ÙˆÙ†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
  autoAppliedCoupons: [{           // ğŸ†•
    code: "WELCOME10",
    discount: 12800
  }],
  autoDiscountsTotal: 12800,       // ğŸ†•
  
  // Ø§Ù„Ø´Ø­Ù†
  shippingCost: 5000,              // ğŸ†•
  shippingDiscount: 0,             // ğŸ†•
  
  // Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
  tax: 0,                          // ğŸ†•
  taxRate: 0,                      // ğŸ†•
  
  // Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹
  totalDiscount: 84800,            // ğŸ†• Ø§Ù„Ø®ØµÙ… Ø§Ù„ÙƒÙ„ÙŠ
  total: 120200,                   // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
  
  // ===== 6. Ø§Ù„Ø¯ÙØ¹ =====
  paymentMethod: "COD",
  paymentProvider: null,
  paymentIntentId: null,
  paymentTransactionId: null,      // ğŸ†•
  paidAt: Date,
  
  // ===== 7. Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªØªØ¨Ø¹ =====
  shippingMethod: "standard",      // ğŸ†•
  shippingCompany: "DHL",          // ğŸ†•
  trackingNumber: "DHL123456",     // ğŸ†•
  trackingUrl: "https://...",      // ğŸ†•
  estimatedDeliveryDate: Date,     // ğŸ†•
  actualDeliveryDate: Date,        // ğŸ†•
  deliveredAt: Date,
  
  // ===== 8. Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ =====
  isRefunded: false,               // ğŸ†•
  refundAmount: 0,                 // ğŸ†•
  refundReason: null,              // ğŸ†•
  refundedAt: null,                // ğŸ†•
  refundedBy: null,                // ğŸ†•
  
  isReturned: false,               // ğŸ†•
  returnReason: null,              // ğŸ†•
  returnedAt: null,                // ğŸ†•
  returnItems: [],                 // ğŸ†• ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹
  
  // ===== 9. Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª =====
  customerNotes: "ØªÙˆØµÙŠÙ„ ØµØ¨Ø§Ø­Ø§Ù‹",  // ğŸ†•
  adminNotes: "Ø¹Ù…ÙŠÙ„ VIP",          // ğŸ†•
  internalNotes: "ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",  // ğŸ†•
  
  // ===== 10. Ø§Ù„ÙÙˆØ§ØªÙŠØ± =====
  invoiceNumber: "INV-2024-00001", // ğŸ†•
  invoiceUrl: "https://...",       // ğŸ†•
  receiptUrl: "https://...",       // ğŸ†•
  
  // ===== 11. Ø§Ù„ØªÙ‚ÙŠÙŠÙ… =====
  rating: 5,                       // ğŸ†•
  review: "Ù…Ù…ØªØ§Ø²!",                // ğŸ†•
  ratedAt: Date,                   // ğŸ†•
  
  // ===== 12. Metadata =====
  metadata: {                      // ğŸ†•
    cartId: "cart_123",
    campaign: "summer_sale",
    referrer: "facebook.com",
    utmSource: "facebook",
    utmMedium: "cpc",
    utmCampaign: "summer_2024",
    deviceInfo: "iPhone 13",
    ipAddress: "1.2.3.4",
    userAgent: "Mozilla..."
  },
  
  // ===== 13. Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø§Ù…Ø© =====
  confirmedAt: Date,               // ğŸ†•
  processingStartedAt: Date,       // ğŸ†•
  shippedAt: Date,                 // ğŸ†•
  completedAt: Date,               // ğŸ†•
  cancelledAt: Date,               // ğŸ†•
  cancelledBy: ObjectId,           // ğŸ†•
  cancellationReason: string,      // ğŸ†•
  
  createdAt: Date,
  updatedAt: Date
}
```

---

## ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª

### Ù…Ø§ ØªÙ… ØªØµÙ…ÙŠÙ…Ù‡:
```
ğŸ¯ Order Schema: 100+ Ø­Ù‚Ù„
ğŸ¯ OrderItem: 25+ Ø­Ù‚Ù„
ğŸ¯ 16 Ø­Ø§Ù„Ø© Ù„Ù„Ø·Ù„Ø¨
ğŸ¯ 7 Ø­Ø§Ù„Ø§Øª Ù„Ù„Ø¯ÙØ¹
ğŸ¯ 4 Ø·Ø±Ù‚ Ø´Ø­Ù†
ğŸ¯ 12 indexes Ù…Ø­Ø³Ù‘Ù†Ø©
```

---

## ğŸ”„ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ - Ù…Ù† Ø§Ù„Ø³Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªØ³Ù„ÙŠÙ…

```
1ï¸âƒ£ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø³Ù„Ø©
   â†’ cart with: items, coupons applied, pricing calculated

2ï¸âƒ£ ÙŠØ°Ù‡Ø¨ Ù„Ù„Ù€ Checkout
   POST /checkout/preview
   {
     "currency": "YER",
     "couponCode": "SUMMER20"
   }
   
   Response:
   {
     "items": [...]
     "pricing": {
       "subtotal": 200000,
       "itemsDiscount": 40000,    // Ù…Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶
       "couponDiscount": 32000,   // Ù…Ù† Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
       "shippingCost": 5000,
       "total": 133000
     },
     "savings": 72000,
     "estimatedDelivery": "3-5 days"
   }

3ï¸âƒ£ ÙŠØ®ØªØ§Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„
   selectedAddressId = "addr_123"

4ï¸âƒ£ ÙŠØ®ØªØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø´Ø­Ù†
   shippingMethod = "standard"  // Ù…Ø¬Ø§Ù†ÙŠ

5ï¸âƒ£ ÙŠØ®ØªØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
   paymentMethod = "COD"

6ï¸âƒ£ ÙŠØªÙ… Ø§Ù„Ø·Ù„Ø¨
   POST /checkout/confirm
   {
     "deliveryAddressId": "addr_123",
     "paymentMethod": "COD",
     "shippingMethod": "standard",
     "customerNotes": "ØªÙˆØµÙŠÙ„ ØµØ¨Ø§Ø­Ø§Ù‹",
     "currency": "YER"
   }

7ï¸âƒ£ Backend ÙŠÙ†Ø´Ø¦ Ø§Ù„Ø·Ù„Ø¨:
   
   âœ… ÙŠÙˆÙ„Ø¯ orderNumber: "ORD-2024-00001"
   âœ… ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
   âœ… ÙŠØ¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„Ø©
   âœ… ÙŠØ­Ø³Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
   âœ… ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
   âœ… ÙŠØ­Ø¬Ø² Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (inventory reservation)
   âœ… ÙŠÙ†Ø´Ø¦ Order Ù…Ø¹:
      - deliveryAddress (ÙƒØ§Ù…Ù„)
      - items (Ù…Ø¹ snapshot Ùˆ pricing)
      - couponDetails (ÙƒØ§Ù…Ù„)
      - pricingBreakdown (Ù…ÙØµÙ‘Ù„)
      - statusHistory (Ø£ÙˆÙ„ entry)
   âœ… ÙŠØ­Ø¯Ø« Cart: status = 'converted'
   âœ… ÙŠØ­Ø¯Ø« Address: lastUsedAt, usageCount
   âœ… ÙŠØ­Ø¯Ø« Coupon: usage stats
   âœ… ÙŠØ±Ø³Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„
   âœ… ÙŠØ±Ø³Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø£Ø¯Ù…Ù†
   
   Response:
   {
     "orderId": "order_456",
     "orderNumber": "ORD-2024-00001",
     "status": "confirmed",
     "total": 133000
   }

8ï¸âƒ£ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ´Ø§Ù‡Ø¯ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
   GET /orders/order_456
   
   â†’ ÙŠØ±Ù‰ ÙƒÙ„ Ø´ÙŠØ¡:
     âœ… Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
     âœ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
     âœ… Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„
     âœ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØ±
     âœ… ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
     âœ… Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† Ø§Ù„Ù…Ø·Ø¨Ù‚
     âœ… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„ØªÙˆØµÙŠÙ„

9ï¸âƒ£ Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ø§Ù„ØªØ¬Ù‡ÙŠØ²
   PATCH /admin/orders/order_456/status
   { "status": "processing", "notes": "Ø¨Ø¯Ø£ Ø§Ù„ØªØ¬Ù‡ÙŠØ²" }
   
   â†’ Order status â†’ "processing"
   â†’ processingStartedAt â†’ now
   â†’ statusHistory.push({...})
   â†’ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„: "Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²"

ğŸ”Ÿ Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠØ´Ø­Ù† Ø§Ù„Ø·Ù„Ø¨
   POST /admin/orders/order_456/ship
   {
     "shippingCompany": "DHL",
     "trackingNumber": "DHL123456789",
     "estimatedDelivery": "2024-01-20"
   }
   
   â†’ Order status â†’ "shipped"
   â†’ shippedAt â†’ now
   â†’ trackingUrl â†’ generated
   â†’ SMS/Email Ù„Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø¹ Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹

1ï¸âƒ£1ï¸âƒ£ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨
   GET /orders/order_456/track
   
   â†’ ÙŠØ±Ù‰:
     âœ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
     âœ… Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹
     âœ… Ø±Ø§Ø¨Ø· Ø§Ù„ØªØªØ¨Ø¹
     âœ… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
     âœ… Timeline ÙƒØ§Ù…Ù„

1ï¸âƒ£2ï¸âƒ£ ÙŠØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…
   PATCH /admin/orders/order_456/status
   { "status": "delivered" }
   
   â†’ Order status â†’ "delivered"
   â†’ deliveredAt â†’ now
   â†’ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„: "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­!"

1ï¸âƒ£3ï¸âƒ£ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙ‚ÙŠÙ‘Ù… Ø§Ù„Ø·Ù„Ø¨
   POST /orders/order_456/rate
   { "rating": 5, "review": "Ø®Ø¯Ù…Ø© Ù…Ù…ØªØ§Ø²Ø©!" }
   
   â†’ rating, review Ù…Ø­ÙÙˆØ¸Ø©
   â†’ ratedAt â†’ now

1ï¸âƒ£4ï¸âƒ£ Ø¨Ø¹Ø¯ ÙØªØ±Ø© â†’ Ø§Ù„Ø·Ù„Ø¨ ÙŠÙƒØªÙ…Ù„
   Cron Job or Admin:
   â†’ Order status â†’ "completed"
   â†’ completedAt â†’ now
```

---

## ğŸ¨ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ©

### Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨:
```javascript
POST /orders/order_456/cancel
{ "reason": "ØªØºÙŠÙŠØ± Ø±Ø£ÙŠÙŠ" }

// ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ù„ØºØ§Ø¡ ÙÙŠ:
âœ… confirmed, processing

// Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙÙŠ:
âŒ shipped, delivered

// Ø§Ù„Ø¨ÙŠÙƒ Ø¥Ù†Ø¯:
â†’ Order status â†’ "cancelled"
â†’ cancelledAt â†’ now
â†’ cancelledBy â†’ userId
â†’ cancellationReason â†’ saved
â†’ Inventory released (Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†)
â†’ Refund processed (Ø¥Ø°Ø§ Ù…Ø¯ÙÙˆØ¹)
â†’ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„
```

---

### Ø·Ù„Ø¨ Ø¥Ø±Ø¬Ø§Ø¹:
```javascript
POST /orders/order_456/return
{
  "items": [
    {
      "variantId": "var_123",
      "qty": 1,
      "reason": "Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø¹Ø·ÙˆØ¨"
    }
  ],
  "returnReason": "Ø¹Ø·Ù„ ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬"
}

// Ø§Ù„Ø´Ø±ÙˆØ·:
âœ… Ø®Ù„Ø§Ù„ 14 ÙŠÙˆÙ… Ù…Ù† Ø§Ù„ØªØ³Ù„ÙŠÙ…
âœ… Order status = delivered Ø£Ùˆ completed

// Ø§Ù„Ø¨ÙŠÙƒ Ø¥Ù†Ø¯:
â†’ isReturned â†’ true
â†’ returnReason â†’ saved
â†’ returnItems â†’ [{...}]
â†’ returnedAt â†’ now
â†’ Order status â†’ "returned"
â†’ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø£Ø¯Ù…Ù†: "Ø·Ù„Ø¨ Ø¥Ø±Ø¬Ø§Ø¹ Ø¬Ø¯ÙŠØ¯"

// Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠØ±Ø§Ø¬Ø¹ ÙˆÙŠÙˆØ§ÙÙ‚:
POST /admin/orders/order_456/approve-return
â†’ Inventory restored
â†’ Refund processed
â†’ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„: "ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹"
```

---

### Ø§Ø³ØªØ±Ø¯Ø§Ø¯ ÙƒØ§Ù…Ù„:
```javascript
POST /admin/orders/order_456/refund
{
  "amount": 133000,  // ÙƒØ§Ù…Ù„
  "reason": "Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ø±Ø§Ø¶ÙŠ",
  "items": "all"
}

â†’ isRefunded â†’ true
â†’ refundAmount â†’ 133000
â†’ refundReason â†’ saved
â†’ refundedAt â†’ now
â†’ refundedBy â†’ adminId
â†’ paymentStatus â†’ "refunded"
â†’ Order status â†’ "refunded"
â†’ Inventory restored
â†’ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„
```

---

### Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø¬Ø²Ø¦ÙŠ:
```javascript
POST /admin/orders/order_456/refund
{
  "amount": 80000,  // Ø¬Ø²Ø¦ÙŠ
  "reason": "Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ù…Ø¹Ø·ÙˆØ¨",
  "items": [
    { "variantId": "var_123", "qty": 1 }
  ]
}

â†’ refundAmount â†’ 80000
â†’ paymentStatus â†’ "partially_refunded"
â†’ Order status â†’ "partially_refunded"
â†’ items[0].isReturned â†’ true
â†’ items[0].returnQty â†’ 1
â†’ Inventory restored for returned item only
```

---

## ğŸ“Š Admin Dashboard

### Order Management:

```jsx
// AdminOrdersPage.jsx
function AdminOrdersPage() {
  const [orders, setOrders] = useState([]);
  const [filters, setFilters] = useState({
    status: 'all',
    search: '',
    page: 1
  });

  async function loadOrders() {
    const res = await fetch(
      `/admin/orders?status=${filters.status}&search=${filters.search}&page=${filters.page}`,
      { headers: { 'Authorization': `Bearer ${getAdminToken()}` } }
    );
    const data = await res.json();
    setOrders(data.data);
  }

  async function updateStatus(orderId, newStatus, notes) {
    const res = await fetch(`/admin/orders/${orderId}/status`, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${getAdminToken()}`
      },
      body: JSON.stringify({ status: newStatus, notes }),
    });

    if (res.ok) {
      alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨');
      loadOrders();
    }
  }

  async function shipOrder(orderId) {
    const trackingNumber = prompt('Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹:');
    const company = prompt('Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†:');

    if (!trackingNumber || !company) return;

    const res = await fetch(`/admin/orders/${orderId}/ship`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${getAdminToken()}`
      },
      body: JSON.stringify({
        shippingCompany: company,
        trackingNumber,
        estimatedDelivery: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000)
      }),
    });

    if (res.ok) {
      alert('âœ… ØªÙ… Ø´Ø­Ù† Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„');
      loadOrders();
    }
  }

  return (
    <div className="admin-orders">
      <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>

      {/* Filters */}
      <div className="filters">
        <select value={filters.status} onChange={(e) => setFilters({...filters, status: e.target.value})}>
          <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</option>
          <option value="confirmed">Ù…Ø¤ÙƒØ¯Ø©</option>
          <option value="processing">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</option>
          <option value="shipped">Ù…Ø´Ø­ÙˆÙ†Ø©</option>
          <option value="delivered">Ù…ÙØ³Ù„Ù‘Ù…Ø©</option>
        </select>

        <input
          type="text"
          placeholder="Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨..."
          value={filters.search}
          onChange={(e) => setFilters({...filters, search: e.target.value})}
        />
      </div>

      {/* Orders Table */}
      <table className="orders-table">
        <thead>
          <tr>
            <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
            <th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
          {orders.map(order => (
            <tr key={order._id}>
              <td>
                <strong>{order.orderNumber}</strong>
              </td>
              <td>
                {order.deliveryAddress.recipientName}
                <br />
                <small>{order.deliveryAddress.recipientPhone}</small>
              </td>
              <td>{order.items.length} Ù…Ù†ØªØ¬Ø§Øª</td>
              <td>{order.total.toLocaleString()} YER</td>
              <td>
                <span className={`status-badge status-${order.status}`}>
                  {order.status}
                </span>
              </td>
              <td>{new Date(order.createdAt).toLocaleDateString('ar-YE')}</td>
              <td>
                <button onClick={() => viewOrder(order._id)}>
                  Ø¹Ø±Ø¶
                </button>

                {order.status === 'confirmed' && (
                  <button onClick={() => updateStatus(order._id, 'processing', 'Ø¨Ø¯Ø£ Ø§Ù„ØªØ¬Ù‡ÙŠØ²')}>
                    Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¬Ù‡ÙŠØ²
                  </button>
                )}

                {order.status === 'processing' && (
                  <button onClick={() => shipOrder(order._id)}>
                    Ø´Ø­Ù†
                  </button>
                )}
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

---

## âœ… Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

### Ù…Ø§ ØªÙ… ØªØµÙ…ÙŠÙ…Ù‡:

#### 1. Schema Ù…Ø­Ø³Ù‘Ù† âœ…
- ğŸ†• 100+ Ø­Ù‚Ù„ Ø¬Ø¯ÙŠØ¯
- ğŸ†• 16 Ø­Ø§Ù„Ø© Ù„Ù„Ø·Ù„Ø¨
- ğŸ†• Ø³Ø¬Ù„ ÙƒØ§Ù…Ù„ Ù„Ù„Ø­Ø§Ù„Ø§Øª
- ğŸ†• Ø¹Ù†ÙˆØ§Ù† ØªÙˆØµÙŠÙ„ ÙƒØ§Ù…Ù„
- ğŸ†• ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„Ø©
- ğŸ†• Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø­Ù† ÙƒØ§Ù…Ù„Ø©
- ğŸ†• Ù†Ø¸Ø§Ù… Ø¥Ø±Ø¬Ø§Ø¹ ÙˆØ§Ø³ØªØ±Ø¯Ø§Ø¯
- ğŸ†• ØªÙ‚ÙŠÙŠÙ…Ø§Øª
- ğŸ†• metadata Ø´Ø§Ù…Ù„

#### 2. Order Items Ù…Ø­Ø³Ù‘Ù† âœ…
- ğŸ†• Ø£Ø³Ø¹Ø§Ø± ØªÙØµÙŠÙ„ÙŠØ© (base, discount, final, lineTotal)
- ğŸ†• snapshot ÙƒØ§Ù…Ù„ (brand, category, attributes)
- ğŸ†• Ø­Ø§Ù„Ø© Ù„ÙƒÙ„ Ù…Ù†ØªØ¬
- ğŸ†• Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø±Ø¬Ø§Ø¹ Ù„ÙƒÙ„ Ù…Ù†ØªØ¬

#### 3. Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„ÙƒØ§Ù…Ù„ âœ…
- âœ… AddressesService (Ø­ÙØ¸ Ø¹Ù†ÙˆØ§Ù† ÙƒØ§Ù…Ù„)
- âœ… CouponsService (ØªØ·Ø¨ÙŠÙ‚ ÙˆØ­ÙØ¸)
- âœ… PricingService (Ø­Ø³Ø§Ø¨ Ø¯Ù‚ÙŠÙ‚)
- âœ… CartService (ØªØ­ÙˆÙŠÙ„ ÙˆØªØªØ¨Ø¹)
- âœ… Inventory (Ø­Ø¬Ø² ÙˆØ¥Ø¯Ø§Ø±Ø©)

#### 4. Features Ø§Ø­ØªØ±Ø§ÙÙŠØ© âœ…
- âœ… Order number generation
- âœ… Status management with history
- âœ… Shipping tracking
- âœ… Refunds & returns
- âœ… Ratings & reviews
- âœ… Admin management
- âœ… Analytics & reports
- âœ… Notifications

---

## ğŸ“‚ Ø§Ù„Ù…Ù„ÙØ§Øª

```
backend/src/modules/checkout/schemas/
â”œâ”€â”€ order.schema.ts              âš ï¸ Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ø¨Ø³ÙŠØ·)
â”œâ”€â”€ order.schema.new.ts          âœ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ø­ØªØ±Ø§ÙÙŠ - 380 Ø³Ø·Ø±)
â”œâ”€â”€ inventory.schema.ts          âœ… Ù…ÙˆØ¬ÙˆØ¯
â”œâ”€â”€ reservation.schema.ts        âœ… Ù…ÙˆØ¬ÙˆØ¯
â””â”€â”€ inventory-ledger.schema.ts   âœ… Ù…ÙˆØ¬ÙˆØ¯

backend/
â”œâ”€â”€ ORDERS_SYSTEM_ANALYSIS.md               âœ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
â”œâ”€â”€ PROFESSIONAL_ORDERS_SYSTEM.md           âœ… Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„
â””â”€â”€ Ù†Ø¸Ø§Ù…_Ø§Ù„Ø·Ù„Ø¨Ø§Øª_Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ_Ø§Ù„Ø´Ø§Ù…Ù„.md (Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù) âœ…
```

---

## ğŸš€ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©

### Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„:

```typescript
// 1. Ø§Ø³ØªØ¨Ø¯Ù„ order.schema.ts
mv order.schema.ts order.schema.old.ts
mv order.schema.new.ts order.schema.ts

// 2. Ø£Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© CheckoutService (~800 Ø³Ø·Ø±)
// 3. Ø­Ø¯Ù‘Ø« Controllers
// 4. Ø£Ø¶Ù Admin endpoints
// 5. Ø£Ø¶Ù Notifications
// 6. Ø§Ø®ØªØ¨Ø± ÙƒÙ„ Ø´ÙŠØ¡
```

---

## ğŸ’¡ **Ø§Ù„Ø®Ù„Ø§ØµØ©**

ØªÙ… ØªØµÙ…ÙŠÙ… **Ù†Ø¸Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø·Ù„Ù‚** ÙŠØ´Ù…Ù„:

âœ… **Order Schema** (100+ Ø­Ù‚Ù„)
âœ… **16 Ø­Ø§Ù„Ø©** Ù„Ù„Ø·Ù„Ø¨
âœ… **ØªÙƒØ§Ù…Ù„ ÙƒØ§Ù…Ù„** Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©
âœ… **ØªØªØ¨Ø¹ Ø´Ø§Ù…Ù„** Ù„Ù„Ø´Ø­Ù†
âœ… **Ø¥Ø±Ø¬Ø§Ø¹ ÙˆØ§Ø³ØªØ±Ø¯Ø§Ø¯** ÙƒØ§Ù…Ù„
âœ… **ØªÙ‚ÙŠÙŠÙ…Ø§Øª** ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø§Øª
âœ… **Admin management** Ø´Ø§Ù…Ù„
âœ… **Analytics** Ù…ØªÙ‚Ø¯Ù…Ø©

**Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØµÙ…Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆÙ…ÙØµÙ‘Ù„!**

Ù†Ø¸Ø±Ø§Ù‹ Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒÙˆØ¯ (~1500+ Ø³Ø·Ø± Ù„Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒØ§Ù…Ù„):
- Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„: âœ… ÙƒØ§Ù…Ù„
- Schema: âœ… Ø¬Ø§Ù‡Ø²
- Ø§Ù„ØªÙˆØ«ÙŠÙ‚: âœ… Ø´Ø§Ù…Ù„
- Ø§Ù„ÙƒÙˆØ¯: âš ï¸ ÙŠØ­ØªØ§Ø¬ ÙƒØªØ§Ø¨Ø© (~1500 Ø³Ø·Ø±)

**Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ù†ÙŠ Ø¥ÙƒÙ…Ø§Ù„ ÙƒØªØ§Ø¨Ø© CheckoutService Ø§Ù„ÙƒØ§Ù…Ù„ Ø§Ù„Ø¢Ù†ØŸ** ğŸš€

