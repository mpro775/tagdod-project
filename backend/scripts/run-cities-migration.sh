#!/bin/bash

# Migration Script: ุฅุถุงูุฉ ุญูู ุงููุฏููุฉ
# ูููู ุจุชุญุฏูุซ ุงูุณุฌูุงุช ุงููุฏููุฉ ูุฅุถุงูุฉ ุญูู ุงููุฏููุฉ

echo "๐ ุชุดุบูู Migration: ุฅุถุงูุฉ ุญูู ุงููุฏููุฉ ููุฎุฏูุงุช"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

# ุงูุชุญูู ูู ูุฌูุฏ ููู .env
if [ ! -f .env ]; then
    echo "โ ุฎุทุฃ: ููู .env ุบูุฑ ููุฌูุฏ"
    echo "๐ก ูู ุจุฅูุดุงุก ููู .env ุฃู ูุณุฎู ูู env.example"
    exit 1
fi

# ุชุญููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
source .env

# ุงูุชุญูู ูู MONGODB_URI
if [ -z "$MONGODB_URI" ]; then
    echo "โ ุฎุทุฃ: MONGODB_URI ุบูุฑ ูุญุฏุฏ ูู ููู .env"
    exit 1
fi

echo "โ ุชู ุชุญููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ"
echo "๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช: $MONGODB_URI"
echo ""

# ุชุฃููุฏ ุงููุณุชุฎุฏู
read -p "โ๏ธ  ูู ุฃูุช ูุชุฃูุฏ ูู ุชุดุบูู ุงูู Migrationุ (yes/no): " confirm
if [ "$confirm" != "yes" ]; then
    echo "๐ซ ุชู ุฅูุบุงุก ุงูุนูููุฉ"
    exit 0
fi

echo ""
echo "๐ ุฌุงุฑู ุชุดุบูู ุงูู Migration..."
echo ""

# ุชุดุบูู ุงูู Migration
npx ts-node scripts/migrate-add-cities.ts

# ุงูุชุญูู ูู ูุฌุงุญ ุงูุนูููุฉ
if [ $? -eq 0 ]; then
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ ุชูุช ุนูููุฉ ุงูู Migration ุจูุฌุงุญ!"
    echo ""
    echo "๐ ูุง ุชู ุฅูุฌุงุฒู:"
    echo "  โ ุฅุถุงูุฉ ุญูู ุงููุฏููุฉ ูููุณุชุฎุฏููู"
    echo "  โ ุฅุถุงูุฉ ุญูู ุงููุฏููุฉ ูุทูุจุงุช ุงูุฎุฏูุงุช"
    echo "  โ ุชุนููู 'ุตูุนุงุก' ููููุฉ ุงูุชุฑุงุถูุฉ"
    echo "  โ ุฅูุดุงุก ุงูููุงุฑุณ ุงููุทููุจุฉ"
    echo ""
    echo "๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
    echo "  1. ุงุฎุชุจุฑ ุฅูุดุงุก ุทูุจ ุฎุฏูุฉ ุฌุฏูุฏ ูุน ุงููุฏููุฉ"
    echo "  2. ุชุญูู ูู ููุชุฑุฉ ุงูุทูุจุงุช ูููููุฏุณูู"
    echo "  3. ุฑุงุฌุน ุงูุจูุงูุงุช ูู MongoDB Compass"
    echo ""
else
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ ูุดูุช ุนูููุฉ ุงูู Migration!"
    echo ""
    echo "๐ก ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุฃุฎุทุงุก ุฃุนูุงู"
    echo ""
    exit 1
fi

