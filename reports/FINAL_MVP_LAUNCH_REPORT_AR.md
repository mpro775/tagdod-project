## تقرير الإطلاق الأولي (MVP) لمشروع TagDoD

### ملخص تنفيذي
- **الجاهزية العامة**: جيدة جداً لنسخة MVP. البنية الخلفية مكتملة مع وحدات تجارة إلكترونية أساسية، والواجهة مبنية على React + MUI ببنية موديولية. وثائق وتقارير إرشادية متوفرة.
- **أبرز النواقص قبل الإطلاق**: تضبيط أمان وإنتاج (CORS/Rate limiting/TLS/Secrets/CI-CD)، دمج بوابة دفع مع Webhooks، تهيئة التخزين للوسائط، RBAC للوحة التحكم، اختبارات أساسية (Unit/E2E)، ومراقبة الأخطاء والأداء.

### جاهزية الباك إند
- **الإطار**: NestJS 10 مع `@nestjs/config`, `@nestjs/swagger`, `@nestjs/terminus`, `mongoose`, `helmet`, واعتراضات/فلاتر عالمية، و`nestjs-pino` للّوجينغ.
- **تهيئة التطبيق**: CORS عبر خدمة أمن مخصصة، Helmet، فحص المدخلات عبر `ValidationPipe`, تغليف الاستجابات، وSwagger على مسار `docs`.
- **الوحدات المتوفرة**: مصادقة ومستخدمون، عناوين، كتالوج، منتجات، فئات، سمات، سلة، دفع، مفضلة، رفع ملفات، دعم، بحث، تحليلات، أمن، إشعارات، علامات تجارية، لافتات، تسعير، كوبونات.
- **قاعدة البيانات**: MongoDB عبر `MongooseModule` مع إمكانية إضافة فهارس.

### جاهزية الفرونت إند
- **التقنية**: React 19 + Vite + TypeScript + MUI + React Router 7 + React Query + i18next + Zustand.
- **البنية**: موديولية واضحة (`src/features`, `src/shared`, `src/core`, `src/store`). مناسبة لتنفيذ لوحة تحكم وواجهة عميل MVP.

### لوحة التحكم (Admin)
- متطلبات رئيسية: 
  - **RBAC** وتقسيم الأدوار: `Admin`, `Manager`, `Support`.
  - **CRUD** للمنتجات، الفئات، الأسعار/العروض، الكوبونات، المستخدمين، الطلبات.
  - **رفع الوسائط** إلى تخزين خارجي (S3/Wasabi) وروابط CDN موقّتة.
  - **مؤشرات مراقبة بسيطة**: معدل الطلبات/الأخطاء، صحة الخدمات.

### الفجوات الحرجة قبل الإطلاق
- **الأمان والتهيئة**:
  - تقييد CORS لمجالات الإنتاج فقط.
  - تفعيل Rate limiting خصوصاً لمسارات المصادقة والـ checkout.
  - إدارة الأسرار عبر Secret Manager وعدم تخزينها في ملفات.
  - سياسات JWT/Refresh مع تدوير المفاتيح ودعم `kid` عند الحاجة.
  - سياسة رفع الملفات (نوع/حجم) وتخزين خارجي مع روابط موقّتة وحذف آمن.
  - دعم 2FA اختياري لحسابات الإدارة.
- **البنية التحتية/DevOps**:
  - CI/CD: بناء، لينت/اختبارات، نشر تلقائي إلى Staging ثم Prod.
  - صور Docker إنتاجية و`docker-compose.prod.yml` أو Helm على Kubernetes.
  - TLS خلف Nginx/Traefik وإجبار HTTPS.
  - مراقبة: تسجيلات مركزية، قياسات (Prometheus)، تتبع أخطاء (Sentry).
  - صحة وتشغيل: مسارات `/health` و`/ready` متكاملة مع فحوص Redis/Mongo.
- **الدفع (Checkout)**:
  - دمج بوابة دفع واحدة (Stripe/Moyasar/HyperPay) مع Webhooks.
  - حماية Idempotency لطلبات الدفع والتحويل.
- **الإشعارات**:
  - مزوّد Email/SMS/Push، قوالب رسائل، تنبيهات تغيير حالة الطلب.
- **البحث والفهرسة**:
  - فهارس Mongo أساسية (منتجات/نصوص/فئات) أو ربط محرك خارجي عند الضرورة.
- **البيانات والتهيئة**:
  - سكريبتات Seed للمنتجات/الفئات التجريبية.
  - مهاجرات/Change sets للمخططات الحساسة.
- **الاختبارات والجودة**:
  - Unit للخدمات الحرجة (Auth, Products, Checkout).
  - E2E لتدفّقات الدخول والتصفح والسلة والدفع.

### ترابط الباك والفرونت ولوحة التحكم
- توحيد مخطط الاستجابات عبر مغلّف Response، وتوليد عميل TypeScript من Swagger لتقليل أخطاء العقد.
- ضبط `API_BASE_URL` من بيئة الفرونت، وCORS يسمح فقط لمجالات الويب/لوحة التحكم.
- استخدام Cookies httpOnly لحسابات الإدارة، والـ Bearer للتطبيق العام إن لزم.
- الرفع عبر وحدة `upload` إلى تخزين خارجي، والفرونت يستهلك روابط CDN.

### نطاق MVP المقترح
- **كتالوج**: فئات، منتجات بخصائص/صور، ترشيحات وبحث.
- **سلة/دفع**: إضافة/تحديث/حذف، خصومات/كوبونات، عملية دفع عبر مزود واحد.
- **حساب مستخدم**: تسجيل/تسجيل دخول JWT، إدارة العناوين.
- **عروض وكوبونات**: مستوى أساسي.
- **لوحة التحكم**: CRUD للكيانات الأساسية، جدول الطلبات، تقارير يومية بسيطة.
- **إشعارات بريدية**: إنشاء/تحديث حالة الطلب.

### خطة تنفيذ سريعة (أسبوعان)
- **الأسبوع 1**:
  - إعداد إنتاج: Docker + TLS + CORS + Rate limiting + Secrets.
  - دمج الدفع + Webhooks + Seed + فهارس Mongo.
- **الأسبوع 2**:
  - RBAC ولوحة CRUD، ربط S3 للوسائط، Sentry/Logs/Metrics.
  - اختبارات E2E حرجة، مراجعة أمان نهائية.

### معايير جاهزية الإطلاق
- نجاح تدفّقات Staging المطابقة للإنتاج.
- إتمام اختبارات Smoke/E2E: تسجيل الدخول، تصفح، إضافة للسلة، دفع، إصدار كوبون، CRUD منتج.
- مراقبة وتنبيهات نشطة، وصحة الخدمات خضراء.
- P95 < 300ms لنقاط النهاية الحرجة تحت حمل معقول.

### عناصر عمل مقترحة (قائمة مختصرة)
- أمان وإنتاج: CORS مقيد، Rate limiting، Secrets/TLS/CI-CD.
- الدفع: دمج مزوّد واحد + Webhooks + Idempotency.
- الوسائط: ربط S3/Wasabi وروابط موقّتة.
- المراقبة: Sentry وLogs مركزية وDashboards.
- البيانات: Seed + فهارس + مهاجرات.
- الاختبارات: Unit وE2E للتدفّقات الحرجة.
- لوحة التحكم: RBAC + CRUD + إدارة الطلبات.

—
هذا التقرير يغطّي الحد الأدنى اللازم لإطلاق نسخة MVP بثقة، مع إبراز المخاطر والمتطلبات التشغيلية لضمان الاستقرار والأمان.


