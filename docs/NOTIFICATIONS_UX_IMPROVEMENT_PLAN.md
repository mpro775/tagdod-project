# خطة تحسين UX لنظام الإشعارات

## نظرة عامة

هذا المستند يوضح خطة تنفيذ التحسينات على واجهة إدارة الإشعارات وإرسال الإشعارات لجعلها أكثر احترافية وسهولة في الاستخدام.

---

## 1. تحليل المشاكل الحالية

### 1.1 صفحة قائمة الإشعارات (NotificationsListPage)

| المشكلة            | الوصف                                                   |
| ------------------ | ------------------------------------------------------- |
| فلاتر كثيرة        | 5 فلاتر ظاهرة دفعة واحدة (بحث، قناة، حالة، فئة، أولوية) |
| أزرار متعددة       | 4 أزرار رئيسية + حذف جماعي في نفس الشريط                |
| نوافذ منبثقة كثيرة | 6 نوافذ (عرض، تعديل، إنشاء، إرسال جماعي، اختبار)        |
| عدم وضوح الأولوية  | جميع الإجراءات تبدو بنفس الأهمية                        |

### 1.2 نموذج إنشاء إشعار (NotificationCreateForm)

| المشكلة              | الوصف                                         |
| -------------------- | --------------------------------------------- |
| نموذج طويل           | أكثر من 15 حقل في صفحة واحدة                  |
| إعدادات التنقل معقدة | 6 أنواع تنقل مع حقول شرطية متعددة             |
| تكرار الحقول         | actionUrl مع إعدادات التنقل يسبب التباساً     |
| اختيار المستلمين     | اختيار من 100 مستخدم في multi-select غير عملي |

### 1.3 نموذج الإرسال الجماعي (BulkSendForm)

| المشكلة          | الوصف                              |
| ---------------- | ---------------------------------- |
| عدم اتساق        | لا يوجد اختيار قالب                |
| اختيار المستلمين | نفس مشكلة NotificationUserSelector |

### 1.4 نموذج الاختبار (TestNotificationForm)

| المشكلة       | الوصف                                        |
| ------------- | -------------------------------------------- |
| إدخال تقني    | طلب إدخال JSON يدوياً للـ payload            |
| معرف المستخدم | إدخال userId يدوياً بدلاً من اختيار المستخدم |

---

## 2. خطة التنفيذ

### المرحلة 1: تبسيط الفلاتر والإجراءات (أولوية عالية) ✅ منفذة

#### المهام

- [x] **1.1** إخفاء الفلاتر المتقدمة خلف زر "فلاتر متقدمة"

  - الملف: `NotificationFilters.tsx`
  - العرض الافتراضي: بحث + قناة (أو حالة)
  - Collapsible/Accordion للباقي: حالة، فئة، أولوية

- [x] **1.2** تنظيم أزرار الإجراءات

  - الملف: `NotificationFilters.tsx`
  - زر رئيسي واحد: "إرسال إشعار جديد"
  - باقي الإجراءات في قائمة منسدلة "المزيد" (إرسال جماعي، اختبار، تحديث)

- [x] **1.3** إضافة تاريخ للفلاتر (اختياري)
  - دمج startDate و endDate في واجهة فلترة أوضح

---

### المرحلة 2: Wizard متعدد الخطوات للإنشاء (أولوية عالية) ✅ منفذة

#### المهام

- [x] **2.1** إنشاء مكون NotificationCreateWizard

  - الملف الجديد: `NotificationCreateWizard.tsx`
  - استخدام Stepper من MUI

- [x] **2.2** الخطوة 1: اختيار القالب/النوع

  - عرض القوالب كبطاقات أو قائمة
  - اختيار النوع والمسار (نوع إشعار، قناة، فئة)

- [x] **2.3** الخطوة 2: المحتوى

  - العنوان، الرسالة، الرسالة بالإنجليزية
  - معاينة مباشرة (اختياري)

- [x] **2.4** الخطوة 3: المستلمون

  - استخدام المكون المحسّن لاختيار المستلمين

- [x] **2.5** الخطوة 4: خيارات متقدمة (قابلة للطي)

  - التنقل، الأولوية، actionUrl
  - إخفاءها افتراضياً أو في قسم "متقدم"

- [x] **2.6** استبدال NotificationCreateForm بالـ Wizard
  - تحديث NotificationsListPage لاستخدام المكون الجديد

---

### المرحلة 3: تحسين اختيار المستلمين (أولوية عالية) ✅ منفذة

#### المهام

- [x] **3.1** إضافة أزرار اختيار سريع

  - الملف: `NotificationUserSelector.tsx`
  - أزرار: "جميع المستخدمين"، "التجار فقط"، "المهندسون فقط"

- [x] **3.2** دعم رفع ملف CSV

  - حقل لرفع ملف يحتوي على emails أو IDs
  - التحقق من صحة البيانات

- [x] **3.3** دعم إدخال يدوي

  - حقل نصي للـ IDs أو emails مفصولة بفاصلة

- [x] **3.4** استبدال Multi-select بـ Autocomplete
  - بحث مع اقتراحات
  - عرض أفضل للمستخدمين المختارين كـ Chips

---

### المرحلة 4: تبسيط نموذج الاختبار (أولوية متوسطة) ✅ منفذة

#### المهام

- [x] **4.1** استبدال حقل userId بمكون اختيار المستخدم

  - الملف: `TestNotificationForm.tsx`
  - استخدام NotificationUserSelector أو نسخة مبسطة

- [x] **4.2** استبدال JSON بـ حقول ديناميكية

  - استخراج المتغيرات من القالب (مثل {{orderId}})
  - عرض حقل لكل متغير

- [x] **4.3** إضافة معاينة قبل الإرسال
  - عرض كيف سيظهر الإشعار للمستخدم

---

### المرحلة 5: إصلاح صفحة القوالب (أولوية متوسطة) ✅ منفذة

#### المهام

- [x] **5.1** إصلاح نموذج تعديل القالب

  - الملف: `NotificationTemplatesPage.tsx`
  - ربط زر "تحديث" و "إنشاء" بـ onSubmit
  - إضافة state للتحكم في formData

- [x] **5.2** تحسين نافذة الاختبار من البطاقة
  - تمرير القالب تلقائياً
  - تبسيط واجهة الاختبار

---

### المرحلة 6: إزالة التكرار والالتباس (أولوية منخفضة) ✅ منفذة

#### المهام

- [x] **6.1** إخفاء أو دمج actionUrl

  - إخفاء حقل actionUrl من النماذج (يُبنى تلقائياً من إعدادات التنقل)
  - تحديث تلميح الخيارات المتقدمة ليوضح ذلك

- [x] **6.2** توحيد المصطلحات
  - مراجعة ملفات الترجمة (notifications.json)
  - template vs قالب، payload vs البيانات

---

### المرحلة 7: تحسينات الموبايل (أولوية منخفضة) ✅ منفذة

#### المهام

- [x] **7.1** استخدام Bottom Sheet أو Drawer للنماذج

  - Drawer من الأسفل (anchor="bottom") بدلاً من Dialog fullScreen على الموبايل

- [x] **7.2** Tabs للتبديل بين الإجراءات

  - إنشاء | إرسال جماعي | اختبار ضمن Drawer واحد

- [x] **7.3** زر FAB لإرسال إشعار جديد
  - على صفحة قائمة الإشعارات (Mobile only)

---

## 3. جدول الأولويات

| الأولوية | المرحلة              | الجهد المقدر | التأثير              |
| -------- | -------------------- | ------------ | -------------------- |
| عالية    | 2 - Wizard           | 3-4 أيام     | تقليل الإرباك والوقت |
| عالية    | 3 - اختيار المستلمين | 2-3 أيام     | تحسين التدفق اليومي  |
| عالية    | 1 - الفلاتر          | 0.5-1 يوم    | واجهة أنظف           |
| متوسطة   | 4 - نموذج الاختبار   | 1-2 يوم      | تجربة اختبار أسرع    |
| متوسطة   | 5 - صفحة القوالب     | 0.5-1 يوم    | إصلاح أخطاء          |
| منخفضة   | 6 - إزالة التكرار    | 0.5 يوم      | وضوح                 |
| منخفضة   | 7 - الموبايل         | 1-2 يوم      | تجربة جوال أفضل      |

---

## 4. الملفات المتأثرة

```
admin-dashboard/src/features/notifications/
├── components/
│   ├── NotificationFilters.tsx      # المرحلة 1
│   ├── NotificationCreateForm.tsx   # المرحلة 2 (استبدال)
│   ├── NotificationCreateWizard.tsx # المرحلة 2 (جديد)
│   ├── NotificationUserSelector.tsx  # المرحلة 3
│   ├── TestNotificationForm.tsx      # المرحلة 4
│   └── BulkSendForm.tsx              # قد يتأثر بالمرحلة 3
├── pages/
│   ├── NotificationsListPage.tsx     # المرحلة 1، 2
│   └── NotificationTemplatesPage.tsx # المرحلة 5
└── ...
```

---

## 5. معايير النجاح

- [ ] تقليل عدد الحقول الظاهرة في الشاشة الأولى عند إنشاء إشعار
- [ ] إكمال إنشاء إشعار في أقل من 5 خطوات واضحة
- [ ] اختيار المستلمين دون الحاجة للتمرير في قائمة طويلة
- [ ] إمكانية اختبار إشعار بدون إدخال JSON يدوياً
- [ ] تقليل عدد الأزرار المرئية في شريط الإجراءات
- [ ] إصلاح نموذج تعديل القوالب في NotificationTemplatesPage

---

## 6. ملاحظات إضافية

- الحفاظ على التوافق مع الـ API الحالي
- التأكد من دعم RTL للعربية
- اختبار التغييرات على أحجام شاشات مختلفة
- تحديث ملفات الترجمة (ar/en) عند إضافة نصوص جديدة

---

_آخر تحديث: فبراير 2025_
