### مخطط قاعدة البيانات (ERD)

- ملف المخطط: `docs/database/ERD.mmd` (Mermaid). لعرضه استخدم أي عارض Mermaid أو الموقع: `https://mermaid.live`.
- هذا المخطط يعكس نموذج البيانات في الـ Backend (NestJS + Mongoose/MongoDB).

### الكيانات الأساسية والعلاقات

- **User**: يمثل المستخدم. له علاقات مع:
  - `Address` (عناوين المستخدم)
  - `Cart` (السلة الحالية/السابقة)
  - `Order` (الطلبات)
  - `Favorite` (المفضلات)
  - `Media` (الصور/الملفات التي رفعها)

- **Address**: عنوان تابع لـ `User` ويستخدم أثناء إنشاء الطلب.

- **Media**: ملفات وصور مرفوعة، يمكن ربطها بكيانات أخرى مثل `Product`, `Variant`, `Category`.

- **Category**: تصنيف هرمي (أب-ابن) للفئات. كل `Product` ينتمي لفئة واحدة.

- **Brand**: علامة تجارية اختيارية يمكن ربطها بالمنتجات.

- **Attribute / AttributeValue**: سمات المنتج وقيمها (مثل اللون/الحجم). يتم استعمالها ضمن تكوين الـ `Variant`.

- **Product**: المنتج الأساسي، يحتوي بيانات عامة ومتعددة اللغات، ويرتبط بـ `Category` ويدعَم صورًا وسِمات.

- **Variant**: تنويعة المنتج (تركيبة قيم السمات) مع سعر ومخزون وصورة اختيارية.

- **Cart / CartItem**: سلة المستخدم تضم عناصر `Variant` (مع لقطات سعرية ومعلومات منتج مخزنة للسُرعة).

- **Order / OrderItem**: الطلب النهائي المنبثق من السلة، يتضمن العناصر، التسعير التفصيلي، والتتبع.

- **Favorite**: يربط المستخدم أو الجهاز مع منتج/تنويعة محفوظة كمفضلة.

### أهم العلاقات

- `User` 1..* `Address`
- `User` 1..* `Cart`، و`Cart` 1..* `CartItem`
- `User` 1..* `Order`، و`Order` 1..* `OrderItem`
- `Category` 1..* `Product`
- `Product` 1..* `Variant`
- `Attribute` 1..* `AttributeValue`
- `Variant` m..n `AttributeValue` (عبر مصفوفة `attributeValues`)
- `Media` يمكن أن تُستخدم في `Product`, `Variant`, `Category`

### كيفية التحديث

- عند تعديل أي `schema` في الـ Backend (ملفات `*.schema.ts`)، قم بتحديث:
  - ملف `ERD.mmd` إذا أضيفت/حُذفت كيانات أو علاقات أو حقول مهمة.
  - هذا الملف إذا تغيرت أوصاف الجداول/العلاقات.

### ملاحظات تقنية

- قاعدة البيانات المستخدمة: MongoDB عبر Mongoose.
- معظم الكيانات تحتوي `timestamps` (حقول `createdAt`, `updatedAt`).
- تم استخدام فهارس للأداء والبحث (انظر `indexes.md`).
- بعض الحقول تحتوي مراجع `ObjectId` لـ `ref` لتسهيل `populate`.
