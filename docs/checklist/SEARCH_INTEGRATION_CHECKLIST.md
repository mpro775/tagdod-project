# ✅ Search Module Integration Checklist

> قائمة تحقق عملية لضمان تكامل واجهات البحث العامة (المنتجات، الفئات، البراندات، الاقتراحات) مع تطبيق المستخدمين، المهندسين، والتجار، مع استثناء جميع واجهات التحليلات والإدارة.

## كيفية الاستخدام
- نفّذ العناصر في بيئة اختبار متصلة ببيانات منتجات وفئات حقيقية أو Mock عالية الدقة.
- استخدم حسابات متعددة للأدوار المختلفة (User, Engineer, Merchant) للتأكد من سلوك الاستجابة حسب الصلاحيات.
- دوّن الملاحظات أو الأعطال في نهاية كل قسم لضمان المتابعة.

---

## 1. التحضير العام
- [ ] التأكد من نشر `SearchModule` وتهيئة الفهارس الخاصة بالمنتجات، الفئات، والبراندات.
- [ ] تحديث بيانات الفهرسة (reindex) قبل الاختبار لضمان تزامن الصفوف مع قاعدة البيانات.
- [ ] تجهيز بيانات اختبار تغطي حالات متعددة: منتجات نشطة/غير نشطة، أسعار مختلفة، سمات متنوعة، لغتين.
- [ ] التأكد من تفعيل الكاش (إن كان مستخدماً) ومراقبة مدة TTL أثناء الاختبارات.
- [ ] إعداد أدوات مراقبة (Logs/APM) لرصد الاستعلامات الثقيلة أو الأخطاء.

ملاحظات:

---

## 2. نظرة عامة على المسارات العامة

| المسار | الوصف | يتطلب JWT | ملاحظات |
|--------|-------|------------|---------|
| `GET /search` | بحث شامل في المنتجات، الفئات، البراندات | لا | يدعم `q`, `lang`, `entity` |
| `GET /search/products` | بحث منتجات متقدم مع فلاتر متعددة | لا | يدعم السعر، السمات، الفئات، الترتيب |
| `GET /search/suggestions` | اقتراحات نصية based on query | لا | يستخدم للواجهة السريعة |
| `GET /search/autocomplete` | إكمال تلقائي للكلمات | لا | يزيد تجربة البحث المباشر |

> جميع المسارات العامة مفتوحة بدون JWT، لكن يجب التأكد من احترام حالة المنتج (`isActive`) واللغة المختارة.

---

## 3. التحقق المشترك (جميع الأدوار)
- [ ] التأكد من أن `GET /search` يعيد نتائج متنوعة (منتجات، فئات، براندات) مع درجات الصلة (`score` أو ترتيب منطقي).
- [ ] اختبار البحث بكلمات عربية وإنجليزية والتأكد من دعم التبديل عبر `lang`.
- [ ] التحقق من أن `GET /search/products` يدعم الفلاتر التالية:
  - [ ] السعر (`minPrice`, `maxPrice`)
  - [ ] الفئة (`categoryId`)
  - [ ] البراند (`brandId`)
  - [ ] السمات (`attributes`)
  - [ ] الترتيب (`sortBy`, `sortOrder`)
- [ ] مراقبة أن النتائج تستثني المنتجات غير النشطة أو المحذوفة، وأن المخزون يؤثر على الترتيب المخصص إذا تم تفعيله.
- [ ] اختبار `includeFacets=true` والتأكد من أن الأقسام (`facets`) تعود بالعدّ المناسب لكل خيار.
- [ ] مراقبة زمن الاستجابة وضمان بقاء الاستعلامات ضمن الحدود المقبولة (< 500ms في المتوسط إن أمكن).

ملاحظات:

---

## 4. المستخدمون النهائيون (Users)
- [ ] تنفيذ سيناريو بحث كامل في تطبيق المستخدم:
  - [ ] إدخال كلمة بحث والحصول على اقتراحات فورية.
  - [ ] اختيار نتيجة من الاقتراحات والتأكد من الانتقال الصحيح.
  - [ ] عرض صفحة النتائج مع فلاتر جانبية تعمل.
- [ ] تجربة البحث عن منتجات غير متاحة للتأكد من إظهار رسالة "لا توجد نتائج" مع مقترحات بديلة (إن وُجدت).
- [ ] التحقق من أن النقر على نتيجة فئة أو براند يعيد التوجيه إلى الصفحة المناسبة.
- [ ] مراقبة استخدام اللغة: البحث العربي يجب أن يُرجع نتائج عربية أولاً والعكس.

ملاحظات:

---

## 5. المهندسون (Engineers)
- [ ] التأكد من أن المهندس يرى نفس نتائج المستخدم عند استخدام نفس كلمات البحث (ما لم توجد فترات ترويجية مخصصة).
- [ ] اختبار فلاتر السمات أو الفئات الخاصة بالمهندسين (إن وُجدت) والتأكد من ظهورها في `facets`.
- [ ] التأكد من أن نتائج البحث تراعي قدرات المهندس (مثلاً: منتجات مخصصة للمهندسين فقط تظهر عندهم ولا تظهر للمستخدم العادي).
- [ ] مراقبة أن الاقتراحات لا تتضمن عناصر غير مخصصة للمهندس.

ملاحظات:

---

## 6. التجار (Merchants)
- [ ] تنفيذ بحث باستخدام حساب تاجر والتأكد من ظهور المنتجات الخاصة بالجملة (إن وُجدت).
- [ ] التأكد من أن أسعار الجملة أو المعلومات الخاصة لا تظهر في النتائج العامة للمستخدمين الآخرين.
- [ ] اختبار فلاتر مثل `accountType` أو السمات المتعلقة بالتاجر للتأكد من عملها.
- [ ] مراقبة أن الاقتراحات تعكس منتجات التاجر أو عناصر الكتالوج ذات الصلة.

ملاحظات:

---

## 7. التكامل مع الوحدات الأخرى
- [ ] التأكد من أن `Cart` و`Checkout` يستلمان منتجاً صالحاً ومتاحاً تم اختياره من نتائج البحث.
- [ ] اختبار التكامل مع `Marketing` أو `Promotions` للتأكد من إظهار الشارات أو الأسعار المخفضة داخل النتائج عند الحاجة.
- [ ] التأكد من أن `Favorites` تستطيع إضافة العناصر مباشرة من نتائج البحث وتنعكس في القائمة.
- [ ] مراقبة أن أحداث `Search Logs` (إن كانت تبنى عليها تحليلات) تُرسل دون الاعتماد على مسارات الإدارة.

ملاحظات:

---

## 8. تجربة الزائر (Guest Flow)
- [ ] تنفيذ البحث كزائر (بدون JWT) والتأكد من أن النتائج تعكس فقط المحتوى العام.
- [ ] التحقق من أن الزائر لا يرى منتجات أو معلومات خاصة بالأدوار الأخرى.
- [ ] التأكد من أن الاقتراحات تعمل حتى بدون تسجيل الدخول، وأنها تحترم اللغة المختارة.

ملاحظات:

---

## 9. الاستقرار والمراقبة
- [ ] مراقبة معدل أخطاء البحث (استجابات 4xx/5xx) خلال فترة الاختبار.
- [ ] فحص استهلاك الموارد أثناء عمليات البحث المتزامنة لضمان عدم وجود عنق زجاجة.
- [ ] التأكد من أن الكاش يتم تحديثه عند تعديل بيانات المنتج (إضافة/تعديل/حذف) خلال المدة المتوقعة.
- [ ] إعداد تنبيهات عند ارتفاع `zero-results` بشكل غير اعتيادي (قد يشير إلى مشكلة في الفهرسة).

ملاحظات:

---

## 10. متطلبات ما بعد التشغيل
- [ ] تحديث الوثائق الداخلية لفرق الواجهة الأمامية حول المعاملات المدعومة في مسارات البحث.
- [ ] مشاركة نتائج الاختبار مع فرق التسويق لمعرفة الكلمات الشائعة أو التحسينات المطلوبة.
- [ ] جدولة مراجعة دورية للفهرسة (أسبوعية/شهرية) لضمان بقاء البيانات متزامنة مع قاعدة المنتجات.
- [ ] توثيق أي استثناءات أو حلول مؤقتة تم استخدامها أثناء الاختبارات.

ملاحظات:

---

**عند اكتمال هذه العناصر يمكن اعتماد تكامل وحدة البحث عبر جميع الأدوار والأجهزة بثقة.**

