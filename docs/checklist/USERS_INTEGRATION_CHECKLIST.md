# ✅ Users Module Integration Checklist

> قائمة تحقق عملية لضمان تكامل واجهات إدارة المستخدمين وتحليلاتهم مع التطبيقات الداخلية للمستخدمين، المهندسين، التجار، دون تغطية المسارات الإدارية أو التحليلات الخاصة بالإدارة.

## كيفية الاستخدام
- نفّذ الاختبارات في بيئة تحتوي على بيانات واقعية أو Mock متكاملة مع وحدات المصادقة، الطلبات، المفضلة، الدعم، وغيرها.
- ركّز على تجربة المستخدم النهائية للأدوار المختلفة، وتحقق من التحديثات في الخدمات التابعة (النقاط، التفضيلات، التحليلات العامة).
- دوّن الملاحظات أو الأعطال بعد كل قسم لتوثيق النتائج.

---

## 1. التحضير العام
- [ ] تفعيل وحدات `UsersModule`, `AuthModule`, `OrdersModule`, `FavoritesModule`, `SupportModule` في البيئة المستهدفة.
- [ ] تجهيز حسابات اختبار لأدوار `user`, `engineer`, `merchant`, بالإضافة إلى حسابات إدارية لاستخدامها في الخلفية عند الحاجة.
- [ ] التأكد من تفعيل التدفقات المرتبطة (التسجيل، التوثيق، حذف الحساب، تحديث البيانات الشخصية).
- [ ] تهيئة بيانات طلبات، مفضلات، دعم لأغراض الاختبار حتى تنعكس في التحليلات.
- [ ] تفعيل مراقبة السجلات (Logs/APM) لرصد تفاعلات المستخدمين وتحديثات النقاط.

ملاحظات:

---

## 2. المسارات العامة المرتبطة بالمستخدم

| المسار | الوصف | يتطلب JWT | ملاحظات |
|--------|-------|------------|---------|
| `GET /auth/me` | جلب بيانات الحساب الحالية | نعم | يعرض الأدوار والصلاحيات |
| `PATCH /auth/me` | تحديث بيانات الملف الشخصي | نعم | الاسم، الجنس، الوظيفة... |
| `PATCH /auth/preferred-currency` | تحديث العملة المفضلة | نعم | يخزن داخل ملف المستخدم |
| `DELETE /auth/me` | حذف الحساب (Soft Delete) | نعم | يتطلب سبب الحذف |
| `GET /addresses` | جزء من بيانات المستخدم (التأكد من التكامل) | نعم | للتأكد من التكامل مع العناوين |
| `GET /favorites`, `POST /favorites/sync` | تتأثر بملف المستخدم | نعم | للتحقق من المزامنة |
| `GET /orders` | طلبات المستخدم | نعم | للتأكد من التوافق مع التحليلات |

> المسارات الإدارية (`/admin/users`, `/admin/user-analytics/*`) مستبعدة من هذه القائمة لأنها خارج نطاق تجربة المستخدم النهائية.

---

## 3. التحقق المشترك (جميع الأدوار)
- [ ] التسجيل أو التحقق من OTP لمستخدم جديد ثم استدعاء `GET /auth/me` للتأكد من تخزين البيانات الأساسية (الاسم، الهاتف، القدرة).
- [ ] تحديث الملف الشخصي عبر `PATCH /auth/me` ومراقبة انعكاس التغيير فوراً في `GET /auth/me`.
- [ ] تغيير العملة المفضلة والتأكد من أن وحدات أخرى (السلة، التسعير) تستخدم القيمة الجديدة.
- [ ] تنفيذ حذف الحساب (`DELETE /auth/me`) والتأكد من:
  - [ ] تعيين حالة المستخدم إلى `deleted`.
  - [ ] تخزين `deletionReason`.
  - [ ] إزالة أو تحديث القدرات (`capabilities`).
- [ ] التحقق من منع تسجيل الدخول بعد الحذف (حسب التدفق).
- [ ] مراقبة تحديثات النقاط أو التحليلات (إن كانت الواجهة تعرضها) بعد نشاط المستخدم.

ملاحظات:

---

## 4. المستخدمون النهائيون (Users)
- [ ] التحقق من أن بيانات الطلبات (`GET /orders`) والمفضلة (`GET /favorites`) تظهر بشكل صحيح ضمن الملف الشخصي أو صفحات التحليل في الواجهة الأمامية.
- [ ] تنفيذ سيناريوهات شائعة: إكمال طلب، إضافة إلى المفضلة، فتح تذكرة دعم، ثم التحقق من أن صفحات التحليل أو الملخص تعرض هذه المعلومات.
- [ ] التأكد من أن بيانات التقييمات أو النقاط الظاهرة للمستخدم تتوافق مع الحسابات الخلفية (إن كانت الواجهة تعرضها).
- [ ] تجربة حذف الحساب والتأكد من أن الواجهة توضح التأثير (تسجيل الخروج، اختفاء البيانات).

ملاحظات:

---

## 5. المهندسون (Engineers)
- [ ] بعد تسجيل مهندس (عبر `capabilityRequest='engineer'` في المصادقة)، التأكد من أن بياناته تظهر تحت دور المهندس في الواجهة.
- [ ] التحقق من أن أوامر الخدمات (`ServicesModule`) تُحدث ملف المهندس (عدد العروض، الطلبات المكتملة).
- [ ] متابعة `GET /auth/me` للتأكد من احتواء الاستجابة على القدرات (`permissions`, `capabilities`) الخاصة بالمهندس.
- [ ] تجربة تعليق مهندس (من الخلفية) والتأكد من أن تسجيل دخوله يرفض مع رسالة واضحة.

ملاحظات:

---

## 6. التجار (Merchants)
- [ ] تسجيل تاجر أو تحويل مستخدم إلى تاجر والتأكد من انعكاس الدور في `GET /auth/me`.
- [ ] التحقق من أن صفحات التاجر (مثل إدارة المنتجات أو الطلبات بالجملة) تُظهر البيانات الصحيحة المرتبطة بالحساب.
- [ ] مراقبة التحليلات أو المؤشرات الخاصة بالتجار (إن كانت الواجهة تعرضها) بعد تنفيذ نشاط (إنشاء منتجات، استقبال طلبات).
- [ ] اختبار تعليق أو تنشيط تاجر (من الخلفية) ومراقبة تأثير ذلك على تسجيل الدخول والواجهات.

ملاحظات:

---

## 7. التكامل مع الوحدات الأخرى
- [ ] التأكد من أن وحدة الدعم (`SupportModule`) تُظهر تذاكر المستخدم ضمن ملفه أو ملخصاته.
- [ ] التحقق من أن `Favorites`, `Cart`, `Checkout`, `Services` تُحدث سجل المستخدم وتؤثر على النقاط أو التحليلات (إذا كان هناك عرض مخصص).
- [ ] مراقبة أي تداخل مع وحدة التسويق (`Marketing`) أو الحملات الخاصة واختبار تأثيرها على تحليلات المستخدم.
- [ ] التأكد من أن الأحداث المهمة (طلبات جديدة، تذكرة دعم، تقييم) تُسجل في الأنظمة الخارجية أو dashboards المتصلة (إن وجدت).

ملاحظات:

---

## 8. حذف الحساب وإدارة الحالة
- [ ] تجربة سيناريو حذف حساب ذاتياً (`DELETE /auth/me`) والتأكد من تنظيف البيانات المرتبطة (المفضلة، العناوين، القدرات).
- [ ] اختبار إعادة تفعيل المستخدم من الخلفية والتأكد من قدرته على تسجيل الدخول من جديد.
- [ ] التحقق من أن سجل النشاط أو التحليلات يحتفظ بالبيانات التاريخية بعد الحذف (حسب السياسة المتبعة).

ملاحظات:

---

## 9. الاستقرار والمراقبة
- [ ] مراجعة السجلات للتأكد من تسجيل جميع تغييرات حالة المستخدم (إنشاء، تحديث، حذف، تعليق).
- [ ] مراقبة أداء الاستعلامات عند استرجاع بيانات المستخدمين مع العلاقات (طلبات، دعم، مفضلة).
- [ ] تنفيذ اختبار تحميل خفيف على المسارات المرتبطة بالمستخدم للتأكد من تحمل النظام.
- [ ] التحقق من أن أي تحديثات في ملف المستخدم لا تسبب تعارض مع وحدات أخرى (مثل إعادة حساب النقاط).

ملاحظات:

---

## 10. متطلبات ما بعد التشغيل
- [ ] تحديث وثائق فرق الواجهة الأمامية حول الحقول المتاحة في `GET /auth/me` وأي تغييرات في النموذج.
- [ ] مشاركة نتائج الاختبارات مع فرق الدعم والمبيعات لضمان فهم تأثير الحذف النهائي أو تغييرات الأدوار.
- [ ] جدولة مراجعة دورية لملفات المستخدمين للتأكد من اتساق البيانات (خاصة النقاط والتحليلات).
- [ ] توثيق أي حالات استثنائية أو مشكلات أثناء الاختبارات.

ملاحظات:

---

**عند اكتمال العناصر أعلاه يمكن اعتماد تكامل وحدة المستخدمين عبر الأدوار المختلفة بثقة.**

