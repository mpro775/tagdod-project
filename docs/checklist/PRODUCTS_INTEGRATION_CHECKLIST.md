# ✅ Products Module Integration Checklist

> قائمة تحقق عملية للتأكد من تكامل وحدة المنتجات والمتغيرات والتسعير والمخزون مع تطبيق المستخدمين، المهندسين، والتجار، مع استثناء جميع العمليات الإدارية.

## كيفية الاستخدام
- نفّذ العناصر التالية في بيئة اختبار قريبة من الإنتاج (بيانات منتجات حقيقية أو Mock مكافئ).
- سجّل الملاحظات أو الأعطال بعد كل قسم لضمان المتابعة والتوثيق.
- اعتمد على حسابات اختبار لكل دور (User, Engineer, Merchant) بالإضافة إلى سيناريو الزائر عند الحاجة.

---

## 1. التحضير العام
- [ ] التأكد من نشر `ProductsModule` وجميع الخدمات التابعة لها (`VariantService`, `PricingService`, `InventoryService`) في البيئة المستهدفة.
- [ ] تفعيل أو تحديث البيانات المرجعية (فئات، علامات تجارية، خصائص) المرتبطة بالمنتجات.
- [ ] تجهيز منتجات متعددة السيناريوهات: بدون Variants، بمتغير واحد، بمتغيرات متعددة، منتجات مخزون منخفض، منتجات مخزون منتهٍ.
- [ ] التأكد من توافر بيانات التسعير بالعملة الأساسية (`basePriceUSD`) وإعداد محولات العملات (إن كانت مستخدمة في الواجهة).
- [ ] ضبط مهام الكرون أو الخدمات التي تتعامل مع المخزون/التسعير للتأكد من عدم تأثيرها على بيانات الاختبار.

ملاحظات:

---

## 2. نظرة عامة على المسارات (غير الإدارية)

| المسار | الوصف | يتطلب JWT | ملاحظات |
|--------|-------|------------|---------|
| `GET /products` | قائمة المنتجات العامة مع الفلترة والبحث الأساسي | لا | يدعم الاستعلام بالتصنيفات، العلامات، الكلمات الدلالية |
| `GET /products/:id` | تفاصيل منتج واحد مع البيانات العامة | لا | يشمل الصور، الحالة، الإحصاءات |
| `GET /products/:id/variants` | استرجاع متغيرات المنتج الفعّالة | لا | يستبعد المتغيرات غير النشطة أو المحذوفة |
| `GET /products/:id/price-range` | نطاق الأسعار بناءً على المتغيرات النشطة | لا | يعيد الحدين الأدنى والأعلى |
| `GET /products/variants/:id/price` | سعر متغير محدد مع تحويل العملات | لا | يدعم تحديد العملة ونوع الحساب |
| `GET /products/:id/prices` | جميع الأسعار للمتغيرات النشطة | لا | يستخدمه التسعير المتدرج أو عروض الواجهة |
| `GET /products/inventory/low-stock` | منتجات مخزون منخفض (معلومات للواجهة) | نعم (حسب التصميم) | تأكد من سياسة الوصول |
| `GET /products/inventory/out-of-stock` | منتجات نفدت من المخزون | نعم (حسب التصميم) | تستخدم في شاشات التنبيه |
| `GET /products/inventory/summary` | ملخص المخزون المستخدم في اللوحات | نعم (حسب التصميم) | للأدوار المصرح لها فقط |

> إذا كانت بعض مسارات المخزون أو الأسعار مقصورة على أدوار محددة، تأكد من احترام القيود نفسها أثناء الاختبارات.

---

## 3. التحقق المشترك (جميع الأدوار)
- [ ] التأكد من أن `GET /products` يعيد منتجات نشطة فقط، ويستثني المحذوفة أو المؤرشفة.
- [ ] اختبار الترتيب والفلترة (category, brand, status, isFeatured, isNew) والتأكد من دقة النتائج.
- [ ] التحقق من أن `GET /products/:id` يتضمن الحقول الرئيسة (الوصف، الصور، التقييم، الإحصاءات، المتغيرات).
- [ ] التأكد من أن `price-range` يعكس أسعار المتغيرات النشطة فقط، ويحدث عند تفعيل/تعطيل متغير.
- [ ] مراقبة السجلات للتأكد من عدم وجود استعلامات ثقيلة أو أخطاء أثناء جلب المنتجات.
- [ ] اختبار الاستجابات عند طلب منتج غير موجود أو محذوف (يجب أن تعيد 404 أو رسالة واضحة).

ملاحظات:

---

## 4. المستخدمون النهائيون (Users)
- [ ] استعراض قائمة المنتجات مع فلترة حسب الفئة والتأكد من ظهور نتائج صحيحة.
- [ ] فتح صفحة منتج يحتوي على متغيرات متعددة والتأكد من تحديث السعر عند تغيير المتغير في الواجهة (إن كان السلوك مدعومًا).
- [ ] اختبار شراء/إضافة للسلة لمنتج بدون متغيرات (يستخدم `basePriceUSD`) والتأكد من حساب السعر بالشكل الصحيح.
- [ ] التأكد من أن المنتجات المخفية (draft/archived) لا تظهر عبر المسارات العامة.
- [ ] التأكد من ظهور المنتجات ذات المخزون المنخفض مع شارات أو تحذيرات إذا كان ذلك مطلوبًا في الواجهة.

ملاحظات:

---

## 5. المهندسون (Engineers)
- [ ] التأكد من أن المهندس يستطيع رؤية أسعار خاصة (إن كانت هناك خصومات أو تسعير مخصص عبر القدرة).
- [ ] اختبار `GET /products/variants/:id/price` مع `accountType=engineer` والتأكد من عودة السعر المخفض.
- [ ] التحقق من أن المنتجات التي تخص المهندسين فقط (إن وُجدت) تظهر في القائمة ولا تُعرض للمستخدم العادي.
- [ ] تجربة سيناريو انخفاض المخزون وإرسال إشعار (إن كان يعتمد على وحدة الإشعارات) والتأكد من أن البيانات متسقة.

ملاحظات:

---

## 6. التجار (Merchants)
- [ ] التأكد من أن التاجر يرى أسعار wholesale عبر مسارات السعر (تحديد `accountType=wholesale`).
- [ ] اختبار منتجات مخصصة للتجار وضمان عدم ظهورها للمستخدم العادي أو المهندس (إن كانت السياسة تتطلب ذلك).
- [ ] التأكد من أن بيانات المخزون الحالية تسمح للتاجر بمتابعة مستويات المخزون بدقة.
- [ ] اختبار التكامل مع وحدة الطلبات/السلة للتاجر والتأكد من أن الأسعار تطابق ما يعود من واجهات المنتج.

ملاحظات:

---

## 7. الزوار (Guest Flow)
- [ ] استدعاء المسارات العامة بدون JWT والتأكد من استجابة ناجحة.
- [ ] التأكد من أن الزائر لا يحصل على بيانات خاصة (أسعار مهندس/تاجر، مخزون تفصيلي).
- [ ] مراقبة أي محاولات للوصول إلى مسارات مقيدة مثل ملخص المخزون أو الأسعار الخاصة (يجب أن تعيد 401/403).

ملاحظات:

---

## 8. التكامل مع الوحدات الأخرى
- [ ] التأكد من أن `Cart` و`Checkout` يستخدمان المتغير الصحيح والحصول على الأسعار المحدثة.
- [ ] اختبار التكامل مع `Search` للتأكد من أن المنتجات تظهر مع البيانات الصحيحة (السعر، التوفر).
- [ ] التأكد من أن `Marketing` (العروض/الكوبونات) يعمل مع بيانات المنتج والمتغير (خصوصاً `basePriceUSD`).
- [ ] التحقق من أن `Favorites`, `Notifications`, `Analytics` تستخدم الحقول المحدثة للمنتجات والمتغيرات.

ملاحظات:

---

## 9. الاستقرار والمراقبة
- [ ] مراقبة مؤشرات الأداء (زمن الاستجابة، استهلاك الذاكرة) أثناء تحميل قوائم طويلة أو استعلامات معقدة.
- [ ] التأكد من أن الفهارس الموصى بها مفعلة وأن خطة الاستعلام في MongoDB فعّالة.
- [ ] إعداد تنبيهات عند انخفاض المخزون أو نفاده بناءً على الملخصات المتاحة.
- [ ] التحقق من أن مهام التنظيف أو أرشفة المنتجات لا تؤثر على البيانات العامة.

ملاحظات:

---

## 10. متطلبات ما بعد التشغيل
- [ ] تحديث وثائق فرق الواجهة الأمامية حول الحقول المطلوبة لعرض المنتجات والمتغيرات.
- [ ] مشاركة نتائج الاختبارات مع فرق المبيعات/الدعم للتأكد من توافر البيانات اللازمة للعمليات اليومية.
- [ ] جدولة مراجعة دورية (مثلاً شهرية) لقوائم المنتجات للتأكد من اتساق الأسعار والمخزون.
- [ ] توثيق أي استثناءات أو حلول مؤقتة تم تطبيقها أثناء الاختبارات لمرجع مستقبلي.

ملاحظات:

---

**عند اكتمال العناصر أعلاه يمكن اعتماد تكامل وحدة المنتجات عبر جميع الأدوار بثقة.**

