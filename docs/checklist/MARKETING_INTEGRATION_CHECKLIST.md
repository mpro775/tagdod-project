# ✅ Marketing Module Integration Checklist

> قائمة تحقق ميدانية لتجربة تكامل وحدة التسويق (العروض، الكوبونات، البانرات، محرك التسعير) مع تطبيق المستخدمين، المهندسين، والتجار. تستبعد هذه القائمة المسارات الإدارية بالكامل.

## كيفية الاستخدام
- نفّذ الاختبارات في بيئة تحاكي الإنتاج مع بيانات منتجات حقيقية أو Mock واقعية.
- استخدم حسابات تمثل كل دور (User, Engineer, Merchant) بالإضافة إلى تدفق الزائر عند الحاجة.
- دوّن النتائج أو الأعطال في خانة الملاحظات لكل قسم لضمان المتابعة.

---

## 1. التحضير العام
- [ ] التأكد من تفعيل `MarketingModule` واعتمادياته (Products, Pricing, Cart, Checkout).
- [ ] تجهيز بيانات منتجات، فئات، علامات تجارية، ومتغيرات للتجربة (بما في ذلك أسعار متعددة العملات).
- [ ] إعداد حسابات اختبار لأدوار `User`, `Engineer`, `Merchant` مع رموز JWT صالحة.
- [ ] ضبط بيانات كوبونات وعروض تجريبية (نشطة/منتهية/محددة الجمهور) لاستخدامها أثناء الاختبار.
- [ ] إعداد أدوات مراقبة (Logs/APM) لمتابعة تطبيق القواعد وتسجيل الأحداث.

ملاحظات:

---

## 2. نظرة عامة على المسارات (غير الإدارية)

| الفئة | المسار | الوصف | يتطلب JWT | ملاحظات |
|-------|--------|--------|------------|---------|
| التسعير | `GET /marketing/pricing/variant` | حساب السعر الفعلي لمنتج/متغير | لا | يدعم تمرير `accountType`, `currency` |
| القسائم | `GET /marketing/coupons/validate` | التحقق من صلاحية الكوبون للمستخدم الحالي | نعم | يعتمد على سياق المستخدم (الأدوار) |
| البانرات | `GET /marketing/banners` | جلب البانرات النشطة حسب الموقع ونوع المستخدم | اختياري | يُرجع بانرات عامة عند عدم المصادقة |
| البانرات | `GET /marketing/banners/:id/view` | تتبع مشاهدة بانر | اختياري | يستخدم لتحديث `viewCount` |
| البانرات | `GET /marketing/banners/:id/click` | تتبع نقر على بانر | اختياري | يزيد `clickCount` |

> تستبعد هذه القائمة جميع المسارات الإدارية (`/admin/marketing/*`) لأنها خارج نطاق الاختبارات التشغيلية.

---

## 3. التحقق المشترك (جميع الأدوار)
- [ ] التأكد من أن `GET /marketing/pricing/variant` تحترم الأولويات وتعيد السعر بعد تطبيق كل العروض الصالحة.
- [ ] اختبار سيناريو منتج بلا عروض للتأكد من إعادة السعر الأساسي فقط.
- [ ] التحقق من أن `coupon validation` يرفض الكوبونات المنتهية أو المخصصة لأدوار أخرى برسالة واضحة.
- [ ] مراقبة سجلات النظام للتأكد من تسجيل كل تطبيق للخصومات (views, appliedCount, revenue, savings).
- [ ] التأكد من أن قواعد الوقت (`startAt`, `endAt`) تمنع تفعيل العروض قبل أو بعد الوقت المحدد.
- [ ] اختبار تعدد العملات عبر تمرير `currency` مختلفة والتأكد من حساب الأسعار الصحيح.

ملاحظات:

---

## 4. المستخدمون النهائيون (Users)
- [ ] حساب السعر لمنتج عبر `GET /marketing/pricing/variant` مع `accountType=retail` للتأكد من ظهور الخصومات المخصصة للمستخدم.
- [ ] إدخال كوبون عام (`GET /marketing/coupons/validate?code=...`) والتأكد من نجاح التحقق.
- [ ] استخدام كوبون مخصص للمهندسين والتأكد من تلقي رسالة رفض مناسبة.
- [ ] عرض البانرات عبر `GET /marketing/banners?location=home_top` للتحقق من ظهور بانرات المستخدم.
- [ ] تتبع `view` و`click` لبانر والتأكد من زيادة العدادات في السجلات أو قاعدة البيانات.
- [ ] مراقبة تجربة المستخدم الأمامية للتأكد من أن الأسعار المخفضة تظهر في السلة والطلبات.

ملاحظات:

---

## 5. المهندسون (Engineers)
- [ ] تنفيذ طلب `GET /marketing/pricing/variant` مع `accountType=engineer` للتأكد من تطبيق خصومات المهندس.
- [ ] التحقق من أن الكوبونات العامة تعمل، بينما الكوبونات المخصصة للمستخدمين الآخرين تُرفض.
- [ ] طلب `GET /marketing/banners` باستخدام JWT مهندس للتأكد من ظهور بانرات موجهة لهم (إذا وُجدت).
- [ ] التأكد من أن البانرات العامة تظهر للمهندس أيضاً إضافة إلى البانرات المخصصة.
- [ ] تجربة تدفق Checkout/Cart للتأكد من أن التسعير النهائي يتضمن خصومات المهندس من Marketing Module.

ملاحظات:

---

## 6. التجار (Merchants)
- [ ] اختبار التسعير عبر `GET /marketing/pricing/variant` مع `accountType=wholesale` للتأكد من استخدام عروض الجملة.
- [ ] التحقق من أن `coupon validation` يحترم حدود الاستخدام للتاجر (usageLimitPerUser).
- [ ] طلب `GET /marketing/banners` للتأكد من ظهور بانرات التاجر المخصصة (targetUserTypes يحتوي `merchant`).
- [ ] التأكد من أن البانرات العامة تظهر أيضاً للتاجر كخيار افتراضي.
- [ ] مراقبة أن التسعير المرسل للطلبات أو السلة يعكس الخصومات الخاصة بالتجار.

ملاحظات:

---

## 7. الزوار (Guest Flow)
- [ ] استدعاء `GET /marketing/pricing/variant` بدون JWT للتأكد من إعادة الأسعار العامة فقط.
- [ ] عرض البانرات بدون JWT والتأكد من عدم ظهور بانرات مخصصة للأدوار.
- [ ] التحقق من أن `GET /marketing/coupons/validate` يتطلب JWT ويرفض الطلب بدون مصادقة.
- [ ] مراقبة أن تتبع `view/click` يعمل حتى بدون مصادقة (إذا كان مصممًا لذلك).

ملاحظات:

---

## 8. التكامل مع وحدات أخرى
- [ ] التأكد من أن `CartService` يستخدم محرك التسعير لحساب الخصومات في المعاينة (`preview`).
- [ ] اختبار `Checkout` مع كوبون صالح للتأكد من احتساب الخصم وإرسال بيانات الكوبون إلى الطلب.
- [ ] التحقق من أن وحدات الواجهة الأمامية تعرض البانرات حسب `location` و`targetUserTypes`.
- [ ] التأكد من أن نظام الإشعارات (إن وُجد) يستخدم بيانات Marketing لتخصيص الرسائل.
- [ ] مراقبة أن تقارير التحليلات في الوحدات الأخرى تعتمد على إحصاءات Marketing (مثلاً: تتبع العائد من العروض).

ملاحظات:

---

## 9. الاستقرار والمراقبة
- [ ] مراجعة السجلات للتأكد من أن كل تطبيق خصم يسجل `ruleId`, `userId`, `orderId` (إن وُجد).
- [ ] مراقبة أداء `GET /marketing/pricing/variant` تحت حمل متزامن للتأكد من سرعة الاستجابة.
- [ ] إعداد تنبيهات عند تخطي معدلات معينة لرفض الكوبونات (قد يدل على هجوم أو سوء استخدام).
- [ ] التحقق من أن تحديث البانرات والعروض يبطل الكاش في الواجهة الأمامية خلال الزمن المتوقع.
- [ ] التأكد من عدم وجود استثناءات غير معالجة عند استخدام عروض متعددة على نفس المنتج.

ملاحظات:

---

## 10. متطلبات ما بعد التشغيل
- [ ] تحديث توثيق فرق الواجهة الأمامية حول كيفية استخدام `marketing/pricing` و`banners`.
- [ ] مشاركة نتائج الاختبارات مع فرق المبيعات لتأكيد عمل حملاتهم الترويجية.
- [ ] جدولة مراجعة دورية لنظام التسويق مع كل موسم أو حملة كبيرة.
- [ ] توثيق أي استثناءات أو تعديلات يدوية تمت أثناء الاختبارات للرجوع إليها لاحقاً.

ملاحظات:

---

**عند اكتمال العناصر أعلاه يمكن اعتماد تكامل وحدة التسويق عبر جميع الأدوار بثقة.**

