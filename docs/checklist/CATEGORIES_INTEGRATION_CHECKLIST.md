# ✅ Categories Module Integration Checklist

> قائمة تحقق عملية لتأكيد تكامل وحدة الفئات مع تطبيق المستخدمين والمهندسين والتجار. هذه القائمة تغطي المسارات العامة فقط وتستبعد العمليات والصلاحيات الإدارية بشكل كامل.

## كيفية الاستخدام
- استخدم مربعات الاختيار لتتبع سير الاختبارات.
- نفّذ الاختبارات ببيانات قريبة من الإنتاج (صور، نصوص، تسميات متعددة اللغات).
- سجّل أي ملاحظات أو أخطاء أسفل كل قسم لمتابعتها.

---

## 1. التحضير العام
- [ ] إعداد بيانات فئات اختبارية تشمل مستويات متعددة (جذر، فرعي، فرعي من الدرجة الثانية).
- [ ] توفير صور صالحة في Media Library لاستخدامها مع الفئات.
- [ ] التأكد من تفعيل Caching المناسب في بيئة الاختبار (Redis أو in-memory حسب الإعداد).
- [ ] إعداد حسابات اختبار لأدوار `User`, `Engineer`, `Merchant` مع توكنات JWT صالحة (عند الحاجة لتجارب موازية لوحدات أخرى).
- [ ] تفعيل مراقبة السجلات لمراقبة زمن استجابة الاستعلامات وتحديثات الكاش.

ملاحظات:

---

## 2. نظرة عامة على المسارات (غير الإدارية)

| الفئة | المسار | الوصف | يتطلب JWT | ملاحظات |
|-------|--------|--------|------------|---------|
| عام | `GET /categories` | قائمة الفئات النشطة حسب المستوى الأول | لا | يدعم `locale` و`includeMeta`
| عام | `GET /categories/tree` | شجرة الفئات النشطة متعددة المستويات | لا | يستخدم الكاش الذكي
| عام | `GET /categories/:id` | تفاصيل فئة واحدة مع breadcrumbs والأطفال | لا | يقوم بـ populate للصورة والإحصاءات
| عام | `GET /categories/featured/list` | الفئات المميزة فقط | لا | مرتب حسب `order`

> المسارات الإدارية (`/admin/categories/*`) مستبعدة بالكامل من هذه القائمة.

---

## 3. التحقق المشترك (جميع الأدوار)
- [ ] التحقق من أن جميع المسارات العامة تستجيب بدون JWT.
- [ ] اختبار التعامل مع معرّف فئة غير موجود (`GET /categories/:fakeId`) والتأكد من إعادة خطأ 404 منسق.
- [ ] التأكد من أن `slug` يعمل بدلاً من `_id` إذا كانت الخدمة تدعمه (حسب التطبيق).
- [ ] مراقبة زمن الاستجابة قبل وبعد تفعيل الـ cache للتأكد من فعاليته.
- [ ] التحقق من أن الحقول الثنائية اللغة (`name`, `nameEn`, `description`, `descriptionEn`) تظهر حسب `locale` إن كان التبديل مدعوماً.
- [ ] التأكد من أن حقول الإحصاءات (`productsCount`, `childrenCount`) تعكس القيم الفعلية بعد تحديث البيانات.

ملاحظات:

---

## 4. المستخدمون النهائيون (Users)
- [ ] طلب `GET /categories` والتأكد من ظهور الفئات النشطة فقط مع ترتيبها الصحيح.
- [ ] تجربة `GET /categories/tree` للتأكد من:
  - [ ] بناء الشجرة بشكل صحيح (الأب → الأبناء).
  - [ ] استبعاد الفئات غير النشطة أو المحذوفة.
  - [ ] احتواء كل عنصر على children حتى لو كانت فارغة.
- [ ] استخدام `GET /categories/:id` للتأكد من احتواء الاستجابة على:
  - [ ] تفاصيل الفئة.
  - [ ] صورة `imageId` بعد الـ populate (إن وُجدت).
  - [ ] `breadcrumbs` كاملة بدءاً من الجذر.
- [ ] التحقق من أن `GET /categories/featured/list` يعيد فقط الفئات المميزة مرتبة حسب `order`.
- [ ] مراقبة انطباع واجهة المستخدم حول تغيّر اللغة (عند تبديل `locale`) والتأكد من أن البيانات تظهر بالتنسيق الصحيح.

ملاحظات:

---

## 5. المهندسون (Engineers)
- [ ] التأكد من أن المهندس يرى نفس نتائج المستخدم في المسارات العامة (لا توجد فلاتر خاصة).
- [ ] اختبار تكامل وحدة الفئات مع وحدات الخدمات/المنتجات الخاصة بالمهندسين:
  - [ ] التأكد من أن اختيار الفئات في نماذج المهندس يعرض فقط الفئات النشطة.
  - [ ] اختبار سيناريو حيث فئة تصبح غير نشطة والتأكد من أن وحدات المهندس تتعامل معها (على سبيل المثال عدم عرضها في القوائم).
- [ ] مراقبة أي اختلافات في مسارات البحث أو الفلاتر إذا كان المهندس يملك صلاحيات أو بيانات إضافية تعتمد على الفئات.

ملاحظات:

---

## 6. التجار (Merchants)
- [ ] التأكد من أن التاجر يستخدم نفس مجموعة المسارات العامة دون الحاجة إلى صلاحيات إضافية.
- [ ] اختبار تكامل الفئات مع قوائم المنتجات الخاصة بالتجار:
  - [ ] ظهور الفئات النشطة فقط عند إضافة أو تعديل منتج تاجر.
  - [ ] التأكد من أن `productsCount` يتغير عند إضافة/إزالة منتجات بقدرات التاجر.
- [ ] تجربة سيناريو تغيير ترتيب الفئات (في بيئة أخرى) والتأكد من انعكاسه على واجهات التاجر بعد تحديث الكاش.
- [ ] التأكد من أن الفئات المحذوفة لا تظهر ضمن أي قوائم عرض أو تخفيضات خاصة بالتجار.

ملاحظات:

---

## 7. التكامل مع وحدات أخرى
- [ ] التأكد من أن `ProductsModule` (أو أي وحدة منتجات) تستدعي تحديث `categoriesService.incrementProductsCount` عند إضافة/حذف منتج.
- [ ] اختبار وحدة البحث أو التصفية (Search/Filters) للتأكد من أن الفئات تظهر أو تُفلتر بالشكل الصحيح.
- [ ] التحقق من أن الواجهة الأمامية تستخدم `breadcrumbs` لإظهار مسار التنقل في صفحات المنتجات.
- [ ] التأكد من أن أي وحدة تعتمد على `featured categories` (مثل الـ Homepage) تحصل على الترتيب الصحيح عند تحديث الفئات.
- [ ] مراقبة أي تغيّر في الكاش عند تحديث أو استعادة فئة والتأكد من أن المسارات العامة تعكس التغيير فوراً أو بعد مدة TTL.

ملاحظات:

---

## 8. الاستقرار والمراقبة
- [ ] مراجعة السجلات للتأكد من عدم وجود تحذيرات حول استعلامات طويلة أو فقدان Cache.
- [ ] مراقبة معدل ضربات الكاش (hit rate) بعد فترة من الاستخدام.
- [ ] إعداد تنبيهات في حال ارتفاع أخطاء 5xx أو 404 للفئات.
- [ ] التحقق من أن `ResponseCacheInterceptor` لا يخزن استجابات خاطئة (Cache poisoning).
- [ ] تنفيذ اختبار تحميل خفيف على `GET /categories/tree` للتأكد من قدرة الخدمة على التعامل مع عدد كبير من الطلبات.

ملاحظات:

---

## 9. متطلبات ما بعد التشغيل
- [ ] تحديث دليل الواجهة الأمامية لتوثيق كيفية استخدام الحقول الجديدة (breadcrumbs, meta fields).
- [ ] مشاركة نتائج الاختبارات مع فرق المحتوى للتأكد من تلقيهم تحذيرات عند تعطيل أو حذف فئات مهمة.
- [ ] جدولة مراجعة دورية (شهرية/ربع سنوية) لأداء الـ cache والفلاتر الخاصة بالفئات.
- [ ] توثيق أي استثناءات أو حلول مؤقتة تم تنفيذها أثناء الاختبارات.

ملاحظات:

---

**عند اكتمال العناصر أعلاه يمكن اعتماد تكامل وحدة الفئات لجميع الأدوار بثقة.**

