```mermaid
sequenceDiagram
  autonumber
  participant U as User<br/>Flutter App
  participant C as Flutter Client<br/>(WebAuthn Wrapper)
  participant API as Tagdod API<br/>/auth/*
  participant S as BiometricService
  participant DB as MongoDB<br/>User Collection

  rect rgb(240,255,240)
    note right of U: تسجيل الدخول باستخدام جهاز مسجّل بالبصمة
  end

  U->>C: اختيار "تسجيل الدخول بالبصمة"
  C->>API: POST /auth/biometric/login-challenge<br/>{ phone, userAgent? }
  API->>DB: findOne({ phone })
  API->>S: generateLoginChallenge(user, metadata)
  S-->>API: PublicKeyCredentialRequestOptions
  API-->>C: { options }

  C->>C: استدعاء WebAuthn/Passkey API<br/>get assertion
  C-->>U: يطلب بصمة اليد/Face ID
  U-->>C: المصادقة المحلية ناجحة

  C->>API: POST /auth/biometric/login-verify<br/>{ phone, response, userAgent? }
  API->>S: verifyLogin(user, credential, metadata)
  S->>DB: تحديث counter وlastUsedAt
  S-->>API: verified
  API->>API: إصدار Tokens (JWT)
  API-->>C: tokens + me
  C-->>U: الدخول ناجح بالبصمة
```

