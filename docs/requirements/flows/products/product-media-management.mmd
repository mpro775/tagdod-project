%% Product Media Management Flow
%% View at https://mermaid.live
flowchart TD
  A[إدارة وسائط المنتج] --> B{نوع الوسائط?}
  B -->|صورة رئيسية| C[إدارة الصورة الرئيسية]
  B -->|صور إضافية| D[إدارة الصور الإضافية]
  B -->|صور التنويعات| E[إدارة صور التنويعات]

  %% Main Image
  C --> C1[اختيار صورة من مكتبة الوسائط]
  C1 --> C2[mainImageId: معرف الصورة الرئيسية]
  C2 --> C3[حفظ في Product schema]

  %% Additional Images
  D --> D1[اختيار صور متعددة من مكتبة الوسائط]
  D1 --> D2[imageIds: مصفوفة معرفات الصور]
  D2 --> D3[حفظ في Product schema]

  %% Variant Images
  E --> E1[لكل تنويعة منفصلة]
  E1 --> E2[اختيار صورة من مكتبة الوسائط]
  E2 --> E3[imageId: معرف الصورة الخاصة]
  E3 --> E4[حفظ في Variant schema]

  %% Media Library Integration
  F[التكامل مع مكتبة الوسائط] --> F1[تصفح مكتبة الوسائط]
  F1 --> F2[فلترة حسب الفئة PRODUCT]
  F2 --> F3[البحث في الأسماء والأوصاف]
  F3 --> F4[اختيار الصور المطلوبة]

  %% Upload New Media
  G[رفع وسائط جديدة] --> G1[رفع الصور عبر نظام الوسائط]
  G1 --> G2[تصنيف كـ PRODUCT]
  G2 --> G3[إضافة أوصاف ووسوم]
  G3 --> G4[إرجاع المعرفات للربط]

  %% Media Display
  H[عرض الوسائط] --> H1[Product: mainImageId + imageIds]
  H1 --> H2[Variants: imageId لكل variant]
  H2 --> H3[تحميل من مكتبة الوسائط]
  H3 --> H4[عرض في الكتالوج والتفاصيل]

  %% Media Optimization
  I[تحسين الوسائط] --> I1[ضغط الصور تلقائياً]
  I1 --> I2[إنشاء نسخ مختلفة الأحجام]
  I2 --> I3[تحسين للويب]
  I3 --> I4[تخزين في Bunny.net]

  %% Media Metadata
  J[بيانات الوسائط] --> J1[filename: اسم الملف الأصلي]
  J1 --> J2[storedFilename: اسم الملف المخزن]
  J1 --> J3[name: الاسم الوصفي]
  J3 --> J4[mimeType: نوع MIME]
  J4 --> J5[size: حجم الملف]
  J5 --> J6[width, height: أبعاد الصورة]
  J6 --> J7[fileHash: hash للكشف عن التكرار]

  %% Media Usage Tracking
  K[تتبع استخدام الوسائط] --> K1[usageCount: عدد مرات الاستخدام]
  K1 --> K2[usedIn: أين تم الاستخدام]
  K2 --> K3[تتبع المنتجات المستخدمة فيها]

  %% End points
  C3 --> L[نهاية - وسائط محدثة]
  D3 --> L
  E4 --> L
  F4 --> L
  G4 --> L
  H4 --> L
  I4 --> L
  J7 --> L
  K3 --> L
