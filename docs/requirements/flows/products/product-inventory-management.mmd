%% Product Inventory Management Flow
%% View at https://mermaid.live
flowchart TD
  A[إدارة مخزون المنتجات] --> B{نوع العملية?}
  B -->|تحديث المخزون| C[تحديث كميات المخزون]
  B -->|إعدادات المخزون| D[تخصيص إعدادات المخزون]
  B -->|مراقبة المخزون| E[مراقبة حالة المخزون]
  B -->|تنبيهات المخزون| F[إدارة تنبيهات المخزون]

  %% Update Stock
  C --> C1[تحديد التنويعة المراد تحديثها]
  C1 --> C2[إدخال الكمية الجديدة]
  C2 --> C3[تحديث stock في Variant schema]
  C3 --> C4[تسجيل التغيير]

  %% Inventory Settings
  D --> D1[minStock: الحد الأدنى للمخزون]
  D1 --> D2[trackInventory: تفعيل/إلغاء التتبع]
  D2 --> D3[allowBackorder: السماح بالطلب المسبق]
  D3 --> D4[حفظ الإعدادات]

  %% Monitor Inventory
  E --> E1[فحص المخزون الحالي]
  E1 --> E2[مقارنة مع minStock]
  E2 --> E3[تحديد حالة المخزون]
  E3 --> E4[إرجاع تقرير المخزون]

  %% Stock Alerts
  F --> F1[المنتجات ذات المخزون المنخفض]
  F1 --> F2[المنتجات التي نفد مخزونها]
  F2 --> F3[إرسال إشعارات للإدارة]

  %% Stock Status Logic
  G[منطق حالة المخزون] --> G1{stock > minStock?}
  G1 -->|نعم| G2[مخزون طبيعي]
  G1 -->|لا| G3{stock > 0?}
  G3 -->|نعم| G4[مخزون منخفض]
  G3 -->|لا| G5[نفد المخزون]

  %% Backorder Logic
  H[منطق الطلب المسبق] --> H1{allowBackorder = true?}
  H1 -->|نعم| H2[السماح بالطلب حتى لو نفد المخزون]
  H1 -->|لا| H3[عدم السماح بالطلب عند نفاد المخزون]

  %% Availability Check
  I[فحص التوفر] --> I1{trackInventory = true?}
  I1 -->|نعم| I2[فحص الكمية الفعلية]
  I1 -->|لا| I3[دائماً متاح]
  I2 --> I4{stock > 0?}
  I4 -->|نعم| I5[متاح]
  I4 -->|لا| I6{allowBackorder = true?}
  I6 -->|نعم| I7[متاح للطلب المسبق]
  I6 -->|لا| I8[غير متاح]

  %% Integration with Orders
  J[التكامل مع الطلبات] --> J1[تقليل المخزون عند تأكيد الطلب]
  J1 --> J2[زيادة المخزون عند إلغاء الطلب]
  J2 --> J3[مراقبة التغييرات]

  %% Reporting
  K[التقارير] --> K1[ملخص المخزون العام]
  K1 --> K2[المنتجات ذات المخزون المنخفض]
  K2 --> K3[المنتجات التي نفد مخزونها]
  K3 --> K4[اتجاهات المخزون]

  %% Bulk Operations
  L[العمليات الجماعية] --> L1[تحديث مخزون منتجات متعددة]
  L1 --> L2[ضبط إعدادات المخزون لفئة]
  L2 --> L3[استيراد/تصدير بيانات المخزون]

  %% End points
  C4 --> M[نهاية - مخزون محدث]
  D4 --> M
  E4 --> M
  F3 --> M
  G2 --> M
  G4 --> M
  G5 --> M
  H2 --> M
  H3 --> M
  I5 --> M
  I7 --> M
  I8 --> M
  I3 --> M
  J3 --> M
  K4 --> M
  L3 --> M
