%% Product Catalog Display Flow
%% View at https://mermaid.live
flowchart TD
  A[عرض كتالوج المنتجات] --> B{نوع العرض?}
  B -->|قائمة عامة| C[عرض قائمة المنتجات]
  B -->|تفاصيل منتج| D[عرض تفاصيل منتج محدد]
  B -->|منتجات مميزة| E[عرض المنتجات المميزة]
  B -->|منتجات جديدة| F[عرض المنتجات الجديدة]

  %% Product List
  C --> C1[استعلام المنتجات النشطة]
  C1 --> C2[تطبيق الفلاتر والفرز]
  C2 --> C3[تطبيق البحث النصي]
  C3 --> C4[تقسيم النتائج لصفحات]
  C4 --> C5[إرجاع قائمة المنتجات]

  %% Product Details
  D --> D1[البحث عن المنتج بالمعرف أو الـ slug]
  D1 --> D2[التحقق من الحالة ACTIVE]
  D2 --> D3[تحميل التنويعات النشطة]
  D3 --> D4[تحميل الصور من مكتبة الوسائط]
  D4 --> D5[حساب نطاق الأسعار]
  D5 --> D6[إرجاع تفاصيل شاملة]

  %% Featured Products
  E --> E1[فلترة المنتجات حيث isFeatured = true]
  E1 --> E2[ترتيب حسب order ثم createdAt]
  E2 --> E3[تقييد العدد المطلوب]
  E3 --> E4[إرجاع قائمة المنتجات المميزة]

  %% New Products
  F --> F1[فلترة المنتجات حيث isNew = true]
  F1 --> F2[ترتيب حسب createdAt تنازلياً]
  F2 --> F3[تقييد العدد المطلوب]
  F3 --> F4[إرجاع قائمة المنتجات الجديدة]

  %% Filtering Options
  G[خيارات الفلترة] --> G1[categoryId: فلترة حسب التصنيف]
  G1 --> G2[brandId: فلترة حسب العلامة التجارية]
  G2 --> G3[priceRange: فلترة حسب النطاق السعري]
  G3 --> G4[status: فلترة حسب الحالة]

  %% Search Options
  H[خيارات البحث] --> H1[name: بحث في الاسم العربي]
  H1 --> H2[nameEn: بحث في الاسم الإنجليزي]
  H2 --> H3[description: بحث في الوصف العربي]
  H3 --> H4[descriptionEn: بحث في الوصف الإنجليزي]

  %% Sorting Options
  I[خيارات الترتيب] --> I1[createdAt: حسب تاريخ الإنشاء]
  I1 --> I2[price: حسب السعر]
  I2 --> I3[salesCount: حسب عدد المبيعات]
  I3 --> I4[viewsCount: حسب عدد المشاهدات]
  I4 --> I5[order: حسب الترتيب المخصص]

  %% Pagination
  J[الصفحات] --> J1[page: رقم الصفحة]
  J1 --> J2[limit: عدد العناصر لكل صفحة]
  J2 --> J3[skip: حساب العناصر المراد تجاهلها]
  J3 --> J4[total: إجمالي عدد النتائج]

  %% Response Structure
  K[هيكل الاستجابة] --> K1[products: مصفوفة المنتجات]
  K1 --> K2[pagination: معلومات الصفحات]
  K2 --> K3[filters: الفلاتر المتاحة]
  K3 --> K4[totalCount: إجمالي العدد]

  %% Performance Optimization
  L[تحسين الأداء] --> L1[indexes محسنة للبحث]
  L1 --> L2[تخزين مؤقت للاستعلامات الشائعة]
  L2 --> L3[تحميل الصور عند الحاجة]

  %% End points
  C5 --> M[نهاية - قائمة المنتجات]
  D6 --> M
  E4 --> M
  F4 --> M
