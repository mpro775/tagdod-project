%% Product Creation with Variants Detailed Flow
%% View at https://mermaid.live
flowchart TD
  A[إنشاء منتج جديد] --> B[إدخال المعلومات الأساسية]
  B --> B1[name: الاسم بالعربية]
  B1 --> B2[nameEn: الاسم بالإنجليزية]
  B2 --> B3[slug: رابط URL فريد]
  B3 --> B4[description: الوصف بالعربية]
  B4 --> B5[descriptionEn: الوصف بالإنجليزية]

  B5 --> C[اختيار التصنيف والعلامة التجارية]
  C --> C1[categoryId: معرف التصنيف]
  C1 --> C2[brandId: معرف العلامة التجارية - اختياري]

  C2 --> D[تحديد السمات المستخدمة]
  D --> D1[attributes: مصفوفة معرفات السمات]
  D1 --> D2[مثال: اللون، المقاس، المادة]

  D2 --> E[إضافة الوسائط]
  E --> E1[mainImageId: الصورة الرئيسية]
  E1 --> E2[imageIds: صور إضافية]
  E2 --> E3[ربط بالنظام الوسائط]

  E3 --> F[إنشاء التنويعات]
  F --> F1[لكل تركيبة سمات]
  F1 --> F2[attributeValues: قيم السمات]
  F2 --> F3[basePriceUSD: السعر الأساسي]
  F3 --> F4[compareAtPriceUSD: سعر المقارنة - اختياري]
  F4 --> F5[costPriceUSD: سعر التكلفة - اختياري]

  F5 --> G[إعداد المخزون]
  G --> G1[stock: الكمية المتاحة]
  G1 --> G2[minStock: الحد الأدنى]
  G2 --> G3[trackInventory: تتبع المخزون]
  G3 --> G4[allowBackorder: السماح بالطلب المسبق]

  G4 --> H[إعدادات إضافية]
  H --> H1[sku: رمز المنتج الفريد - اختياري]
  H1 --> H2[weight: الوزن بالجرام]
  H2 --> H3[length, width, height: الأبعاد]
  H3 --> H4[imageId: صورة خاصة بالتنويعة]

  H4 --> I[إعدادات SEO]
  I --> I1[metaTitle: عنوان SEO]
  I1 --> I2[metaDescription: وصف SEO]
  I2 --> I3[metaKeywords: كلمات مفتاحية]

  I3 --> J[إعدادات العرض]
  J --> J1[order: ترتيب العرض]
  J1 --> J2[isFeatured: منتج مميز]
  J2 --> J3[isNew: منتج جديد]
  J3 --> J4[isBestseller: الأكثر مبيعاً]

  J4 --> K[حفظ المنتج]
  K --> K1[status: DRAFT - مسودة]
  K1 --> K2[createdAt, updatedAt: التوقيتات]

  K2 --> L{هل جاهز للنشر?}
  L -->|نعم| M[تغيير الحالة إلى ACTIVE]
  L -->|لا| N[البقاء كمسودة]

  M --> O[تحديث variantsCount]
  N --> O

  O --> P[إنشاء indexes للبحث]
  P --> Q[Product جاهز للاستخدام]

  %% Product Structure
  R[هيكل المنتج النهائي] --> R1[Product + Variants متعددة]
  R1 --> R2[كل Variant له سعر ومخزون منفصل]
  R2 --> R3[تركيبات سمات مختلفة]

  %% End point
  Q --> S[نهاية - منتج تم إنشاؤه بنجاح]
