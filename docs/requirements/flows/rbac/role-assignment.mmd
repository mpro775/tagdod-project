%% Role Assignment Flow
%% View at https://mermaid.live
flowchart TD
  A[تعيين الأدوار] --> B{نوع العملية?}
  B -->|إنشاء مستخدم| C[Create User]
  B -->|تحديث أدوار| D[Update Roles]
  B -->|إدارة الحالة| E[Manage Status]
  B -->|حذف مستخدم| F[Delete User]

  %% Create User
  C --> C1[إدخال بيانات المستخدم]
  C1 --> C2[phone: رقم الهاتف - مطلوب]
  C2 --> C3[firstName, lastName: الأسماء - اختياري]
  C3 --> C4[roles: الأدوار - افتراضي ['user']]
  C4 --> C5[permissions: الصلاحيات - اختياري]
  C5 --> C6[حفظ في قاعدة البيانات]
  C6 --> C7[إنشاء سجل في Capabilities]

  %% Update Roles
  D --> D1[تحديد المستخدم]
  D1 --> D2[تحديث مصفوفة roles]
  D2 --> D3[تحديث مصفوفة permissions]
  D3 --> D4[حفظ التغييرات]
  D4 --> D5[تحديث Capabilities إذا لزم الأمر]

  %% Manage Status
  E --> E1[تعليق الحساب]
  E1 --> E2[status: SUSPENDED]
  E2 --> E3[suspendedAt: التاريخ]
  E3 --> E4[suspendedBy: معرف الإداري]
  E4 --> E5[suspendedReason: السبب]

  E --> E6[إلغاء التعليق]
  E6 --> E7[status: ACTIVE]
  E7 --> E8[مسح حقول التعليق]

  %% Delete User
  F --> F1[حذف ناعم]
  F1 --> F2[deletedAt: التاريخ]
  F2 --> F3[deletedBy: معرف الإداري]
  F3 --> F4[status: DELETED]

  %% User Status Transitions
  G[انتقالات حالة المستخدم] --> H[ACTIVE ↔ SUSPENDED]
  H --> I[ACTIVE → DELETED]
  I --> J[PENDING → ACTIVE]
  J --> K[DELETED - نهائي]

  %% Role Hierarchy
  L[تسلسل الأدوار] --> M[USER - أساسي]
  M --> N[ENGINEER - متخصص]
  N --> O[MERCHANT - تجاري]
  O --> P[ADMIN - إداري]
  P --> Q[SUPER_ADMIN - عام]

  %% Bulk Operations
  R[العمليات الجماعية] --> R1[تحديث أدوار متعددة]
  R1 --> R2[تعليق حسابات متعددة]
  R2 --> R3[تصدير/استيراد بيانات المستخدمين]

  %% Audit Logging
  S[تسجيل العمليات] --> S1[تسجيل إنشاء المستخدمين]
  S1 --> S2[تسجيل تغييرات الأدوار]
  S2 --> S3[تسجيل تغييرات الحالة]
  S3 --> S4[تسجيل عمليات الحذف]

  %% End points
  C7 --> T[نهاية - مستخدم تم إنشاؤه]
  D5 --> T
  E5 --> T
  E8 --> T
  F4 --> T
  R3 --> T
  S4 --> T
