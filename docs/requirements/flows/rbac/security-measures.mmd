%% Security Measures Flow
%% View at https://mermaid.live
flowchart TD
  A[إجراءات الأمان] --> B{نوع التهديد?}
  B -->|وصول غير مصرح| C[Access Control]
  B -->|تزوير الهوية| D[Authentication Security]
  B -->|تسريب البيانات| E[Data Protection]
  B -->|هجمات الشبكة| F[Network Security]
  B -->|نشاط مشبوه| G[Audit & Monitoring]

  %% Access Control
  C --> C1[JWT Token Validation]
  C1 --> C2[Role-based Authorization]
  C2 --> C3[Permission Checks]
  C3 --> C4[Resource Ownership Verification]

  %% Authentication Security
  D --> D1[OTP via SMS]
  D1 --> D2[JWT Token Signing]
  D2 --> D3[Token Expiration]
  D3 --> D4[Secure Password Hashing]

  %% Data Protection
  E --> E1[Password Hashing with bcrypt]
  E1 --> E2[JWT Secret Keys]
  E2 --> E3[Environment Variables]
  E3 --> E4[No Plain Text Storage]

  %% Network Security
  F --> F1[HTTPS Only]
  F1 --> F2[CORS Configuration]
  F2 --> F3[Rate Limiting]
  F3 --> F4[Input Validation]

  %% Audit & Monitoring
  G --> G1[User Activity Logging]
  G1 --> G2[Failed Login Attempts]
  G2 --> G3[Permission Changes]
  G3 --> G4[Security Alerts]

  %% JWT Security
  H[JWT Security] --> H1[HMAC SHA256 Signing]
  H1 --> H2[Token Expiration - 24h]
  H2 --> H3[Secure Secret Key]
  H3 --> H4[Payload Encryption]

  %% Password Security
  I[Password Security] --> I1[bcrypt Hashing]
  I1 --> I2[Minimum Length Requirements]
  I2 --> I3[Complexity Rules]
  I3 --> I4[Secure Reset Process]

  %% OTP Security
  J[OTP Security] --> J1[6-digit Codes]
  J1 --> J2[5-minute Expiration]
  J2 --> J3[SMS Delivery]
  J3 --> J4[Rate Limiting per Phone]

  %% Data Encryption
  K[Data Encryption] --> K1[Passwords: bcrypt]
  K1 --> K2[JWT: HMAC SHA256]
  K2 --> K3[Sensitive Data: AES]
  K3 --> K4[Database: MongoDB Security]

  %% Network Protection
  L[Network Protection] --> L1[HTTPS Enforcement]
  L1 --> L2[CORS Policy]
  L2 --> L3[Helmet.js Security Headers]
  L3 --> L4[Rate Limiting]

  %% Monitoring & Alerts
  M[Monitoring & Alerts] --> M1[Login Attempts]
  M1 --> M2[Failed Authentications]
  M2 --> M3[Role Changes]
  M3 --> M4[Suspicious Activities]

  %% Incident Response
  N[Incident Response] --> N1[Security Breach Detection]
  N1 --> N2[Account Lockout]
  N2 --> N3[Admin Notifications]
  N3 --> N4[Audit Log Review]

  %% End points
  C4 --> O[نهاية - آمن]
  D4 --> O
  E4 --> O
  F4 --> O
  G4 --> O
  N4 --> O
