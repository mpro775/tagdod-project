%% RBAC System Overview
%% View at https://mermaid.live
flowchart TD
  A[نظام RBAC] --> B{نوع المكون?}
  B -->|المصادقة| C[Authentication System]
  B -->|الأدوار| D[Roles & Permissions]
  B -->|القدرات| E[Capabilities System]
  B -->|الأمان| F[Security Measures]

  %% Authentication System
  C --> C1[OTP via SMS]
  C1 --> C2[JWT Token Generation]
  C2 --> C3[Token Validation]
  C3 --> C4[User Session Management]

  %% Roles & Permissions
  D --> D1[User Roles Array]
  D1 --> D2[Permissions Array]
  D2 --> D3[Role-based Access]
  D3 --> D4[Permission Checks]

  %% Capabilities System
  E --> E1[Capabilities Schema]
  E1 --> E2[Status Management]
  E2 --> E3[Approval Workflow]
  E3 --> E4[Role Activation]

  %% Security Measures
  F --> F1[JWT Guards]
  F1 --> F2[Data Encryption]
  F2 --> F3[Audit Logging]
  F3 --> F4[Access Control]

  %% User Roles
  G[الأدوار المتاحة] --> H[USER - مستخدم عادي]
  H --> I[ADMIN - مدير]
  I --> J[SUPER_ADMIN - مدير عام]
  J --> K[MERCHANT - تاجر]
  K --> L[ENGINEER - مهندس]

  %% Capabilities Status
  M[حالات القدرات] --> N[NONE - لا توجد]
  N --> O[PENDING - في انتظار]
  O --> P[APPROVED - معتمد]
  P --> Q[REJECTED - مرفوض]

  %% Permission Checks
  R[فحص الصلاحيات] --> S{hasRole?}
  S -->|نعم| T[Allow Access]
  S -->|لا| U{hasPermission?}
  U -->|نعم| T
  U -->|لا| V[Deny Access]

  %% End points
  T --> W[نهاية - الوصول مسموح]
  V --> W
  Q --> W
  L --> W
  F4 --> W
