%% Capabilities Management Flow
%% View at https://mermaid.live
flowchart TD
  A[إدارة القدرات] --> B{نوع العملية?}
  B -->|طلب قدرة| C[Request Capability]
  B -->|مراجعة الطلبات| D[Review Requests]
  B -->|الموافقة على الطلب| E[Approve Request]
  B -->|رفض الطلب| F[Reject Request]

  %% Request Capability
  C --> C1[تحديد نوع القدرة]
  C1 --> C2[Engineer/Wholesale/Admin]
  C2 --> C3[إنشاء سجل في Capabilities]
  C3 --> C4[تحديث الحالة إلى PENDING]
  C4 --> C5[إشعار الإدارة]

  %% Review Requests
  D --> D1[عرض جميع الطلبات PENDING]
  D1 --> D2[مراجعة بيانات المستخدم]
  D2 --> D3[فحص المؤهلات]
  D3 --> D4[قرار الموافقة أو الرفض]

  %% Approve Request
  E --> E1[تحديث الحالة إلى APPROVED]
  E1 --> E2[تفعيل القدرة]
  E2 --> E3[إضافة الدور المناسب]
  E3 --> E4[إعداد الخصومات إذا لزم الأمر]
  E4 --> E5[إشعار المستخدم]

  %% Reject Request
  F --> F1[تحديث الحالة إلى REJECTED]
  F1 --> F2[إشعار المستخدم بالرفض]
  F2 --> F3[إمكانية إعادة الطلب]

  %% Capability Types
  G[أنواع القدرات] --> H[Engineer Capability]
  H --> H1[engineer_capable: boolean]
  H1 --> H2[engineer_status: NONE/PENDING/APPROVED/REJECTED]

  G --> I[Wholesale Capability]
  I --> I1[wholesale_capable: boolean]
  I1 --> I2[wholesale_status: NONE/PENDING/APPROVED/REJECTED]
  I2 --> I3[wholesale_discount_percent: 0-100]

  G --> J[Admin Capability]
  J --> J1[admin_capable: boolean]
  J1 --> J2[admin_status: NONE/PENDING/APPROVED/REJECTED]

  %% Status Transitions
  K[انتقالات الحالة] --> L[NONE → PENDING]
  L --> M[PENDING → APPROVED]
  M --> N[PENDING → REJECTED]
  N --> O[APPROVED → REJECTED - إلغاء]

  %% Role Mapping
  P[ربط القدرات بالأدوار] --> Q[APPROVED Engineer → ENGINEER role]
  Q --> R[APPROVED Wholesale → MERCHANT role]
  R --> S[APPROVED Admin → ADMIN role]

  %% End points
  C5 --> T[نهاية - طلب مرسل]
  E5 --> T
  F3 --> T
  S --> T
