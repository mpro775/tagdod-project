%% User Behavior Flow
%% View at https://mermaid.live
flowchart TD
  A[تحليل سلوك المستخدمين] --> B[تتبع النشاط]
  A --> C[تحليل السلوك]
  A --> D[إحصائيات السلوك]

  %% Activity Tracking
  B --> B1[User Behavior Service]
  B1 --> B2[trackUserActivity]
  B2 --> B3[تسجيل النشاط]
  B3 --> B4[userId, action, metadata]
  B4 --> B5[timestamp, sessionId]

  B5 --> B6[أنواع النشاط]
  B6 --> B7[login, logout, page_view]
  B7 --> B8[order_created, service_requested]
  B8 --> B9[support_ticket, profile_update]

  %% Behavior Analysis
  C --> C1[analyzeUserBehavior]
  C1 --> C2[تحليل الأنماط]
  C2 --> C3[تكرار النشاط]
  C3 --> C4[أوقات النشاط]
  C4 --> C5[الميزات المستخدمة]

  C5 --> C6[تحليل المخاطر]
  C6 --> C7[مخاطر عدم النشاط]
  C7 --> C8[lastActivityAt comparison]
  C8 --> C9[تحذير من التوقف]

  %% Behavior Statistics
  D --> D1[getUserBehaviorStats]
  D1 --> D2[إحصائيات شاملة]
  D2 --> D3[عدد الجلسات]
  D3 --> D4[متوسط مدة الجلسة]
  D4 --> D5[أكثر الميزات استخداماً]

  D5 --> D6[إحصائيات زمنية]
  D6 --> D7[يومي، أسبوعي، شهري]
  D7 --> D8[اتجاهات النشاط]

  %% Caching
  E[التخزين المؤقت] --> E1[User Cache Service]
  E1 --> E2[cacheUserData]
  E2 --> E3[تحسين الأداء]
  E3 --> E4[تقليل الاستعلامات]

  %% Error Handling
  F[معالجة الأخطاء] --> F1[User Error Service]
  F1 --> F2[logUserError]
  F2 --> F3[تحليل الأخطاء]
  F3 --> F4[تحسين تجربة المستخدم]

  %% End points
  D8 --> G[نهاية - تحليل سلوك شامل]
  F4 --> G
