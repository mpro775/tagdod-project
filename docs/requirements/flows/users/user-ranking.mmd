%% User Ranking Flow
%% View at https://mermaid.live
flowchart TD
  A[ترتيب المستخدمين] --> B[نظام النقاط]
  A --> C[ترتيب العملاء]
  A --> D[إحصائيات الترتيب]

  %% Scoring System
  B --> B1[User Scoring Service]
  B1 --> B2[calculateUserScore]
  B2 --> B3[عوامل التقييم]
  B3 --> B4[Orders: عدد وحالة الطلبات]
  B4 --> B5[Revenue: الإيرادات المحققة]
  B5 --> B6[Activity: مستوى النشاط]
  B6 --> B7[Support: جودة الدعم]

  B7 --> B8[معاملات مرجحة]
  B8 --> B9[ordersWeight, revenueWeight]
  B9 --> B10[activityWeight, supportWeight]

  B10 --> B11[حساب النقاط الإجمالية]
  B11 --> B12[Math.min(100, totalScore)]
  B12 --> B13[نقاط بين 0-100]

  %% Customer Rankings
  C --> C1[GET /admin/user-analytics/customer-rankings]
  C1 --> C2[ترتيب العملاء]
  C2 --> C3[حسب النقاط التنازلي]
  C3 --> C4[قائمة مرتبة]
  C4 --> C5[معلومات العميل]
  C5 --> C6[النقاط والمركز]

  %% Ranking Statistics
  D --> D1[إحصائيات الترتيب]
  D1 --> D2[توزيع النقاط]
  D2 --> D3[0-20, 21-40, 41-60, 61-80, 81-100]
  D3 --> D4[عدد المستخدمين في كل شريحة]

  D4 --> D5[إحصائيات الأداء]
  D5 --> D6[متوسط النقاط]
  D6 --> D7[أعلى وأدنى نقاط]
  D7 --> D8[توزيع النسب المئوية]

  %% Dynamic Updates
  E[تحديثات ديناميكية] --> E1[حساب دوري]
  E1 --> E2[تحديث النقاط]
  E2 --> E3[تحديث الترتيب]
  E3 --> E4[تخزين في Cache]

  %% Integration
  F[التكامل] --> F1[مع نظام الطلبات]
  F1 --> F2[مع نظام الخدمات]
  F2 --> F3[مع نظام الدعم]
  F3 --> F4[مع نظام التحليلات]

  %% End points
  D8 --> G[نهاية - ترتيب شامل]
  F4 --> G
