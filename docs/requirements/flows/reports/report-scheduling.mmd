%% Report Scheduling Flow
%% View at https://mermaid.live
flowchart TD
  A[جدولة تقرير] --> B[تحديد نوع التقرير]
  B --> B1[Sales Report, User Analytics, etc.]
  B1 --> C[تحديد الجدولة]
  C --> C1[frequency: daily/weekly/monthly]
  C1 --> C2[time: وقت التنفيذ]
  C2 --> C3[recipients: قائمة المستلمين]

  C3 --> D[تحديد الفلاتر]
  D --> D1[dateRange: نطاق التاريخ]
  D1 --> D2[filters: فلاتر إضافية]
  D2 --> D3[format: JSON/PDF/Excel/CSV]

  D3 --> E[حفظ في قاعدة البيانات]
  E --> E1[إنشاء سجل ReportSchedule]
  E1 --> E2[معرف فريد للجدولة]
  E2 --> E3[حالة ACTIVE]

  E3 --> F[تسجيل المهمة المجدولة]
  F --> F1[إضافة لـ Cron Job]
  F1 --> F2[تحديد التكرار والوقت]

  F2 --> G[تنفيذ المهام المجدولة]
  G --> G1[فحص المهام المستحقة]
  G1 --> G2[تنفيذ التقرير]
  G2 --> G3[توليد الملف]
  G3 --> G4[إرسال للمستلمين]

  G4 --> H[تحديث حالة المهمة]
  H --> H1[lastExecutedAt: وقت آخر تنفيذ]
  H1 --> H2[nextExecutionAt: وقت التنفيذ التالي]
  H2 --> H3[executionCount: عدد مرات التنفيذ]

  %% Error Handling
  I[معالجة الأخطاء] --> I1[فشل في توليد التقرير]
  I1 --> I2[تسجيل الخطأ]
  I2 --> I3[إشعار المسؤولين]
  I3 --> I4[إعادة المحاولة حسب الإعدادات]

  %% Management
  J[إدارة الجدولة] --> J1[عرض التقارير المجدولة]
  J1 --> J2[تعديل الإعدادات]
  J2 --> J3[إيقاف/تفعيل الجدولة]
  J3 --> J4[حذف الجدولة]

  %% Recipients
  K[إدارة المستلمين] --> K1[إضافة/حذف المستلمين]
  K1 --> K2[تحقق صحة عناوين البريد]
  K2 --> K3[إرسال اختباري]

  %% End points
  F2 --> L[نهاية - مجدول بنجاح]
  H3 --> L
  I4 --> L
  J4 --> L
  K3 --> L
