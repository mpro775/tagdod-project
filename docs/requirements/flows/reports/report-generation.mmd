%% Report Generation Flow
%% View at https://mermaid.live
flowchart TD
  A[طلب توليد تقرير] --> B{نوع التقرير?}
  B -->|فوري| C[توليد تقرير فوري]
  B -->|مجدول| D[إنشاء جدولة تقرير]

  %% Instant Report
  C --> C1[استلام معايير التقرير]
  C1 --> C2[type, format, filters, dateRange]
  C2 --> C3[التحقق من الصلاحيات]
  C3 --> C4[استخراج البيانات من قاعدة البيانات]
  C4 --> C5[معالجة وتنسيق البيانات]
  C5 --> C6{التنسيق المطلوب?}
  C6 -->|JSON| C7[إرجاع JSON]
  C6 -->|PDF| C8[توليد PDF]
  C6 -->|Excel| C9[توليد Excel]
  C6 -->|CSV| C10[توليد CSV]

  %% Scheduled Report
  D --> D1[تحديد نوع التقرير]
  D1 --> D2[تحديد الجدولة]
  D2 --> D3[frequency: daily/weekly/monthly]
  D3 --> D4[recipients: قائمة المستلمين]
  D4 --> D5[حفظ في جدول الجدولة]
  D5 --> D6[إنشاء مهمة مجدولة]

  %% Data Extraction
  E[استخراج البيانات] --> E1[تحديد مصادر البيانات]
  E1 --> E2[Users, Products, Orders, Services, Support]
  E2 --> E3[تطبيق الفلاتر الزمنية]
  E3 --> E4[تطبيق الفلاتر المخصصة]
  E4 --> E5[جمع البيانات المطلوبة]

  %% Processing
  F[معالجة البيانات] --> F1[حساب المجاميع]
  F1 --> F2[حساب النسب المئوية]
  F2 --> F3[ترتيب البيانات]
  F3 --> F4[إضافة المقارنات]

  %% Formatting
  G[تنسيق البيانات] --> G1[JSON: كائن منظم]
  G1 --> G2[PDF: تقرير منسق]
  G2 --> G3[Excel: جداول ورسوم بيانية]
  G3 --> G4[CSV: بيانات منفصلة بفواصل]

  %% Scheduled Execution
  H[تنفيذ التقارير المجدولة] --> H1[فحص المهام المجدولة]
  H1 --> H2[تنفيذ المهام المستحقة]
  H2 --> H3[توليد التقرير]
  H3 --> H4[إرسال للمستلمين]
  H4 --> H5[تحديث حالة المهمة]

  %% End points
  C7 --> I[نهاية - تقرير جاهز]
  C8 --> I
  C9 --> I
  C10 --> I
  D6 --> I
  H5 --> I
