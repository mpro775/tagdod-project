%% Advanced Report Generation Flow with Multiple Formats and Scheduling
%% View at https://mermaid.live
flowchart TD
  A[Report Request] --> B{Report Type?}
  B -->|Sales Report| C[Query orders collection]
  B -->|Customer Report| D[Query users collection]
  B -->|Product Report| E[Query products collection]
  B -->|Inventory Report| F[Query variants collection]
  B -->|Service Report| G[Query services collection]
  B -->|Support Report| H[Query support collection]
  B -->|Performance Report| I[Query system metrics]
  
  %% Data Collection
  C --> J[Apply date filters and criteria]
  D --> J
  E --> J
  F --> J
  G --> J
  H --> J
  I --> J
  
  %% Data Processing
  J --> K[Group and aggregate data]
  K --> L[Calculate KPIs and metrics]
  L --> M[Generate charts and graphs]
  M --> N[Apply formatting and styling]
  
  %% Format Selection
  N --> O{Export Format?}
  O -->|PDF| P[Generate PDF Report]
  O -->|Excel| Q[Generate Excel Report]
  O -->|CSV| R[Generate CSV Report]
  O -->|JSON| S[Generate JSON Report]
  O -->|HTML| T[Generate HTML Report]
  
  %% PDF Generation
  P --> P1[Create PDF template]
  P1 --> P2[Add charts and graphs]
  P2 --> P3[Apply branding and styling]
  P3 --> P4[Generate final PDF]
  
  %% Excel Generation
  Q --> Q1[Create Excel workbook]
  Q1 --> Q2[Add data sheets]
  Q2 --> Q3[Add charts and pivot tables]
  Q3 --> Q4[Apply formatting]
  Q4 --> Q5[Generate final Excel]
  
  %% CSV Generation
  R --> R1[Prepare CSV data]
  R1 --> R2[Format data columns]
  R2 --> R3[Add headers and metadata]
  R3 --> R4[Generate final CSV]
  
  %% JSON Generation
  S --> S1[Structure JSON data]
  S1 --> S2[Add metadata and schema]
  S2 --> S3[Format for API consumption]
  S3 --> S4[Generate final JSON]
  
  %% HTML Generation
  T --> T1[Create HTML template]
  T1 --> T2[Add interactive charts]
  T2 --> T3[Apply responsive design]
  T3 --> T4[Generate final HTML]
  
  %% Delivery Options
  P4 --> U{Delivery Method?}
  Q5 --> U
  R4 --> U
  S4 --> U
  T4 --> U
  
  U -->|Email| V[Send via email]
  U -->|Download| W[Provide download link]
  U -->|API| X[Return via API]
  U -->|Storage| Y[Save to cloud storage]
  
  %% Email Delivery
  V --> V1[Prepare email template]
  V1 --> V2[Attach report files]
  V2 --> V3[Send to recipients]
  V3 --> V4[Track delivery status]
  
  %% Download Link
  W --> W1[Generate secure download link]
  W1 --> W2[Set expiration time]
  W2 --> W3[Return download URL]
  
  %% API Response
  X --> X1[Format API response]
  X1 --> X2[Include metadata]
  X2 --> X3[Return structured data]
  
  %% Cloud Storage
  Y --> Y1[Upload to cloud storage]
  Y1 --> Y2[Generate access URL]
  Y2 --> Y3[Set permissions]
  Y3 --> Y4[Return storage info]
  
  %% Logging and Analytics
  V4 --> Z1[Log report generation]
  W3 --> Z1
  X3 --> Z1
  Y4 --> Z1
  
  Z1 --> Z2[Update analytics metrics]
  Z2 --> Z3[Track usage statistics]
  Z3 --> Z4[Generate usage report]
  Z4 --> Z[End]

