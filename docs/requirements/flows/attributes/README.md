# تدفقات إدارة الخصائص (Attributes Management Flows)

## الملفات المتاحة
- `attribute-management.mmd` - مخطط إدارة الخصائص الأساسي
- `attribute-types-system.mmd` - مخطط نظام أنواع الخصائص
- `attribute-values-management.mmd` - مخطط إدارة قيم الخصائص
- `attribute-filtering-system.mmd` - مخطط نظام فلترة الخصائص
- `attribute-usage-tracking.mmd` - مخطط تتبع استخدام الخصائص

## نظرة عامة على النظام

نظام إدارة خصائص متقدم ومتطور يتضمن:
- ✅ **نظام خصائص عالمية** مع توحيد كامل
- ✅ **5 أنواع خصائص** مع دعم متقدم
- ✅ **نظام قيم متقدم** مع معلومات إضافية
- ✅ **نظام فلترة قوي** مع بحث متقدم
- ✅ **تتبع استخدام شامل** مع إحصائيات
- ✅ **نظام Soft Delete** مع استعادة آمنة
- ✅ **تكامل مع Media Library** مع صور وأيقونات
- ✅ **دعم ثنائي اللغة** (عربي/إنجليزي)
- ✅ **نظام مجموعات** للتنظيم المتقدم
- ✅ **نظام ترتيب متقدم** مع order وdepth

## أنواع الخصائص المتاحة

### 1. خصائص الاختيار الواحد (SELECT)
- **الخصائص:** اختيار قيمة واحدة من قائمة
- **الاستخدام:** اللون، الحجم، الماركة
- **المثال:** لون المنتج (أحمر، أزرق، أخضر)
- **القيم:** محددة مسبقاً مع hexCode للألوان

### 2. خصائص الاختيار المتعدد (MULTISELECT)
- **الخصائص:** اختيار عدة قيم من قائمة
- **الاستخدام:** الميزات، الخصائص الإضافية
- **المثال:** ميزات الهاتف (كاميرا، شحن سريع، مقاوم للماء)
- **القيم:** قيم متعددة مع إمكانية الاختيار

### 3. خصائص النص (TEXT)
- **الخصائص:** إدخال نص حر
- **الاستخدام:** الوصف، الملاحظات، التفاصيل
- **المثال:** وصف المنتج، ملاحظات خاصة
- **القيم:** نص حر بدون قيود

### 4. خصائص الأرقام (NUMBER)
- **الخصائص:** إدخال أرقام مع وحدات
- **الاستخدام:** الأبعاد، الوزن، السعة
- **المثال:** أبعاد المنتج (10x20x30 سم)
- **القيم:** أرقام مع وحدات قياس

### 5. خصائص المنطق (BOOLEAN)
- **الخصائص:** نعم/لا أو صحيح/خطأ
- **الاستخدام:** الميزات، الخصائص الثنائية
- **المثال:** مقاوم للماء (نعم/لا)
- **القيم:** true/false أو نعم/لا

## هيكل البيانات

### حقول الخصائص الأساسية (Basic Attribute Fields)
- `name`: الاسم بالعربية (string) - مطلوب
- `nameEn`: الاسم بالإنجليزية (string) - مطلوب، فريد
- `slug`: الرابط الودود (string) - مطلوب، فريد
- `type`: نوع الخصيصة (enum) - مطلوب
- `description`: الوصف (string) - اختياري

### حقول العرض (Display Fields)
- `order`: ترتيب العرض (number) - افتراضي 0
- `isActive`: نشطة (boolean) - افتراضي true
- `isFilterable`: قابلة للفلترة (boolean) - افتراضي true
- `isRequired`: إلزامية (boolean) - افتراضي false
- `showInFilters`: عرض في الفلاتر (boolean) - افتراضي false

### حقول التنظيم (Organization Fields)
- `groupId`: معرف المجموعة (ObjectId) - اختياري
- `usageCount`: عدد الاستخدامات (number) - افتراضي 0

### حقول Soft Delete (Soft Delete Fields)
- `deletedAt`: تاريخ الحذف (Date) - افتراضي null
- `deletedBy`: من قام بالحذف (ObjectId) - اختياري

### حقول قيم الخصائص (Attribute Value Fields)
- `attributeId`: معرف الخصيصة (ObjectId) - مطلوب
- `value`: القيمة بالعربية (string) - مطلوب
- `valueEn`: القيمة بالإنجليزية (string) - اختياري
- `slug`: الرابط الودود (string) - مطلوب
- `hexCode`: كود اللون (string) - اختياري
- `imageUrl`: رابط الصورة (string) - اختياري
- `imageId`: معرف الصورة من Media Library (ObjectId) - اختياري

### حقول إضافية للقيم (Additional Value Fields)
- `description`: الوصف (string) - اختياري
- `order`: ترتيب العرض (number) - افتراضي 0
- `isActive`: نشطة (boolean) - افتراضي true
- `usageCount`: عدد الاستخدامات (number) - افتراضي 0

## أنواع الخصائص المتاحة (Attribute Types)

### 1. SELECT - اختيار واحد
- **الوصف:** اختيار قيمة واحدة من قائمة محددة
- **الاستخدام:** اللون، الحجم، الماركة
- **القيم:** محددة مسبقاً مع hexCode
- **الفلترة:** دعم كامل للفلترة

### 2. MULTISELECT - اختيار متعدد
- **الوصف:** اختيار عدة قيم من قائمة
- **الاستخدام:** الميزات، الخصائص الإضافية
- **القيم:** قيم متعددة مع إمكانية الاختيار
- **الفلترة:** دعم متقدم للفلترة

### 3. TEXT - نص حر
- **الوصف:** إدخال نص حر بدون قيود
- **الاستخدام:** الوصف، الملاحظات، التفاصيل
- **القيم:** نص حر مع validation
- **الفلترة:** بحث نصي متقدم

### 4. NUMBER - أرقام
- **الوصف:** إدخال أرقام مع وحدات قياس
- **الاستخدام:** الأبعاد، الوزن، السعة
- **القيم:** أرقام مع وحدات
- **الفلترة:** فلترة رقمية متقدمة

### 5. BOOLEAN - منطق
- **الوصف:** نعم/لا أو صحيح/خطأ
- **الاستخدام:** الميزات، الخصائص الثنائية
- **القيم:** true/false
- **الفلترة:** فلترة ثنائية

## API Endpoints المتاحة

### للعملاء (3 endpoints)
- **GET /attributes** - قائمة الخصائص
- **GET /attributes/filterable** - الخصائص القابلة للفلترة
- **GET /attributes/:id** - تفاصيل خصيصة واحدة

### للأدمن (10 endpoints)
- **POST /admin/attributes** - إنشاء خصيصة جديدة
- **GET /admin/attributes** - قائمة الخصائص (مع فلاتر)
- **GET /admin/attributes/:id** - تفاصيل خصيصة واحدة
- **PATCH /admin/attributes/:id** - تحديث خصيصة
- **DELETE /admin/attributes/:id** - حذف مؤقت (Soft Delete)
- **POST /admin/attributes/:id/restore** - استعادة خصيصة محذوفة
- **POST /admin/attributes/:attributeId/values** - إضافة قيمة لخصيصة
- **GET /admin/attributes/:attributeId/values** - قائمة قيم الخصيصة
- **PATCH /admin/attributes/values/:id** - تحديث قيمة
- **DELETE /admin/attributes/values/:id** - حذف قيمة

### إضافية للأدمن (1 endpoint)
- **GET /admin/attributes/stats/summary** - إحصائيات عامة

## DTOs المتاحة

### إنشاء الخصيصة
- `CreateAttributeDto`: إنشاء خصيصة جديدة
  - `name`: الاسم بالعربية (required)
  - `nameEn`: الاسم بالإنجليزية (required)
  - `type`: نوع الخصيصة (required)
  - `description`: الوصف (optional)
  - `order`: ترتيب العرض (optional)
  - `isFilterable`: قابلة للفلترة (optional)
  - `isRequired`: إلزامية (optional)
  - `showInFilters`: عرض في الفلاتر (optional)
  - `groupId`: معرف المجموعة (optional)

### تحديث الخصيصة
- `UpdateAttributeDto`: تحديث خصيصة موجودة
  - جميع الحقول اختيارية
  - نفس الحقول في CreateAttributeDto

### إنشاء قيمة الخصيصة
- `CreateAttributeValueDto`: إضافة قيمة لخصيصة
  - `value`: القيمة بالعربية (required)
  - `valueEn`: القيمة بالإنجليزية (optional)
  - `hexCode`: كود اللون (optional)
  - `imageUrl`: رابط الصورة (optional)
  - `imageId`: معرف الصورة (optional)
  - `description`: الوصف (optional)
  - `order`: ترتيب العرض (optional)

### تحديث قيمة الخصيصة
- `UpdateAttributeValueDto`: تحديث قيمة موجودة
  - جميع الحقول اختيارية
  - نفس الحقول في CreateAttributeValueDto
  - `isActive`: نشطة (optional)

## نظام الفلترة المتقدم

### أنواع الفلترة
- **فلترة بالخصائص:** فلترة المنتجات حسب الخصائص
- **فلترة بالقيم:** فلترة حسب قيم محددة
- **فلترة متعددة:** فلترة بعدة خصائص معاً
- **فلترة نصية:** بحث في قيم النص

### خصائص الفلترة
- **isFilterable:** الخصائص القابلة للفلترة
- **showInFilters:** الخصائص المعروضة في الفلاتر
- **isActive:** الخصائص النشطة فقط
- **type:** فلترة حسب نوع الخصيصة

### فلترة متقدمة
- **فلترة رقمية:** فلترة بالأرقام مع نطاقات
- **فلترة نصية:** بحث نصي متقدم
- **فلترة منطقية:** فلترة ثنائية
- **فلترة متعددة القيم:** فلترة بعدة قيم

## نظام تتبع الاستخدام

### إحصائيات الخصائص
- **usageCount:** عدد المنتجات التي تستخدم الخصيصة
- **قيم الاستخدام:** عدد الـ variants التي تستخدم القيمة
- **تتبع التغييرات:** تتبع تغييرات الاستخدام
- **إحصائيات المجموعات:** إحصائيات حسب المجموعات

### تحديث الاستخدام
- **زيادة الاستخدام:** عند إضافة خصيصة لمنتج
- **تقليل الاستخدام:** عند إزالة خصيصة من منتج
- **تحديث تلقائي:** تحديث تلقائي للعدادات
- **تتبع التغييرات:** تتبع جميع التغييرات

## نظام المجموعات

### إدارة المجموعات
- **إنشاء مجموعات:** تجميع الخصائص المتشابهة
- **تنظيم الخصائص:** ترتيب الخصائص في مجموعات
- **فلترة المجموعات:** فلترة حسب المجموعات
- **إحصائيات المجموعات:** إحصائيات لكل مجموعة

### فوائد المجموعات
- **التنظيم:** تنظيم أفضل للخصائص
- **الفلترة:** فلترة أسهل حسب المجموعات
- **العرض:** عرض منظم في الواجهة
- **الإدارة:** إدارة أسهل للخصائص

## نظام Soft Delete

### الحذف المؤقت
- **deletedAt:** تاريخ الحذف
- **deletedBy:** من قام بالحذف
- **الاستعادة:** إمكانية الاستعادة
- **التحقق:** فحص الاستخدام قبل الحذف

### قيود الحذف
- **الاستخدام:** لا يمكن حذف خصيصة مستخدمة
- **القيم:** لا يمكن حذف قيمة مستخدمة
- **التبعيات:** فحص التبعيات الأخرى
- **الاستعادة:** إمكانية الاستعادة الآمنة

## تكامل مع Media Library

### دعم الصور
- **imageUrl:** رابط الصورة المباشر
- **imageId:** معرف الصورة من Media Library
- **تكامل كامل:** دعم كامل لـ Media Library
- **تحسين الأداء:** تحسين أداء الصور

### أنواع الصور
- **صور الألوان:** صور للألوان المختلفة
- **صور النسيج:** صور للأنسجة والمواد
- **صور الباترن:** صور للباترن والتصاميم
- **صور الميزات:** صور للميزات المختلفة

## نقاط مهمة
- **نظام خصائص عالمية:** توحيد كامل للخصائص مع دعم 5 أنواع
- **نظام قيم متقدم:** قيم مع معلومات إضافية مثل hexCode وصور
- **نظام فلترة قوي:** فلترة متقدمة مع بحث نصي ورقمي
- **تتبع استخدام شامل:** إحصائيات مفصلة مع تحديث تلقائي
- **نظام Soft Delete آمن:** حذف مؤقت مع استعادة وإدارة صلاحيات
- **تكامل مع Media Library:** دعم كامل للصور والأيقونات
- **دعم ثنائي اللغة:** عربي وإنجليزي مع ترجمة كاملة
- **نظام مجموعات:** تنظيم متقدم للخصائص
- **نظام ترتيب متقدم:** ترتيب ذكي مع order وdepth
- **أداء محسن:** فهرسة متقدمة مع استعلامات محسنة
