%% Coupons Management Flow
%% View at https://mermaid.live
flowchart TD
  A[إدارة الكوبونات] --> B{نوع العملية?}
  B -->|إنشاء كوبون| C[إنشاء كوبون]
  B -->|تحديث كوبون| D[تحديث كوبون]
  B -->|حذف كوبون| E[حذف كوبون]
  B -->|عرض الكوبونات| F[عرض الكوبونات]
  B -->|التحقق من كوبون| G[التحقق من كوبون]

  %% Create Coupon
  C --> C1[استلام بيانات الكوبون]
  C1 --> C2[التحقق من صحة البيانات]
  C2 --> C3[التحقق من فرادة الكود]
  C3 --> C4[إنشاء كائن الكوبون]
  C4 --> C5[حفظ في قاعدة البيانات]
  C5 --> C6[إرجاع الكوبون المنشأ]

  %% Update Coupon
  D --> D1[استلام معرف الكوبون وبيانات التحديث]
  D1 --> D2[البحث عن الكوبون]
  D2 --> D3{الكوبون موجود?}
  D3 -->|لا| D4[إرجاع خطأ]
  D3 -->|نعم| D5[تحديث البيانات]
  D5 --> D6[حفظ التغييرات]
  D6 --> D7[إرجاع الكوبون المحدث]
  D4 --> D8[نهاية - غير موجود]

  %% Delete Coupon
  E --> E1[استلام معرف الكوبون]
  E1 --> E2[البحث عن الكوبون]
  E2 --> E3{الكوبون موجود?}
  E3 -->|لا| E4[إرجاع خطأ]
  E3 -->|نعم| E5[Soft Delete للكوبون]
  E5 --> E6[إرجاع نجاح الحذف]
  E4 --> E7[نهاية - غير موجود]

  %% List Coupons
  F --> F1[استلام معايير البحث]
  F1 --> F2[البحث في قاعدة البيانات]
  F2 --> F3[فلترة حسب الحالة والتواريخ]
  F3 --> F4[إرجاع قائمة الكوبونات]

  %% Validate Coupon
  G --> G1[استلام كود الكوبون والسلة]
  G1 --> G2[البحث عن الكوبون بالكود]
  G2 --> G3{الكوبون موجود?}
  G3 -->|لا| G4[إرجاع خطأ - غير موجود]
  G3 -->|نعم| G5[فحص الحالة]
  G5 --> G6{نشط وصالح التاريخ?}
  G6 -->|لا| G7[إرجاع خطأ - غير صالح]
  G6 -->|نعم| G8[فحص حدود الاستخدام]
  G8 --> G9{لم يتجاوز الحدود?}
  G9 -->|لا| G10[إرجاع خطأ - مستنفد]
  G9 -->|نعم| G11[فحص الاستهداف]
  G11 --> G12{ينطبق على السلة?}
  G12 -->|لا| G13[إرجاع خطأ - غير قابل للتطبيق]
  G12 -->|نعم| G14[حساب قيمة الخصم]
  G14 --> G15[إرجاع الخصم الصالح]
