%% Media Analytics & Statistics Flow
%% View at https://mermaid.live
flowchart TD
  A[طلب إحصائيات الوسائط] --> B[استرجاع إجمالي عدد الملفات]
  B --> C[استرجاع التوزيع حسب الفئة]
  C --> D[استرجاع التوزيع حسب النوع]
  D --> E[حساب إجمالي حجم الملفات]
  E --> F[حساب متوسط حجم الملف]
  F --> G[استرجاع آخر 5 ملفات تم رفعها]
  G --> H[تنسيق النتائج]

  %% Data Retrieval
  B --> B1[استعلام MediaModel.countDocuments]
  B1 --> B2[فلترة الملفات غير المحذوفة]

  C --> C1[استعلام MongoDB aggregation]
  C1 --> C2[تجميع حسب category]
  C2 --> C3[حساب العد لكل فئة]

  D --> D1[استعلام MongoDB aggregation]
  D1 --> D2[تجميع حسب type]
  D2 --> D3[حساب العد لكل نوع]

  E --> E1[استعلام MongoDB aggregation]
  E1 --> E2[تجميع وحساب المجموع لـ size]

  F --> F1[قسمة إجمالي الحجم على العد الإجمالي]

  G --> G1[استعلام MediaModel.find]
  G1 --> G2[ترتيب حسب createdAt تنازلياً]
  G2 --> G3[تقييد النتائج بـ 5]
  G3 --> G4[اختيار الحقول المطلوبة]

  %% Result Formatting
  H --> H1[إنشاء كائن النتيجة]
  H1 --> H2[إضافة total: العد الإجمالي]
  H2 --> H3[إضافة byCategory: التوزيع حسب الفئة]
  H3 --> H4[إضافة byType: التوزيع حسب النوع]
  H4 --> H5[إضافة totalSize: الحجم الإجمالي بالبايت]
  H5 --> H6[إضافة totalSizeMB: الحجم بالميجابايت]
  H6 --> H7[إضافة averageSize: متوسط الحجم]
  H7 --> H8[إضافة recentlyAdded: آخر 5 ملفات]

  H8 --> Z[إرجاع الإحصائيات]
