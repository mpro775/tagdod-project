# تدفقات المخزون (Inventory Flows)

## الملفات المتاحة
- `adjustments.mmd` - مخطط تعديلات المخزون
- `validation-tracking.mmd` - مخطط التحقق وتتبع المخزون

## شرح التدفقات

### 1. إدارة المخزون الأساسية
- **المخزون الفعلي:** الكمية المتاحة من المنتج (في Variant)
- **تتبع المخزون:** تفعيل/إلغاء تتبع المخزون لكل متغير
- **الحد الأدنى:** تحديد الحد الأدنى للمخزون
- **السماح بالطلب:** السماح بالطلب عند نفاد المخزون

### 2. تحديث المخزون
- **تحديث يدوي:** تحديث كميات المخزون من المديرين
- **حفظ التغييرات:** حفظ تغييرات المخزون مع التاريخ
- **التحقق من الصحة:** التحقق من صحة القيم المدخلة

### 3. التحقق من المخزون
- **التحقق قبل البيع:** فحص توفر المخزون قبل إضافة للسلة
- **عرض حالة المخزون:** إظهار توفر المنتج للعملاء
- **تنبيهات المخزون المنخفض:** إشعارات عند انخفاض المخزون

### 4. تقارير المخزون
- **المخزون المنخفض:** قائمة المنتجات ذات المخزون المنخفض
- **المخزون المنتهي:** قائمة المنتجات التي نفد مخزونها
- **ملخص المخزون:** إحصائيات عامة عن المخزون

## هيكل البيانات

### حقول المخزون في Variant
- `stock`: الكمية المتاحة (number) - افتراضي 0
- `minStock`: الحد الأدنى للمخزون (number) - افتراضي 0
- `trackInventory`: تتبع المخزون (boolean) - افتراضي false
- `allowBackorder`: السماح بالطلب عند النفاد (boolean) - افتراضي true

### حقول إضافية للمخزون (اختيارية)
- `salesCount`: عدد المبيعات (number) - للإحصائيات
- `lastViewedAt`: آخر مشاهدة (Date) - للإحصائيات

## API Endpoints المتاحة

### إدارة المخزون (من Products Module)
- **POST /admin/products/variants/:id/stock** - تحديث مخزون متغير محدد
- **GET /admin/products/inventory/low-stock** - قائمة المتغيرات ذات المخزون المنخفض
- **GET /admin/products/inventory/out-of-stock** - قائمة المتغيرات التي نفد مخزونها

### عرض المخزون للعملاء (من Public Products)
- **GET /products** - عرض المنتجات مع معلومات المخزون (متاح/غير متاح)

## نقاط مهمة
- **إدارة بسيطة:** إدارة المخزون مباشرة في Variant
- **تحديث يدوي:** تحديث المخزون من قبل المديرين
- **تتبع اختياري:** إمكانية تفعيل/إلغاء تتبع المخزون
- **تقارير أساسية:** تقارير المخزون المنخفض والمنتهي
- **مرونة في الطلب:** السماح بالطلب عند نفاد المخزون
- **أداء محسن:** فهرسة محسنة للبحث السريع
