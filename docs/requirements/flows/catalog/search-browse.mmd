%% Advanced Catalog: Universal Search, Faceted Search, Multi-Currency, Caching
%% View at https://mermaid.live
flowchart TD
  A[Start] --> B{Search Type?}
  B -->|Universal Search| C[Search across all entities]
  B -->|Product Search| D[Advanced product search]
  B -->|Category Browse| E[Browse category tree]
  B -->|Brand Browse| F[Browse by brand]
  
  %% Universal Search Flow
  C --> C1[Search products, categories, brands]
  C1 --> C2[Apply language filter (ar/en)]
  C2 --> C3[Calculate relevance scores]
  C3 --> C4[Sort by relevance]
  C4 --> C5[Return mixed results]
  
  %% Advanced Product Search Flow
  D --> D1[Full-text search in name/description]
  D1 --> D2[Apply advanced filters]
  D2 --> D3{Include Facets?}
  D3 -->|Yes| D4[Calculate facet counts]
  D3 -->|No| D5[Skip facets]
  D4 --> D6[Apply category filter]
  D5 --> D6
  D6 --> D7[Apply brand filter]
  D7 --> D8[Apply price range filter]
  D8 --> D9[Apply rating filter]
  D9 --> D10[Apply attributes filter]
  D10 --> D11[Apply status filter]
  D11 --> D12[Apply featured/new filter]
  D12 --> D13[Apply tags filter]
  D13 --> D14[Sort results]
  D14 --> D15[Paginate results]
  D15 --> D16[Return products + facets]
  
  %% Category Browse Flow
  E --> E1[Load category tree]
  E1 --> E2[Get products in category]
  E2 --> E3[Apply category-specific filters]
  E3 --> E4[Sort by category order]
  E4 --> E5[Paginate results]
  
  %% Brand Browse Flow
  F --> F1[Load brand information]
  F1 --> F2[Get products by brand]
  F2 --> F3[Apply brand-specific filters]
  F3 --> F4[Sort by brand popularity]
  F4 --> F5[Paginate results]
  
  %% Product Detail Flow
  D16 --> G[View Product Details]
  E5 --> G
  F5 --> G
  C5 --> G
  G --> G1[Load product with variants]
  G1 --> G2[Get pricing in selected currency]
  G2 --> G3[Convert prices if needed]
  G3 --> G4[Load attribute values]
  G4 --> G5[Load reviews and ratings]
  G5 --> G6[Update view count]
  G6 --> G7[Cache product details]
  G7 --> G8[Return product with pricing]
  
  %% Variant Selection Flow
  G8 --> H[Select Variant]
  H --> H1[Load variant details]
  H1 --> H2[Get variant pricing]
  H2 --> H3[Check stock availability]
  H3 --> H4[Apply user-specific discounts]
  H4 --> H5[Return variant with final price]
  
  %% Suggestions Flow
  I[User types search] --> I1[Get suggestions from cache]
  I1 --> I2{Cache hit?}
  I2 -->|Yes| I3[Return cached suggestions]
  I2 -->|No| I4[Generate new suggestions]
  I4 --> I5[Cache suggestions]
  I5 --> I6[Return suggestions]
  
  %% Autocomplete Flow
  J[User types for autocomplete] --> J1[Search partial matches]
  J1 --> J2[Rank by relevance]
  J2 --> J3[Return top matches]
  
  %% End points
  G8 --> Z[End]
  H5 --> Z
  I3 --> Z
  I6 --> Z
  J3 --> Z
