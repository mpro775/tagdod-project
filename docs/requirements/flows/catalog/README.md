# تدفقات الكتالوج والبحث (Catalog & Search Flows)

## الملفات المتاحة
- `search-browse.mmd` - مخطط تصفح الكتالوج والبحث

## شرح التدفقات

### 1. البحث الشامل (Universal Search)
- **التقنية:** بحث متقدم عبر جميع الكيانات
- **الكيانات:** منتجات، فئات، براندات
- **اللغات:** دعم كامل للعربية والإنجليزية
- **النتائج:** ترتيب حسب الصلة والأهمية
- **التخزين المؤقت:** 5 دقائق للنتائج، 30 دقيقة للاقتراحات

### 2. بحث المنتجات المتقدم (Advanced Product Search)
- **التقنية:** Full-text search مع فلترة متقدمة
- **الحقول:** اسم المنتج، الوصف، الوسوم (عربي/إنجليزي)
- **الفلترة:** فئة، براند، سعر، تقييم، سمات، حالة
- **الترتيب:** حسب الاسم، السعر، التقييم، المشاهدات، التاريخ، الصلة
- **Faceted Search:** فلاتر ديناميكية مع عدد النتائج

### 3. نظام الاقتراحات (Suggestions & Autocomplete)
- **الاقتراحات:** اقتراحات ذكية أثناء الكتابة
- **Autocomplete:** إكمال تلقائي للكلمات
- **التخزين المؤقت:** 30 دقيقة للاقتراحات
- **اللغات:** دعم كامل للعربية والإنجليزية

### 4. تصفح التصنيفات (Category Navigation)
- **الطريقة:** تصفح شجري للفئات (Parent-Child)
- **المميزات:** 
  - فئات متعددة المستويات
  - ترتيب الفئات حسب الأولوية
  - إظهار عدد المنتجات في كل فئة
  - دعم ثنائي اللغة

### 5. عرض تفاصيل المنتج
- **المعلومات:** الاسم، الوصف، الصور، التنويعات
- **التنويعات:** عرض جميع التركيبات المتاحة
- **الأسعار:** حسب نوع الحساب (تجزئة/جملة/مهندس)
- **العملات:** دعم USD, YER, SAR مع تحويل تلقائي
- **التخزين المؤقت:** 10 دقائق لتفاصيل المنتج

### 6. نظام السمات المتقدم (Advanced Attributes)
- **السمات:** نظام سمات مرن (JSON)
- **الفلترة:** فلترة حسب السمات (اللون، الحجم، إلخ)
- **الترتيب:** ترتيب حسب السمات
- **البحث:** بحث في قيم السمات

### 7. نظام التقييمات والمراجعات
- **التقييم:** نظام تقييم من 0 إلى 5
- **المراجعات:** عدد المراجعات لكل منتج
- **الفلترة:** فلترة حسب التقييم الأدنى
- **الترتيب:** ترتيب حسب التقييم

### 8. نظام SEO المتقدم
- **Meta Tags:** عنوان، وصف، كلمات مفتاحية
- **URLs:** URLs صديقة لمحركات البحث
- **Structured Data:** بيانات منظمة للـ SEO
- **Sitemap:** خريطة موقع تلقائية

## API Endpoints المتاحة

### البحث الشامل
- **GET /search** - البحث الشامل عبر جميع الكيانات
- **GET /search/suggestions** - اقتراحات البحث
- **GET /search/autocomplete** - إكمال تلقائي

### بحث المنتجات المتقدم
- **GET /search/products** - بحث منتجات متقدم
- **GET /search/products/facets** - فلاتر ديناميكية

### الكتالوج العام
- **GET /products** - قائمة المنتجات
- **GET /products/detail** - تفاصيل المنتج
- **GET /categories** - قائمة الفئات
- **GET /brands** - قائمة البراندات

## هيكل البيانات

### حقول المنتج الأساسية
- `name`: الاسم بالعربية (string)
- `nameEn`: الاسم بالإنجليزية (string)
- `slug`: الرابط الصديق للـ SEO (string)
- `description`: الوصف بالعربية (string)
- `descriptionEn`: الوصف بالإنجليزية (string)
- `categoryId`: معرف الفئة (ObjectId)
- `brandId`: معرف البراند (ObjectId)
- `sku`: رمز المنتج (string)

### حقول الصور
- `mainImage`: الصورة الرئيسية (string)
- `mainImageId`: معرف الصورة الرئيسية (ObjectId)
- `imageIds`: معرفات الصور الإضافية (array)
- `images`: URLs الصور الإضافية (array)

### حقول السمات
- `attributes`: السمات المستخدمة (array of ObjectId)
- `tags`: الوسوم (array of string)

### حقول SEO
- `metaTitle`: عنوان الصفحة (string)
- `metaDescription`: وصف الصفحة (string)
- `metaKeywords`: الكلمات المفتاحية (array)

### حقول الحالة والعرض
- `status`: حالة المنتج (draft/active/out_of_stock/discontinued)
- `isActive`: هل المنتج نشط (boolean)
- `isFeatured`: منتج مميز (boolean)
- `isNew`: منتج جديد (boolean)
- `isBestseller`: الأكثر مبيعاً (boolean)
- `order`: ترتيب العرض (number)

### حقول الإحصائيات
- `viewsCount`: عدد المشاهدات (number)
- `salesCount`: عدد المبيعات (number)
- `variantsCount`: عدد التنويعات (number)
- `reviewsCount`: عدد التقييمات (number)
- `averageRating`: متوسط التقييم (number)

### حقول المخزون
- `stock`: الكمية المتاحة (number)
- `minStock`: الحد الأدنى للمخزون (number)
- `maxStock`: الحد الأقصى للمخزون (number)
- `trackStock`: تتبع المخزون (boolean)
- `allowBackorder`: السماح بالطلب عند نفاد المخزون (boolean)

### حقول الحذف الناعم
- `deletedAt`: تاريخ الحذف (Date)
- `deletedBy`: من قام بالحذف (ObjectId)

## نقاط مهمة
- **دعم ثنائي اللغة:** عربي وإنجليزي كامل
- **فهرسة متقدمة:** Full-text search مع MongoDB
- **تخزين مؤقت ذكي:** 5-30 دقيقة حسب نوع البيانات
- **Faceted Search:** فلاتر ديناميكية مع عدد النتائج
- **نظام سمات مرن:** JSON-based attributes
- **SEO متقدم:** Meta tags وURLs صديقة لمحركات البحث
- **نظام تقييمات:** تقييم ومراجعات للمنتجات
- **عملات متعددة:** USD, YER, SAR مع تحويل تلقائي
- **تتبع شامل:** مشاهدات ومبيعات وتقييمات
- **مخزون ذكي:** تتبع المخزون مع تنبيهات
- **حذف ناعم:** حماية البيانات مع إمكانية الاستعادة
- **فهرسة محسنة:** indexes محسنة للأداء السريع
