%% Service Analytics Flow
%% View at https://mermaid.live
flowchart TD
  A[تحليلات الخدمات] --> B[إحصائيات عامة]
  A --> C[إحصائيات الطلبات]
  A --> D[إحصائيات المهندسين]
  A --> E[إحصائيات الأنواع]
  A --> F[إحصائيات الإيرادات]
  A --> G[إحصائيات المدن ⭐ جديد]

  %% Overview Statistics
  B --> B1[GET /admin/services/statistics/overview]
  B1 --> B2[إجمالي الطلبات]
  B2 --> B3[الطلبات حسب الحالة]
  B3 --> B4[إجمالي المهندسين]
  B4 --> B5[إجمالي الإيرادات]
  B5 --> B6[متوسط إيراد الطلب]

  %% Request Statistics
  C --> C1[GET /admin/services/statistics/requests]
  C1 --> C2[توزيع حسب الحالة]
  C2 --> C3[OPEN: قيد الانتظار]
  C3 --> C4[OFFERS_COLLECTING: جمع العروض]
  C4 --> C5[ASSIGNED: معين]
  C5 --> C6[IN_PROGRESS: قيد التنفيذ]
  C6 --> C7[COMPLETED: مكتمل]
  C7 --> C8[RATED: مقيم]
  C8 --> C9[CANCELLED: ملغي]

  C9 --> C10[توزيع حسب التاريخ]
  C10 --> C11[يومي، أسبوعي، شهري]
  C11 --> C12[اتجاهات النمو]
  C12 --> C13[متوسط وقت الإنجاز]

  %% Engineer Statistics
  D --> D1[GET /admin/services/statistics/engineers]
  D1 --> D2[قائمة المهندسين]
  D2 --> D3[لكل مهندس]
  D3 --> D4[عدد الطلبات المكتملة]
  D4 --> D5[متوسط التقييم]
  D5 --> D6[إجمالي الإيرادات]
  D6 --> D7[معدل الإنجاز]

  D7 --> D8[ترتيب المهندسين]
  D8 --> D9[حسب الإيرادات]
  D9 --> D10[حسب التقييمات]
  D10 --> D11[حسب عدد الطلبات]

  %% Service Types Statistics
  E --> E1[GET /admin/services/statistics/services-types]
  E1 --> E2[توزيع حسب النوع]
  E2 --> E3[عدد الطلبات لكل نوع]
  E3 --> E4[الشعبية النسبية]
  E4 --> E5[الإيرادات حسب النوع]
  E5 --> E6[متوسط التكلفة حسب النوع]

  %% Revenue Statistics
  F --> F1[GET /admin/services/statistics/revenue]
  F1 --> F2[إيرادات حسب الفترة]
  F2 --> F3[يومي، أسبوعي، شهري، سنوي]
  F3 --> F4[نمو الإيرادات]
  F4 --> F5[متوسط إيراد الطلب]
  F5 --> F6[إجمالي الإيرادات المحققة]

  %% Individual Engineer Stats
  G[إحصائيات مهندس فردي] --> G1[GET /admin/services/engineers/:id/statistics]
  G1 --> G2[عدد الطلبات المكتملة]
  G2 --> G3[متوسط التقييم]
  G3 --> G4[إجمالي الإيرادات]
  G4 --> G5[معدل الإنجاز]
  G5 --> G6[متوسط وقت الإنجاز]

  G6 --> G7[عروض المهندس]
  G7 --> G8[GET /admin/services/engineers/:id/offers]
  G8 --> G9[إجمالي العروض المقدمة]
  G9 --> G10[معدل القبول]
  G10 --> G11[العروض حسب الحالة]

  %% Data Processing
  H[معالجة البيانات] --> H1[استعلام MongoDB]
  H1 --> H2[aggregation pipelines]
  H2 --> H3[حساب المجاميع]
  H3 --> H4[حساب النسب المئوية]
  H4 --> H5[ترتيب البيانات]

  %% City Statistics ⭐ New
  G --> G1[إحصائيات حسب المدينة]
  G1 --> G2[عدد الطلبات لكل مدينة]
  G2 --> G3[صنعاء: 150 طلب]
  G3 --> G4[عدن: 120 طلب]
  G4 --> G5[تعز: 90 طلب]
  G5 --> G6[الحديدة: 75 طلب]
  
  G6 --> G7[عدد المهندسين لكل مدينة]
  G7 --> G8[صنعاء: 45 مهندس]
  G8 --> G9[عدن: 38 مهندس]
  G9 --> G10[تعز: 32 مهندس]
  
  G10 --> G11[نسبة الطلبات للمهندسين]
  G11 --> G12[صنعاء: 3.3 طلب/مهندس]
  G12 --> G13[عدن: 3.2 طلب/مهندس]
  G13 --> G14[معدل الطلب حسب المدينة]
  
  G14 --> G15[المدن الأكثر نشاطاً]
  G15 --> G16[ترتيب حسب عدد الطلبات]
  G16 --> G17[ترتيب حسب عدد المهندسين]
  G17 --> G18[المدن التي تحتاج مهندسين]

  %% End points
  B6 --> I[نهاية الإحصائيات العامة]
  C13 --> I
  D11 --> I
  E6 --> I
  F6 --> I
  G11 --> I
  G18 --> I
