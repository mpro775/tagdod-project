# تدفقات نظام أسعار الصرف (Exchange Rates Flows)

## الملفات المتاحة

### المخططات الرئيسية
- `exchange-rates-overview.mmd` - نظرة عامة على نظام أسعار الصرف
- `exchange-rates-management.mmd` - مخطط تدفق إدارة أسعار الصرف
- `currency-conversion.mmd` - مخطط تدفق تحويل العملات
- `exchange-rates-automation.mmd` - مخطط تدفق أتمتة أسعار الصرف

## شرح التدفقات

### 1. إدارة أسعار الصرف (Exchange Rates Management)
- **إنشاء سعر صرف:** إضافة أسعار صرف جديدة مع التحقق من البيانات
- **تحديث سعر صرف:** تعديل أسعار الصرف الموجودة مع إنشاء سجل تاريخي
- **حذف سعر صرف:** إلغاء تفعيل أسعار الصرف مع الاحتفاظ بالسجل التاريخي
- **عرض أسعار الصرف:** عرض قائمة أسعار الصرف مع الفلترة والترتيب
- **إدارة حالة سعر الصرف:** تفعيل/إلغاء تفعيل أسعار الصرف

### 2. تحويل العملات (Currency Conversion)
- **تحويل بسيط:** تحويل مبلغ من عملة إلى أخرى باستخدام السعر الأساسي
- **تحويل متقدم:** تحويل مع خيارات متقدمة (سعر الشراء/البيع، الرسوم، التقريب)
- **تحويل متعدد العملات:** تحويل مبلغ إلى عدة عملات في نفس الوقت
- **تحويل جماعي:** معالجة عدة طلبات تحويل في نفس الوقت
- **التحقق من صحة التحويل:** التحقق من دقة وموثوقية التحويلات

### 3. أتمتة أسعار الصرف (Exchange Rates Automation)
- **تكوين الأتمتة:** إعداد قواعد الأتمتة والمعايير
- **مراقبة المصادر الخارجية:** ربط النظام بمصادر أسعار الصرف الخارجية
- **التحديث التلقائي:** تحديث أسعار الصرف تلقائياً بناءً على المصادر الخارجية
- **التحقق من التحديثات:** التحقق من دقة وموثوقية التحديثات التلقائية
- **إشعار أصحاب المصلحة:** إرسال إشعارات عند تغيير أسعار الصرف

## المكونات الرئيسية

### 1. إدارة أسعار الصرف (Exchange Rates Management)
- **البيانات الأساسية:**
  - العملة الأساسية (fromCurrency)
  - العملة المستهدفة (toCurrency)
  - سعر الصرف (rate)
  - السعر الأساسي (baseRate)
  - سعر الشراء (buyRate)
  - سعر البيع (sellRate)
  - الفرق بين الشراء والبيع (spread)
- **معلومات المصدر:**
  - مصدر السعر (manual, automatic, api)
  - مزود API (apiProvider)
  - آخر من قام بالتحديث (lastUpdatedBy)
  - وقت آخر تحديث (lastUpdatedAt)
- **معلومات التفعيل:**
  - حالة التفعيل (isActive)
  - تاريخ بدء السريان (effectiveDate)
  - تاريخ انتهاء السريان (expiryDate)
  - الملاحظات (notes)
- **البيانات الوصفية:**
  - البيانات المخصصة (metadata)
  - وقت الإنشاء (createdAt)
  - وقت التحديث (updatedAt)

### 2. تحويل العملات (Currency Conversion)
- **التحويل البسيط:**
  - الحصول على سعر الصرف
  - حساب التحويل
  - تطبيق التقريب
  - تنسيق النتيجة
- **التحويل المتقدم:**
  - الحصول على سعر الصرف مع الخيارات
  - تطبيق نوع السعر (شراء/بيع/متوسط)
  - حساب التحويل مع الرسوم
  - تطبيق التقريب المتقدم
  - تنسيق النتيجة المتقدمة
- **التحويل متعدد العملات:**
  - الحصول على مبلغ العملة الأساسية
  - الحصول على عدة أسعار صرف
  - حساب التحويلات المتعددة
  - تنسيق النتائج المتعددة
- **التحويل الجماعي:**
  - الحصول على بيانات التحويل الجماعي
  - معالجة التحويلات الجماعية
  - التحقق من النتائج الجماعية
  - تنسيق النتائج الجماعية

### 3. أتمتة أسعار الصرف (Exchange Rates Automation)
- **تكوين الأتمتة:**
  - تعيين معاملات الأتمتة
  - تكوين تكرار التحديث
  - تعيين قواعد التحقق
  - تكوين إعدادات الإشعارات
- **مراقبة المصادر الخارجية:**
  - الاتصال بـ APIs الخارجية
  - مراقبة تغييرات الأسعار
  - اكتشاف التغييرات المهمة
  - التحقق من صحة البيانات الخارجية
- **التحديث التلقائي:**
  - معالجة تحديثات الأسعار
  - تطبيق قواعد التحديث
  - تحديث سجلات أسعار الصرف
  - إنشاء سجل التحديث
- **التحقق من التحديثات:**
  - التحقق من دقة التحديث
  - التحقق من اتساق التحديث
  - التحقق من اكتمال التحديث
  - التحقق من توقيت التحديث
- **إشعار أصحاب المصلحة:**
  - تحديد مستلمي الإشعارات
  - إعداد محتوى الإشعارات
  - إرسال الإشعارات
  - تتبع تسليم الإشعارات

## العملات المدعومة

### العملات الأساسية
- **الدولار الأمريكي (USD):** العملة الأساسية للنظام
- **الريال اليمني (YER):** العملة المحلية اليمنية
- **الريال السعودي (SAR):** العملة السعودية

### أزواج العملات المدعومة
- **USD إلى YER:** الدولار الأمريكي إلى الريال اليمني
- **USD إلى SAR:** الدولار الأمريكي إلى الريال السعودي
- **YER إلى SAR:** الريال اليمني إلى الريال السعودي

## مصادر أسعار الصرف

### المصادر اليدوية
- **إدخال يدوي:** إدخال أسعار الصرف يدوياً من قبل المديرين
- **التحقق اليدوي:** التحقق من صحة الأسعار يدوياً
- **التحديث اليدوي:** تحديث الأسعار يدوياً عند الحاجة

### المصادر التلقائية
- **APIs خارجية:** ربط النظام بـ APIs خارجية لأسعار الصرف
- **Fixer.io API:** مصدر موثوق لأسعار الصرف العالمية
- **CurrencyLayer API:** مصدر متقدم لأسعار الصرف
- **ExchangeRate-API:** مصدر مجاني لأسعار الصرف
- **APIs مخصصة:** ربط النظام بـ APIs مخصصة

### المصادر المختلطة
- **مصادر متعددة:** استخدام عدة مصادر للتحقق من دقة الأسعار
- **التحقق المتبادل:** مقارنة الأسعار من مصادر مختلفة
- **التحقق من التطابق:** التحقق من تطابق الأسعار من مصادر مختلفة

## خوارزميات التحويل

### التحويل الأساسي
```typescript
result = amount * exchangeRate
```

### التحويل مع الرسوم
```typescript
baseResult = amount * exchangeRate
fees = baseResult * feePercentage / 100
totalResult = baseResult + fees
```

### التحويل مع التقريب
```typescript
roundedResult = Math.round(result * Math.pow(10, decimalPlaces)) / Math.pow(10, decimalPlaces)
```

### التحويل المتقدم
```typescript
if (rateType === 'buy' && buyRate) {
  rate = buyRate
} else if (rateType === 'sell' && sellRate) {
  rate = sellRate
} else {
  rate = baseRate
}
result = amount * rate
```

## قواعد التحقق

### التحقق من صحة البيانات
- **تنسيق العملة:** التحقق من صحة رموز العملات
- **قيمة السعر:** التحقق من أن السعر موجب ورقمي
- **التواريخ:** التحقق من صحة تواريخ السريان
- **المصادر:** التحقق من صحة مصادر الأسعار

### التحقق من دقة التحويل
- **دقة الحساب:** التحقق من دقة العمليات الحسابية
- **دقة التقريب:** التحقق من دقة عمليات التقريب
- **دقة الرسوم:** التحقق من دقة حساب الرسوم
- **دقة النتائج:** التحقق من دقة النتائج النهائية

### التحقق من موثوقية المصادر
- **موثوقية المصدر:** التحقق من موثوقية مصادر الأسعار
- **دقة المصدر:** التحقق من دقة الأسعار من المصادر
- **اتساق المصدر:** التحقق من اتساق الأسعار من المصادر
- **توقيت المصدر:** التحقق من توقيت تحديث الأسعار

## الميزات المتقدمة

### 1. الذكاء الاصطناعي
- **التنبؤ بالأسعار:** التنبؤ بأسعار الصرف المستقبلية
- **تحليل الاتجاهات:** تحليل اتجاهات أسعار الصرف
- **اكتشاف الأنماط:** اكتشاف أنماط تغيير الأسعار
- **التوصيات الذكية:** توصيات ذكية لأسعار الصرف

### 2. الأتمتة المتقدمة
- **أتمتة التحديث:** تحديث تلقائي لأسعار الصرف
- **أتمتة التحقق:** تحقق تلقائي من دقة الأسعار
- **أتمتة الإشعارات:** إشعارات تلقائية عند التغيير
- **أتمتة التقارير:** تقارير تلقائية عن أداء النظام

### 3. التحليلات المتقدمة
- **تحليل الأداء:** تحليل أداء نظام أسعار الصرف
- **تحليل الدقة:** تحليل دقة أسعار الصرف
- **تحليل الموثوقية:** تحليل موثوقية المصادر
- **تحليل الاتجاهات:** تحليل اتجاهات أسعار الصرف

### 4. الأمان والامتثال
- **أمان البيانات:** حماية شاملة لبيانات أسعار الصرف
- **الامتثال للقوانين:** الالتزام باللوائح المحلية والدولية
- **الشفافية:** شفافية في عمليات أسعار الصرف
- **المساءلة:** نظام مساءلة شامل

## التكامل مع الأنظمة الأخرى

### تكامل مع نظام المنتجات
- **ربط أسعار المنتجات:** ربط أسعار المنتجات بأسعار الصرف
- **تحديث الأسعار:** تحديث أسعار المنتجات عند تغيير أسعار الصرف
- **عرض الأسعار:** عرض أسعار المنتجات بالعملة المختارة
- **تحويل الأسعار:** تحويل أسعار المنتجات بين العملات

### تكامل مع نظام الطلبات
- **ربط أسعار الطلبات:** ربط أسعار الطلبات بأسعار الصرف
- **تحديث الأسعار:** تحديث أسعار الطلبات عند تغيير أسعار الصرف
- **عرض الأسعار:** عرض أسعار الطلبات بالعملة المختارة
- **تحويل الأسعار:** تحويل أسعار الطلبات بين العملات

### تكامل مع نظام التسويق
- **ربط أسعار التسويق:** ربط أسعار التسويق بأسعار الصرف
- **تحديث الأسعار:** تحديث أسعار التسويق عند تغيير أسعار الصرف
- **عرض الأسعار:** عرض أسعار التسويق بالعملة المختارة
- **تحويل الأسعار:** تحويل أسعار التسويق بين العملات

### تكامل مع نظام التقارير
- **ربط بيانات التقارير:** ربط بيانات التقارير بأسعار الصرف
- **تحليل الأداء:** تحليل أداء أسعار الصرف
- **تتبع المؤشرات:** تتبع مؤشرات أداء أسعار الصرف
- **تحسين القرارات:** تحسين القرارات بناءً على بيانات أسعار الصرف

## نقاط مهمة
- **نظام متكامل:** إدارة شاملة لجميع جوانب أسعار الصرف
- **تحويل دقيق:** تحويل دقيق وموثوق للعملات
- **أتمتة متقدمة:** أتمتة متقدمة لتحديث أسعار الصرف
- **تحليلات شاملة:** تحليلات شاملة لأداء أسعار الصرف
- **أمان عالي:** حماية شاملة لبيانات أسعار الصرف
- **قابلية التوسع:** دعم النمو والتوسع
- **سهولة الصيانة:** صيانة سهلة ومبسطة
