# تدفقات السلة (Cart Flows)

## الملفات المتاحة
- `add-sync.mmd` - مخطط إضافة العناصر ومزامنة السلة
- `abandoned-cart.mmd` - مخطط استرداد السلات المهجورة

## شرح التدفقات

### 1. إضافة عنصر للسلة
- **دعم الزوار:** استخدام deviceId لتتبع السلة
- **دعم المستخدمين:** ربط السلة بـ userId
- **التحقق:** فحص توفر المنتج في المخزون
- **الحساب:** تحديث الأسعار والخصومات تلقائياً

### 2. مزامنة سلة الزائر
- **المشكلة:** الزوار يفقدون السلة عند التسجيل
- **الحل:** دمج سلة deviceId مع سلة userId
- **التنفيذ:** 
  - البحث عن سلة الزائر بالـ deviceId
  - دمج العناصر في سلة المستخدم
  - حذف سلة الزائر القديمة
  - تعيين علامة isMerged

### 3. استرداد السلات المهجورة
- **الكشف:** البحث عن السلات غير النشطة لمدة 24 ساعة
- **المرحلة الأولى:** إرسال تذكير أول بعد 24 ساعة
- **المرحلة الثانية:** تذكير مع خصم بعد 48 ساعة
- **المرحلة الأخيرة:** تذكير نهائي بعد 72 ساعة

### 4. حساب الأسعار
- **العروض التلقائية:** تطبيق كوبونات تلقائية
- **الخصومات:** حسب نوع الحساب
- **الضرائب:** حساب الضريبة حسب المنطقة
- **الشحن:** تقدير تكلفة الشحن

## نقاط مهمة
- حفظ تلقائي للسلة كل 5 ثوانٍ
- دعم أنواع حسابات متعددة (تجزئة/جملة/مهندس)
- تتبع هجر السلة (Abandoned Cart)
- حساب دقيق للأسعار مع الخصومات
- نظام استرداد ذكي للسلات المهجورة