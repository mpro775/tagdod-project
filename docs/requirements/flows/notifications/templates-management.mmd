%% Templates Management Flow
%% View at https://mermaid.live
flowchart TD
  A[استخدام قالب إشعار] --> B[استلام templateKey]
  B --> C[البحث في TEMPLATES object]
  C --> D{وجد القالب?}
  D -->|لا| E[إرجاع خطأ: قالب غير موجود]
  D -->|نعم| F[استرجاع القالب]

  F --> G[استلام بيانات المتغيرات]
  G --> H[استبدال المتغيرات في العنوان]
  H --> I[استبدال المتغيرات في الرسالة العربية]
  I --> J[استبدال المتغيرات في الرسالة الإنجليزية]

  J --> K[إنشاء رابط ديناميكي إذا كان مطلوباً]
  K --> L[إرجاع البيانات المعدلة]

  %% Template Structure
  M[هيكل القالب] --> N[title: نص العنوان]
  N --> O[body: نص الرسالة بالعربية]
  O --> P[bodyEn: نص الرسالة بالإنجليزية - اختياري]
  P --> Q[link: دالة توليد الرابط - اختياري]

  %% Variable Replacement Examples
  R[أمثلة المتغيرات] --> S[{{orderId}} - معرف الطلب]
  S --> T[{{amount}} - المبلغ]
  T --> U[{{currency}} - العملة]
  U --> V[{{userName}} - اسم المستخدم]
  V --> W[{{productName}} - اسم المنتج]

  %% Link Generation
  X[توليد الرابط] --> Y{نوع الكيان?}
  Y -->|طلب| Z[/orders/{{orderId}}]
  Y -->|خدمة| AA[/services/{{requestId}}]
  Y -->|منتج| BB[/products/{{productId}}]
  Y -->|حساب| CC[/profile]

  %% Template Categories
  DD[فئات القوالب] --> EE[Orders - طلبات]
  EE --> FF[Services - خدمات]
  FF --> GG[Products - منتجات]
  GG --> HH[Promotions - عروض]
  HH --> II[Account - حسابات]
  II --> JJ[System - نظام]
  JJ --> KK[Marketing - تسويق]
  KK --> LL[Payment - مدفوعات]

  %% End points
  L --> MM[نهاية - نجاح]
  E --> MM
  Z --> MM
  AA --> MM
  BB --> MM
  CC --> MM
