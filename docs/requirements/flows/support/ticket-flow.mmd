%% Support Ticket Flow
%% View at https://mermaid.live
flowchart TD
  A[تذكرة دعم جديدة] --> B[استلام البيانات]
  B --> B1[title, description - مطلوب]
  B1 --> B2[category, priority - اختياري]
  B2 --> B3[attachments, metadata - اختياري]

  B3 --> C[إنشاء التذكرة في قاعدة البيانات]
  C --> C1[status: OPEN]
  C1 --> C2[userId: معرف العميل]
  C2 --> C3[assignedTo: null]
  C3 --> C4[slaHours: 24]
  C4 --> C5[createdAt, updatedAt]

  C5 --> D[تغيير الحالات]
  D --> D1[OPEN → IN_PROGRESS]
  D1 --> D2[IN_PROGRESS → WAITING_FOR_USER]
  D2 --> D3[WAITING_FOR_USER → IN_PROGRESS]
  D3 --> D4[IN_PROGRESS → RESOLVED]
  D4 --> D5[RESOLVED → CLOSED]
  D5 --> D6[RATED - إكمال اختياري]

  D6 --> E[إضافة الرسائل]
  E --> E1[USER_MESSAGE - من العميل]
  E1 --> E2[ADMIN_REPLY - من الأدمن]
  E2 --> E3[SYSTEM_MESSAGE - تلقائي]

  E3 --> F[تتبع SLA]
  F --> F1[firstResponseAt - أول رد]
  F1 --> F2[slaDueDate - تاريخ انتهاء]
  F2 --> F3[slaBreached - تجاوز SLA]

  F3 --> G[تقييم التذكرة]
  G --> G1[rating: 1-5]
  G1 --> G2[feedback - اختياري]
  G2 --> G3[feedbackAt - تاريخ التقييم]

  G3 --> H[أرشفة التذكرة]
  H --> H1[isArchived: true]
  H1 --> H2[حفظ للبحث المستقبلي]

  %% Customer Actions
  I[إجراءات العميل] --> I1[POST /support/tickets - إنشاء]
  I1 --> I2[GET /support/tickets/my - عرض]
  I2 --> I3[GET /support/tickets/:id - تفاصيل]
  I3 --> I4[POST /support/tickets/:id/messages - رسالة]
  I4 --> I5[GET /support/tickets/:id/messages - قراءة]
  I5 --> I6[PUT /support/tickets/:id/archive - أرشفة]
  I6 --> I7[POST /support/tickets/:id/rate - تقييم]

  %% Admin Actions
  J[إجراءات الأدمن] --> J1[GET /admin/support/tickets - جميع]
  J1 --> J2[GET /admin/support/tickets/:id - تفاصيل]
  J2 --> J3[PATCH /admin/support/tickets/:id - تحديث]
  J3 --> J4[POST /admin/support/tickets/:id/messages - رد]
  J4 --> J5[GET /admin/support/stats - إحصائيات]
  J5 --> J6[GET /admin/support/sla/breached - SLA]
  J6 --> J7[POST /admin/support/sla/:id/check - فحص SLA]

  %% End points
  H2 --> K[نهاية - تذكرة مكتملة]
  D6 --> K
