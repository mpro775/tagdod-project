%% SLA Analytics Flow
%% View at https://mermaid.live
flowchart TD
  A[تحليلات SLA] --> B[تتبع أوقات الحل]
  A --> C[التذاكر المتجاوزة]
  A --> D[إحصائيات الأداء]

  %% SLA Tracking
  B --> B1[حساب slaDueDate]
  B1 --> B1A[slaDueDate = createdAt + slaHours]
  B1 --> B2[تتبع firstResponseAt]
  B2 --> B2A[firstResponseAt - أول رد من الأدمن]
  B2 --> B3[تتبع resolvedAt]
  B3 --> B3A[resolvedAt - تاريخ الحل]
  B3 --> B4[حساب slaBreached]
  B4 --> B4A[slaBreached = resolvedAt > slaDueDate]

  %% Breached Tickets
  C --> C1[GET /admin/support/sla/breached]
  C1 --> C2[فلترة التذاكر المتجاوزة]
  C2 --> C3[slaBreached: true]
  C3 --> C4[status: RESOLVED أو CLOSED]
  C4 --> C5[عرض قائمة التذاكر المتجاوزة]

  %% SLA Check
  D --> D1[POST /admin/support/sla/:id/check]
  D1 --> D2[فحص حالة SLA لتذكرة محددة]
  D2 --> D3[مقارنة التواريخ الحالية]
  D3 --> D4[تحديث slaBreached إذا لزم الأمر]
  D4 --> D5[إرجاع حالة SLA]

  %% Statistics Integration
  E[تكامل مع الإحصائيات] --> E1[GET /admin/support/stats]
  E1 --> E2[عدد التذاكر حسب SLA]
  E2 --> E3[نسبة التجاوز]
  E3 --> E4[متوسط وقت الحل]
  E4 --> E5[معدل الالتزام بـ SLA]

  %% Priority-based SLA
  F[أوقات SLA حسب الأولوية] --> F1[URGENT: 4 ساعات]
  F1 --> F2[HIGH: 12 ساعة]
  F2 --> F3[MEDIUM: 24 ساعة]
  F3 --> F4[LOW: 48 ساعة]

  F4 --> G[حساب SLA التلقائي]
  G --> G1[بناءً على priority]
  G1 --> G2[تحديث slaHours]
  G2 --> G3[حساب slaDueDate]

  %% Alerts & Notifications
  H[تنبيهات وإشعارات] --> H1[اقتراب انتهاء SLA]
  H1 --> H2[تجاوز SLA]
  H2 --> H3[إشعارات للأدمن]
  H3 --> H4[تنبيهات فورية]

  %% Performance Metrics
  I[مقاييس الأداء] --> I1[SLA Compliance Rate]
  I1 --> I1A[نسبة التذاكر المحلولة في الوقت]
  I1 --> I2[Average Resolution Time]
  I2 --> I2A[متوسط وقت الحل]
  I2 --> I3[First Response Time]
  I3 --> I3A[متوسط وقت الاستجابة الأولى]

  %% End points
  C5 --> J[نهاية - عرض التذاكر المتجاوزة]
  D5 --> J
  I3A --> J
