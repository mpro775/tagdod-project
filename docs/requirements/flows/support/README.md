# تدفقات الدعم الفني (Support Flows)

## الملفات المتاحة
- `ticket-flow.mmd` - مخطط تدفق تذاكر الدعم

## شرح التدفقات

### 1. نظام الدعم المتقدم (Advanced Support System)
- **التذاكر:** إنشاء وإدارة تذاكر الدعم مع تصنيف متقدم
- **الرسائل:** نظام رسائل فوري مع أنواع مختلفة
- **SLA Tracking:** تتبع أوقات الاستجابة مع تنبيهات
- **التقييمات:** نظام تقييم شامل مع feedback نصي
- **الإحصائيات:** تحليلات شاملة للأداء

### 2. نظام إدارة التذاكر المتقدم (Advanced Ticket Management)
- **إنشاء التذكرة:** مع تصنيف تلقائي وأولوية ذكية
- **التعيين:** تعيين تلقائي للموظف المناسب
- **التتبع:** تتبع شامل لحالة التذكرة
- **الأرشفة:** نظام أرشفة متقدم للبحث السريع
- **الوسوم:** نظام وسوم للتصنيف المتقدم

### 3. نظام الرسائل المتقدم (Advanced Message System)
- **أنواع الرسائل:** رسائل المستخدم، ردود الأدمن، رسائل النظام
- **المرفقات:** دعم رفع الملفات مع روابط آمنة
- **الرسائل الداخلية:** رسائل خاصة للأدمن فقط
- **التوقيت:** تتبع أوقات الإرسال والقراءة
- **المتابعة:** نظام متابعة ذكي للرسائل

### 4. نظام SLA Tracking المتقدم (Advanced SLA Tracking)
- **الأولوية:** 4 مستويات أولوية مع أوقات SLA مختلفة
  - **URGENT:** 1 ساعة
  - **HIGH:** 4 ساعات
  - **MEDIUM:** 24 ساعة
  - **LOW:** 48 ساعة
- **التنبيهات:** تنبيهات تلقائية عند تجاوز SLA
- **التقارير:** تقارير مفصلة عن أداء SLA
- **التحسين:** اقتراحات لتحسين الأداء

### 5. نظام Canned Responses المتقدم (Advanced Canned Responses)
- **الردود الجاهزة:** مكتبة شاملة من الردود الشائعة
- **التخصيص:** إمكانية تخصيص الردود حسب الحاجة
- **التصنيف:** تصنيف الردود حسب نوع المشكلة
- **الاستخدام:** توفير الوقت في الردود المتكررة
- **الإحصائيات:** تتبع أكثر الردود استخداماً

### 6. نظام Rating & Feedback المتقدم (Advanced Rating System)
- **التقييم:** نظام تقييم من 1-5 نجوم
- **Feedback:** تعليقات نصية مفصلة من العملاء
- **التتبع:** تتبع معدلات الرضا والتحسين
- **التقارير:** تقارير شاملة عن جودة الخدمة
- **التحليل:** تحليل نصي للتعليقات

### 7. نظام Admin Management المتقدم (Advanced Admin Management)
- **لوحة التحكم:** لوحة تحكم شاملة لإدارة التذاكر
- **التعيين:** تعيين تلقائي ويدوي للموظفين
- **التحديث:** تحديث حالة التذاكر والأولوية
- **الإحصائيات:** إحصائيات مفصلة عن الأداء
- **التقارير:** تقارير شاملة للفريق

### 8. نظام Statistics & Analytics المتقدم (Advanced Analytics)
- **معدلات الاستجابة:** تتبع أوقات الاستجابة الأولى
- **معدلات الحل:** تتبع معدلات حل المشاكل
- **رضا العملاء:** تتبع معدلات الرضا
- **أداء الفريق:** تحليل أداء كل موظف
- **الاتجاهات:** تحليل الاتجاهات والأنماط

### 9. نظام Metadata & Tags المتقدم (Advanced Metadata System)
- **البيانات الإضافية:** حفظ بيانات إضافية مثل orderId, productId
- **الوسوم:** نظام وسوم للتصنيف المتقدم
- **البحث:** بحث متقدم في التذاكر والرسائل
- **التصفية:** تصفية متقدمة حسب الوسوم والبيانات
- **التجميع:** تجميع التذاكر حسب المعايير

### 10. نظام Archive System المتقدم (Advanced Archive System)
- **الأرشفة:** أرشفة التذاكر المحلولة
- **البحث:** بحث سريع في الأرشيف
- **الاسترداد:** إمكانية استرداد التذاكر المؤرشفة
- **التنظيف:** تنظيف تلقائي للبيانات القديمة
- **النسخ الاحتياطي:** نسخ احتياطي آمن للبيانات

## هيكل البيانات

### حقول التذكرة الأساسية (Ticket Fields)
- `userId`: معرف المستخدم (ObjectId) - مطلوب
- `title`: عنوان المشكلة (string) - مطلوب
- `description`: وصف المشكلة (string) - مطلوب
- `category`: فئة المشكلة (enum) - مطلوب
- `priority`: أولوية المشكلة (enum) - مطلوب
- `status`: حالة التذكرة (enum) - مطلوب

### حقول التصنيف (Classification Fields)
- `assignedTo`: معين إلى (ObjectId) - اختياري
- `attachments`: المرفقات (array of strings) - افتراضي []
- `tags`: الوسوم (array of strings) - افتراضي []
- `isArchived`: مؤرشف (boolean) - افتراضي false

### حقول التوقيت (Timing Fields)
- `firstResponseAt`: أول رد (Date) - اختياري
- `resolvedAt`: تاريخ الحل (Date) - اختياري
- `closedAt`: تاريخ الإغلاق (Date) - اختياري

### حقول SLA (SLA Fields)
- `slaHours`: ساعات SLA (number) - افتراضي 24
- `slaDueDate`: تاريخ انتهاء SLA (Date) - اختياري
- `slaBreached`: تجاوز SLA (boolean) - افتراضي false

### حقول التقييم (Rating Fields)
- `rating`: التقييم (number) - اختياري (1-5)
- `feedback`: التعليق (string) - اختياري
- `feedbackAt`: تاريخ التقييم (Date) - اختياري

### حقول إضافية (Additional Fields)
- `metadata`: بيانات إضافية (object) - افتراضي {}

### فئات الدعم المتاحة (Support Categories)
1. **TECHNICAL** - فني
2. **BILLING** - فواتير
3. **PRODUCTS** - منتجات
4. **SERVICES** - خدمات
5. **ACCOUNT** - حساب
6. **OTHER** - أخرى

### أولويات الدعم المتاحة (Support Priorities)
1. **LOW** - منخفضة
2. **MEDIUM** - متوسطة
3. **HIGH** - عالية
4. **URGENT** - عاجلة

### حالات التذاكر المتاحة (Support Status)
1. **OPEN** - مفتوحة
2. **IN_PROGRESS** - قيد المعالجة
3. **WAITING_FOR_USER** - في انتظار المستخدم
4. **RESOLVED** - محلولة
5. **CLOSED** - مغلقة

## API Endpoints المتاحة

### للعملاء (7 endpoints)
- **POST /support/tickets** - إنشاء تذكرة
- **GET /support/tickets/my** - تذاكري
- **GET /support/tickets/:id** - تفاصيل تذكرة
- **POST /support/tickets/:id/messages** - إضافة رسالة
- **GET /support/tickets/:id/messages** - جلب الرسائل
- **POST /support/tickets/:id/rate** - تقييم التذكرة
- **DELETE /support/tickets/:id/archive** - أرشفة التذكرة

### للأدمن (8+ endpoints)
- **GET /admin/support/tickets** - جميع التذاكر
- **PATCH /admin/support/tickets/:id** - تحديث التذكرة
- **GET /admin/support/stats** - إحصائيات الدعم
- **POST /admin/support/canned-responses** - إدارة الردود الجاهزة
- **GET /admin/support/analytics** - تحليلات شاملة
- **POST /admin/support/assign** - تعيين التذاكر
- **GET /admin/support/sla-reports** - تقارير SLA
- **GET /admin/support/performance** - أداء الفريق

## DTOs المتاحة

### إنشاء التذكرة
- `CreateSupportTicketDto`: إنشاء تذكرة دعم
  - `title`: عنوان المشكلة (required)
  - `description`: وصف المشكلة (required)
  - `category`: فئة المشكلة (optional)
  - `priority`: أولوية المشكلة (optional)
  - `attachments`: المرفقات (optional)
  - `metadata`: بيانات إضافية (optional)

### إضافة الرسائل
- `AddSupportMessageDto`: إضافة رسالة
  - `content`: محتوى الرسالة (required)
  - `attachments`: المرفقات (optional)
  - `messageType`: نوع الرسالة (required)
  - `isInternal`: رسالة داخلية (optional)

### تقييم التذكرة
- `RateSupportTicketDto`: تقييم التذكرة
  - `rating`: التقييم (required) - 1-5
  - `feedback`: التعليق (optional)

### تحديث التذكرة
- `UpdateSupportTicketDto`: تحديث التذكرة
  - `status`: الحالة (optional)
  - `priority`: الأولوية (optional)
  - `assignedTo`: معين إلى (optional)
  - `tags`: الوسوم (optional)

## نقاط مهمة
- **SLA Tracking متقدم:** تتبع أوقات الاستجابة مع تنبيهات تلقائية
- **نظام رسائل فوري:** محادثة مباشرة بين العميل والدعم
- **Canned Responses:** ردود جاهزة لتوفير الوقت
- **تقييمات شاملة:** نظام تقييم 5 نجوم مع تعليقات
- **إحصائيات متقدمة:** تحليلات شاملة للأداء والرضا
- **أرشفة ذكية:** نظام أرشفة متقدم للبحث السريع
- **وسوم وبيانات إضافية:** تصنيف متقدم للبحث والتصفية
- **تكامل مع الإشعارات:** إشعارات تلقائية لجميع الأحداث
- **لوحة تحكم شاملة:** إدارة متقدمة للتذاكر والفريق
- **تقارير مفصلة:** تقارير شاملة عن الأداء والاتجاهات
