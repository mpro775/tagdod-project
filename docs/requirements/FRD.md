# وثيقة المتطلبات الوظيفية (FRD)
## Functional Requirements Document

### 1. نظرة عامة

**المشروع:** TagDoD - منصة خدمات الطاقة الشمسية المتقدمة  
**الإصدار:** 2.0  
**التاريخ:** ديسمبر 2024  
**الغرض:** تحديد المتطلبات الوظيفية التفصيلية للنظام المطبق فعلياً  

### 2. نطاق الوثيقة

تغطي هذه الوثيقة جميع المتطلبات الوظيفية للنظام بناءً على التحليل الشامل للكود المصدري والهيكل الحالي للمشروع المطبق. تم تحديث الوثيقة لتعكس الحالة الفعلية للنظام المتقدم الذي يتضمن:

- نظام مصادقة متقدم بـ OTP
- نظام سلة وطلبات ذكي مع تتبع شامل
- نظام تحليلات وتقارير احترافي
- نظام دعم فني مع SLA Tracking
- نظام أمان متقدم مع Rate Limiting
- نظام خدمات للمهندسين والعملاء
- نظام بحث متقدم مع Faceted Search
- نظام تسويق وعروض ترويجية شامل

### 3. المتطلبات الوظيفية

#### 3.1 إدارة المستخدمين والمصادقة (User Management & Authentication)

##### FR-001: نظام المصادقة بـ OTP
- **الوصف:** نظام مصادقة متقدم باستخدام OTP عبر الرسائل النصية
- **المدخلات:** رقم الهاتف، رمز OTP (6 أرقام)
- **المخرجات:** رموز JWT (Access & Refresh Token)
- **المميزات المطبقة:**
  - إرسال OTP آمن عبر Redis مع انتهاء صلاحية
  - دعم السياقات المختلفة (تسجيل، إعادة تعيين كلمة المرور)
  - رموز JWT محمية مع انتهاء صلاحية
  - دعم وضع التطوير مع رموز OTP ثابتة

##### FR-002: إدارة الملف الشخصي
- **الوصف:** إدارة شاملة لبيانات المستخدم الشخصية
- **المدخلات:** الاسم الأول، الاسم الأخير، الجنس، المسمى الوظيفي
- **المخرجات:** ملف شخصي محدث
- **المميزات المطبقة:**
  - تحديث البيانات الشخصية
  - إدارة كلمات المرور
  - حذف الحساب

##### FR-003: نظام الأدوار والقدرات المتقدم
- **الوصف:** نظام أدوار متعدد المستويات مع قدرات مخصصة
- **الأدوار المطبقة:**
  - العميل العادي (customer)
  - المهندس (engineer) - يتطلب موافقة
  - تاجر الجملة (wholesale) - يتطلب موافقة مع خصم مخصص
  - المدير (admin)
- **المميزات المطبقة:**
  - طلب ترقية الدور (engineer/wholesale)
  - نظام موافقة إداري
  - خصومات مخصصة لتجار الجملة
  - مزامنة المفضلات عند التسجيل

##### FR-004: إدارة قدرات المستخدمين
- **الوصف:** نظام شامل لإدارة وتتبع قدرات المستخدمين
- **الحالات:** نشط، معلق، مرفوض، في انتظار الموافقة
- **المميزات المطبقة:**
  - تتبع طلبات القدرات الجديدة
  - نظام موافقة إداري متقدم
  - تسجيل تاريخ التغييرات
  - إشعارات التحديثات

#### 3.2 إدارة المنتجات (Product Management)

##### FR-005: إضافة المنتجات
- **الوصف:** إضافة منتجات جديدة باللغتين العربية والإنجليزية
- **المدخلات:**
  - الاسم (عربي/إنجليزي)
  - الوصف (عربي/إنجليزي)
  - التصنيف
  - العلامة التجارية
  - الصور
  - السمات
- **المخرجات:** منتج جديد مع معرف فريد

##### FR-006: إدارة التصنيفات
- **الوصف:** نظام تصنيفات هرمية متعددة المستويات
- **المميزات:**
  - تصنيفات رئيسية وفرعية
  - ترتيب التصنيفات
  - إمكانية إخفاء/إظهار التصنيفات
  - SEO metadata لكل تصنيف

##### FR-007: إدارة السمات
- **الوصف:** نظام سمات مرن للمنتجات
- **أنواع السمات:**
  - اختيار واحد (مثل: اللون)
  - اختيار متعدد
  - نص حر
  - رقم
  - نعم/لا
- **المميزات:**
  - إمكانية الفلترة
  - ترتيب السمات
  - دعم الألوان والصور للقيم

##### FR-008: إدارة التنويعات
- **الوصف:** إدارة تنويعات المنتج (ألوان، أحجام، إلخ)
- **المدخلات:**
  - تركيب السمات
  - السعر
  - المخزون
  - الصورة الخاصة
- **المميزات:**
  - SKU فريد لكل تنويعة
  - تتبع المخزون
  - تحذيرات المخزون المنخفض

#### 3.3 نظام السلة والطلبات المتقدم (Advanced Cart & Order System)

##### FR-009: نظام السلة الذكي
- **الوصف:** سلة تسوق متقدمة مع ميزات ذكية
- **المميزات المطبقة:**
  - دعم المستخدمين المسجلين والزوار (deviceId)
  - حفظ تلقائي مع انتهاء صلاحية
  - حساب أسعار متقدم مع أسعار التنويعات
  - دعم العروض الترويجية والخصومات
  - مزامنة السلة عند تسجيل الدخول
  - تتبع نشاط السلة وآخر تحديث
  - إحصائيات شاملة للعربة

##### FR-010: نظام العربات المتروكة
- **الوصف:** إدارة ذكية للعربات المتروكة
- **المميزات المطبقة:**
  - كشف العربات المتروكة تلقائياً
  - إرسال تذكيرات تلقائية
  - إحصائيات قيمة العربات المتروكة
  - تنظيف تلقائي للعربات المنتهية الصلاحية
  - تقارير إدارية للعربات المتروكة

##### FR-011: عملية إنشاء الطلب المتقدمة
- **الوصف:** نظام طلبات شامل مع معاينة دقيقة
- **الخطوات المطبقة:**
  1. معاينة السلة مع الحسابات الدقيقة
  2. اختيار العنوان والشحن
  3. اختيار طريقة الدفع
  4. تطبيق الكوبونات والعروض
  5. تأكيد الطلب مع حجز المخزون
- **المخرجات:** طلب مع رقم فريد وتتبع شامل

##### FR-012: نظام تتبع الطلبات المتقدم
- **الوصف:** تتبع شامل للطلبات مع حالات متقدمة
- **الحالات المطبقة:**
  - في انتظار الدفع (pending)
  - مؤكد (confirmed)
  - قيد المعالجة (processing)
  - جاهز للشحن (ready_to_ship)
  - تم الشحن (shipped)
  - في الطريق للتوصيل (out_for_delivery)
  - تم التسليم (delivered)
  - مكتمل (completed)
  - ملغي (cancelled)
  - مسترد (refunded)
  - مُرجع (returned)
  - فشل الدفع (payment_failed)

##### FR-013: إدارة المخزون والحجوزات
- **الوصف:** نظام متقدم لإدارة المخزون والحجوزات
- **المميزات المطبقة:**
  - حجز تلقائي للكميات عند إنشاء الطلب
  - تثبيت المخزون عند الدفع
  - تحرير المخزون عند الإلغاء
  - سجل شامل لحركة المخزون
  - تتبع الكميات المحجوزة والمتاحة

##### FR-014: نظام التقييم والمراجعات
- **الوصف:** تقييم شامل للطلبات والخدمات
- **المميزات المطبقة:**
  - تقييم الطلبات من العملاء
  - إضافة مراجعات نصية
  - تتبع تاريخ التقييمات
  - إحصائيات التقييمات للمنتجات

#### 3.4 نظام الدفع (Payment System)

##### FR-013: طرق الدفع المتعددة
- **الطرق المدعومة:**
  - الدفع نقداً عند الاستلام (COD)
  - الدفع الإلكتروني (بطاقات الائتمان)
  - المحفظة الإلكترونية
  - التحويل البنكي
- **المميزات:**
  - تشفير بيانات الدفع
  - سجل المعاملات
  - إشعارات الدفع

#### 3.14 نظام التسويق والعروض الترويجية (Marketing & Promotions System)

##### FR-039: إدارة الكوبونات والعروض المتقدمة
- **الوصف:** نظام كوبونات وعروض ترويجية متقدم
- **أنواع الكوبونات المطبقة:**
  - خصم نسبة مئوية
  - خصم مبلغ ثابت
  - شحن مجاني
  - خصم على فئات محددة
- **الشروط المطبقة:**
  - حد أدنى للطلب
  - فترة صلاحية محددة
  - عدد مرات الاستخدام
  - فئات منتجات محددة
  - عملاء محددين أو عامين

##### FR-040: نظام قواعد التسعير المتقدم
- **الوصف:** نظام قواعد تسعير مرن ومتقدم
- **المميزات المطبقة:**
  - قواعد تسعير مخصصة
  - خصومات حسب الكمية
  - عروض زمنية محددة
  - خصومات العملاء المميزين
  - نظام نقاط الولاء
  - عروض المجموعات والطرود

##### FR-041: إدارة الحملات التسويقية
- **الوصف:** إدارة شاملة للحملات التسويقية
- **المميزات المطبقة:**
  - إنشاء وإدارة الحملات
  - جدولة الحملات الزمنية
  - تتبع فعالية الحملات
  - إحصائيات مفصلة للعروض
  - تحليل عائد الاستثمار (ROI)
  - تقارير أداء التسويق

#### 3.5 إدارة المخزون (Inventory Management)

##### FR-015: تتبع المخزون
- **الوصف:** نظام تتبع شامل للمخزون
- **المميزات:**
  - تتبع الكمية المتاحة
  - تحذيرات المخزون المنخفض
  - سجل حركة المخزون
  - إدارة الموردين

##### FR-016: إدارة الحجوزات
- **الوصف:** نظام حجز للمنتجات المطلوبة بشدة
- **المميزات:**
  - حجز مؤقت للعملاء
  - انتهاء صلاحية الحجز
  - إشعارات انتهاء الحجز

#### 3.13 نظام الدعم الفني المتقدم (Advanced Support System)

##### FR-036: نظام التذاكر مع SLA Tracking
- **الوصف:** نظام دعم فني متكامل مع تتبع أوقات الاستجابة
- **المميزات المطبقة:**
  - إنشاء وإدارة تذاكر الدعم
  - نظام أولويات متقدم (urgent, high, medium, low)
  - تتبع SLA تلقائي حسب الأولوية
  - نظام محادثة فوري بين العملاء والدعم
  - تقييمات شاملة للدعم
  - الردود الجاهزة (Canned Responses)
  - أرشفة التذاكر القديمة

##### FR-037: نظام إدارة SLA المتقدم
- **الوصف:** تتبع شامل لأوقات الاستجابة والحل
- **أوقات SLA المطبقة:**
  - عاجل (urgent): ساعة واحدة
  - عالي (high): 4 ساعات
  - متوسط (medium): 24 ساعة
  - منخفض (low): 48 ساعة
- **المميزات:**
  - تنبيهات تلقائية عند اقتراب انتهاء SLA
  - تقارير أداء الدعم
  - إحصائيات شاملة لحل المشاكل
  - تتبع وقت الاستجابة الأولي

##### FR-038: نظام الإشعارات المتعدد القنوات
- **الوصف:** نظام إشعارات شامل ومتعدد القنوات
- **القنوات المطبقة:**
  - الإشعارات في التطبيق
  - البريد الإلكتروني
  - الرسائل النصية
  - الإشعارات الفورية (Push Notifications)
  - WebSocket للتنبيهات المباشرة
- **أنواع الإشعارات المطبقة:**
  - تحديثات الطلبات والخدمات
  - عروض خاصة وترويجية
  - إشعارات المخزون والمنتجات
  - رسائل الدعم الفني
  - تحديثات النظام والأمان

#### 3.7 نظام التحليلات والتقارير المتقدم (Advanced Analytics & Reports)

##### FR-019: لوحة تحكم شاملة
- **الوصف:** لوحة تحكم تفاعلية مع مؤشرات KPI في الوقت الفعلي
- **المميزات المطبقة:**
  - مؤشرات الأداء الرئيسية (KPI) شاملة
  - مخططات تفاعلية متعددة الأبعاد
  - مقارنات زمنية مع الفترات السابقة
  - مراقبة الأداء التقني للنظام
  - تنبيهات ذكية للمؤشرات المهمة

##### FR-020: التحليلات المتعددة الأبعاد
- **الوصف:** تحليلات شاملة لجميع جوانب النظام
- **أنواع التحليلات المطبقة:**
  - تحليلات المستخدمين (التسجيل، النشاط، الأدوار)
  - تحليلات المنتجات (المبيعات، التقييمات، المخزون)
  - تحليلات الطلبات (الإيرادات، التحويل، المناطق)
  - تحليلات الخدمات (الأداء، المهندسين، التقييمات)
  - تحليلات الدعم (التذاكر، الأوقات، الرضا)
  - تحليلات الأداء التقني (الاستجابة، الأخطاء، التوفر)

##### FR-021: نظام التقارير الاحترافي
- **الوصف:** إنشاء وتصدير التقارير بصيغ متعددة
- **المميزات المطبقة:**
  - تقارير مخصصة حسب الطلب
  - تصدير بصيغ PDF، Excel، CSV، JSON
  - جدولة تلقائية للتقارير (يومية، أسبوعية، شهرية)
  - تقارير مقارنة بين الفترات
  - تحليل الاتجاهات والتوقعات
  - تقارير جغرافية وخرائط

##### FR-022: مؤشرات الأداء المتقدمة
- **الوصف:** حساب وتحليل مؤشرات الأداء الرئيسية
- **المؤشرات المطبقة:**
  - معدل التحويل ونمو الإيرادات
  - قيمة العميل مدى الحياة
  - معدل الاحتفاظ والارتداد
  - تكلفة اكتساب العميل
  - درجة رضا العملاء (NPS)
  - كفاءة الخدمات وحل المشاكل
  - توفر النظام وأوقات الاستجابة

#### 3.8 نظام الخدمات المتقدم (Advanced Services System)

##### FR-023: إدارة طلبات الخدمات
- **الوصف:** نظام شامل لإدارة طلبات الخدمات بين العملاء والمهندسين
- **المميزات المطبقة:**
  - إنشاء طلبات خدمات من العملاء
  - تخصيص طلبات للمهندسين المتاحين
  - تتبع حالة طلبات الخدمات
  - إدارة العناوين والمواقع
  - نظام تقدير الأسعار والعروض

##### FR-024: نظام العروض والمزايدة
- **الوصف:** نظام عروض تنافسي بين المهندسين
- **المميزات المطبقة:**
  - تقديم عروض من المهندسين
  - مقارنة العروض والاختيار
  - تتبع تاريخ العروض
  - نظام تقييم العروض
  - إدارة الميزانيات والمدفوعات

##### FR-025: إدارة قدرات المهندسين
- **الوصف:** نظام إدارة قدرات وتخصصات المهندسين
- **المميزات المطبقة:**
  - تصنيف المهندسين حسب التخصص
  - إدارة القدرات والمهارات
  - تتبع أداء المهندسين
  - نظام تقييم شامل
  - إحصائيات الأداء والرضا

#### 3.9 نظام المفضلات (Favorites System)

##### FR-026: إدارة المفضلات المتقدمة
- **الوصف:** نظام مفضلات شامل للمنتجات والخدمات
- **المميزات المطبقة:**
  - دعم المستخدمين المسجلين والزوار
  - مزامنة المفضلات عند التسجيل
  - تنظيم المفضلات بالوسوم والفئات
  - إحصائيات المشاهدات والتفاعل
  - مشاركة قوائم المفضلات

#### 3.15 إدارة العناوين المتقدمة (Advanced Address Management)

##### FR-042: نظام إدارة العناوين الشامل
- **الوصف:** نظام شامل لإدارة عناوين العملاء والمهندسين
- **المميزات المطبقة:**
  - عناوين متعددة لكل مستخدم
  - عنوان افتراضي قابل للتحديد
  - دعم الإحداثيات الجغرافية الدقيقة
  - سجل شامل لاستخدام العناوين
  - أنواع العناوين المتعددة (منزل، عمل، أخرى)
  - التحقق من صحة العناوين
  - ربط العناوين بالخدمات والطلبات

##### FR-043: نظام العملات وأسعار الصرف
- **الوصف:** إدارة العملات وأسعار الصرف المحدثة
- **المميزات المطبقة:**
  - دعم عملات متعددة
  - تحديث أسعار الصرف تلقائياً
  - تحويل الأسعار في الوقت الفعلي
  - إدارة العملات المحلية والدولية
  - تتبع تاريخ أسعار الصرف
  - حساب التكاليف بالعملات المختلفة

#### 3.10 نظام الأمان المتقدم (Advanced Security System)

##### FR-027: نظام تحديد معدل الطلبات (Rate Limiting)
- **الوصف:** حماية شاملة من الهجمات مع حدود متعددة المستويات
- **المميزات المطبقة:**
  - حدود متعددة للأنواع المختلفة (API، مصادقة، رفع ملفات)
  - حماية من هجمات DDoS والتزوير
  - استخدام Redis للأداء العالي
  - حدود مخصصة حسب نوع المستخدم
  - مراقبة تلقائية للانتهاكات

##### FR-028: حماية CORS متقدمة
- **الوصف:** إعدادات CORS احترافية مع دعم ديناميكي
- **المميزات المطبقة:**
  - إعدادات CORS مرنة ومتعددة البيئات
  - دعم متعدد النطاقات
  - حماية من هجمات CSRF
  - إعدادات مخصصة لكل endpoint

##### FR-029: نظام الحماية والمراقبة
- **الوصف:** حماية شاملة مع مراقبة التهديدات
- **المميزات المطبقة:**
  - كشف التهديدات تلقائياً
  - حماية IP وبصمات الأجهزة
  - تسجيل شامل للعمليات الأمنية
  - تنبيهات فورية للتهديدات
  - إدارة الجلسات الآمنة

##### FR-030: حماية البيانات والتشفير
- **الوصف:** تشفير شامل لحماية البيانات الحساسة
- **المميزات المطبقة:**
  - تشفير كلمات المرور باستخدام bcrypt
  - حماية البيانات الحساسة
  - تشفير التواصل بين الخدمات
  - إدارة آمنة للمفاتيح
  - حماية من SQL Injection

#### 3.11 إدارة المحتوى (Content Management)

##### FR-031: إدارة الوسائط المتقدمة
- **الوصف:** نظام إدارة شامل للملفات والصور
- **المميزات المطبقة:**
  - رفع وتنظيم الصور والملفات
  - تصنيف الملفات والفهرسة
  - ضغط الصور تلقائياً
  - حماية الملفات والوصول
  - سجل شامل لاستخدام الملفات
  - دعم أنواع ملفات متعددة

##### FR-032: إدارة البانرات والإعلانات
- **الوصف:** نظام إدارة البانرات والعروض الإعلانية
- **المميزات المطبقة:**
  - بانرات متعددة المواضع
  - جدولة ظهور البانرات
  - إحصائيات المشاهدات والنقرات
  - تتبع فعالية الإعلانات
  - إدارة الحملات الإعلانية

#### 3.12 نظام البحث المتقدم (Advanced Search System)

##### FR-033: البحث الشامل والمتقدم
- **الوصف:** نظام بحث احترافي مع فلترة متقدمة
- **المميزات المطبقة:**
  - بحث شامل (منتجات، فئات، براندات)
  - فلترة متقدمة (سعر، سمات، تقييم)
  - Faceted Search (فلاتر ديناميكية)
  - دعم ثنائي اللغة (عربي/إنجليزي)
  - Autocomplete (اقتراحات ذكية)
  - Relevance Scoring (ترتيب دقيق)

##### FR-034: نظام الاقتراحات الذكية
- **الوصف:** اقتراحات ذكية ومتنوعة للبحث
- **المميزات المطبقة:**
  - اقتراحات البحث التلقائية
  - اقتراحات المنتجات المترابطة
  - اقتراحات الفئات والبراندات
  - تتبع اتجاهات البحث
  - تحسين نتائج البحث باستمرار

##### FR-035: البحث المتقدم والفلترة
- **الوصف:** فلاتر متقدمة ومتعددة الأبعاد
- **المميزات المطبقة:**
  - فلاتر النص والسعر
  - فلاتر الفئات والبراندات
  - فلاتر السمات والتقييمات
  - فلاتر الوسوم والخصائص
  - ترتيب النتائج حسب معايير متعددة

### 4. المتطلبات غير الوظيفية

#### 4.1 الأداء
- وقت الاستجابة أقل من 3 ثوانٍ
- دعم 1000 مستخدم متزامن
- توفر النظام 99.5% من الوقت

#### 4.2 الأمان
- تشفير كلمات المرور
- حماية من SQL Injection
- التحقق من الصلاحيات
- سجل العمليات الأمنية

#### 4.3 التوافقية
- دعم المتصفحات الحديثة
- استجابة كاملة للأجهزة المحمولة
- دعم اللغة العربية والإنجليزية

### 5. قواعد البيانات

#### 5.1 الجداول الرئيسية
- Users (المستخدمين)
- Products (المنتجات)
- Categories (التصنيفات)
- Variants (التنويعات)
- Orders (الطلبات)
- Cart (السلة)
- Addresses (العناوين)
- Media (الوسائط)

#### 5.2 العلاقات
- علاقات One-to-Many بين المستخدمين والطلبات
- علاقات Many-to-Many بين المنتجات والسمات
- علاقات هرمية في التصنيفات

### 6. واجهات النظام

#### 6.1 واجهة المستخدم
- واجهة ويب متجاوبة
- تطبيق جوال (PWA)
- لوحة تحكم إدارية

#### 6.2 واجهات البرمجة (APIs)
- RESTful APIs
- GraphQL (اختياري)
- WebSocket للتنبيهات الفورية

### 7. التكاملات الخارجية

#### 7.1 خدمات الدفع
- Moyasar
- Stripe
- PayPal

#### 7.2 خدمات الشحن
- شركات الشحن المحلية
- APIs لتتبع الشحنات

#### 7.3 خدمات الإشعارات
- Firebase Cloud Messaging
- SendGrid للبريد الإلكتروني
- Twilio للرسائل النصية

### 8. الاختبارات

#### 8.1 أنواع الاختبارات
- اختبارات الوحدة (Unit Tests)
- اختبارات التكامل (Integration Tests)
- اختبارات الأداء (Performance Tests)
- اختبارات الأمان (Security Tests)

#### 8.2 معايير القبول
- نجاح 95% من الاختبارات الوظيفية
- اجتياز جميع اختبارات الأمان
- تحقيق متطلبات الأداء

### 9. التدريب والدعم

#### 9.1 تدريب المستخدمين
- دليل المستخدم النهائي
- فيديوهات تعليمية
- جلسات تدريبية للمديرين

#### 9.2 الدعم التقني
- دليل المطورين
- وثائق API
- نظام تتبع المشاكل

### 10. حالة التطوير الحالية

#### ✅ المرحلة الأولى - مكتملة (شهور 1-6)
- ✅ نظام المصادقة المتقدم بـ OTP
- ✅ إدارة المستخدمين والأدوار المتقدمة
- ✅ إدارة المنتجات والتصنيفات والسمات
- ✅ نظام السلة الذكي والعربات المتروكة
- ✅ نظام الطلبات المتقدم مع تتبع شامل
- ✅ إدارة المخزون والحجوزات
- ✅ نظام الأمان المتقدم مع Rate Limiting
- ✅ نظام البحث المتقدم مع Faceted Search

#### ✅ المرحلة الثانية - مكتملة (شهور 7-12)
- ✅ نظام التحليلات والتقارير الاحترافية
- ✅ نظام الدعم الفني مع SLA Tracking
- ✅ نظام الإشعارات المتعدد القنوات
- ✅ نظام التسويق والعروض الترويجية
- ✅ نظام الخدمات للمهندسين والعملاء
- ✅ إدارة العناوين والعملات المتقدمة
- ✅ نظام المفضلات والإدارة المتقدمة

#### 🚀 المرحلة الثالثة - قيد التطوير (شهور 13-18)
- 🔄 تحسينات الأداء والاستقرار
- 🔄 ميزات إضافية للتحليلات
- 🔄 تكاملات خارجية متقدمة
- 🔄 تطبيق الجوال (Mobile App)
- 🔄 نظام الذكاء الاصطناعي والتنبؤات
- 🔄 تحسينات تجربة المستخدم

### 11. الموافقات

**من مدير المشروع:** _________________ تاريخ: _________  
**من مدير التطوير:** _________________ تاريخ: _________  
**من مدير الجودة:** _________________ تاريخ: _________
