# ğŸ“ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† (Addresses Service)

> âœ… **ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚**: 100% Ù…ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠ ÙÙŠ Backend  
> ğŸ“… **Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«**: Ø£ÙƒØªÙˆØ¨Ø± 2025

Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªÙˆÙØ± endpoints Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (**coords Ø¥Ø¬Ø¨Ø§Ø±ÙŠ**).

---

## ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

1. [Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†](#1-Ù‚Ø§Ø¦Ù…Ø©-Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†)
2. [Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù†Ø´Ø·Ø©](#2-Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†-Ø§Ù„Ù†Ø´Ø·Ø©)
3. [Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ](#3-Ø§Ù„Ø¹Ù†ÙˆØ§Ù†-Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ)
4. [Ø¹Ù†ÙˆØ§Ù† Ù…Ø­Ø¯Ø¯](#4-Ø¹Ù†ÙˆØ§Ù†-Ù…Ø­Ø¯Ø¯)
5. [Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯](#5-Ø¥Ù†Ø´Ø§Ø¡-Ø¹Ù†ÙˆØ§Ù†-Ø¬Ø¯ÙŠØ¯)
6. [ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù†](#6-ØªØ­Ø¯ÙŠØ«-Ø¹Ù†ÙˆØ§Ù†)
7. [Ø­Ø°Ù Ø¹Ù†ÙˆØ§Ù†](#7-Ø­Ø°Ù-Ø¹Ù†ÙˆØ§Ù†)
8. [ØªØ¹ÙŠÙŠÙ† ÙƒØ¹Ù†ÙˆØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ](#8-ØªØ¹ÙŠÙŠÙ†-ÙƒØ¹Ù†ÙˆØ§Ù†-Ø§ÙØªØ±Ø§Ø¶ÙŠ)
9. [Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¹Ù†ÙˆØ§Ù† Ù…Ø­Ø°ÙˆÙ](#9-Ø§Ø³ØªØ¹Ø§Ø¯Ø©-Ø¹Ù†ÙˆØ§Ù†-Ù…Ø­Ø°ÙˆÙ)
10. [Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ©](#10-Ø§Ù„ØªØ­Ù‚Ù‚-Ù…Ù†-Ø§Ù„Ù…Ù„ÙƒÙŠØ©)
11. [Models ÙÙŠ Flutter](#models-ÙÙŠ-flutter)

---

## 1. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†

ÙŠØ³ØªØ±Ø¬Ø¹ Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©.

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `GET`
- **Endpoint:** `/addresses`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Query Parameters

| Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ | Ø§Ù„Ù†ÙˆØ¹ | Ù…Ø·Ù„ÙˆØ¨ | Ø§Ù„ÙˆØµÙ |
|---------|------|-------|-------|
| `includeDeleted` | `boolean` | âŒ | ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© |

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "addresses": [
    {
      "_id": "64addr123",
      "userId": "64user456",
      "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
      "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
      "city": "ØµÙ†Ø¹Ø§Ø¡",
      "coords": {
        "lat": 15.3694,
        "lng": 44.1910
      },
      "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
      "isDefault": true,
      "isActive": true,
      "lastUsedAt": "2025-01-15T10:00:00.000Z",
      "usageCount": 15,
      "createdAt": "2025-01-01T00:00:00.000Z",
      "updatedAt": "2025-01-15T10:00:00.000Z"
    }
  ],
  "count": 1,
  "requestId": "req_addr_001"
}
```

### ÙƒÙˆØ¯ Flutter

```dart
Future<List<Address>> getAddresses({bool includeDeleted = false}) async {
  final response = await _dio.get(
    '/addresses',
    queryParameters: {
      if (includeDeleted) 'includeDeleted': 'true',
    },
  );

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    final addresses = (apiResponse.data!['addresses'] as List)
        .map((item) => Address.fromJson(item))
        .toList();
    return addresses;
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## 2. Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù†Ø´Ø·Ø©

ÙŠØ³ØªØ±Ø¬Ø¹ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø· (ØºÙŠØ± Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©).

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `GET`
- **Endpoint:** `/addresses/active`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "addresses": [
    {
      "_id": "64addr123",
      "userId": "64user456",
      "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
      "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
      "city": "ØµÙ†Ø¹Ø§Ø¡",
      "coords": {
        "lat": 15.3694,
        "lng": 44.1910
      },
      "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
      "isDefault": true,
      "isActive": true,
      "lastUsedAt": "2025-01-15T10:00:00.000Z",
      "usageCount": 15,
      "createdAt": "2025-01-01T00:00:00.000Z",
      "updatedAt": "2025-01-15T10:00:00.000Z"
    }
  ],
  "count": 1,
  "requestId": "req_addr_002"
}
```

### ÙƒÙˆØ¯ Flutter

```dart
Future<List<Address>> getActiveAddresses() async {
  final response = await _dio.get('/addresses/active');

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    final addresses = (apiResponse.data!['addresses'] as List)
        .map((item) => Address.fromJson(item))
        .toList();
    return addresses;
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## 3. Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ

ÙŠØ³ØªØ±Ø¬Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `GET`
- **Endpoint:** `/addresses/default`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "address": {
    "_id": "64addr123",
    "userId": "64user456",
    "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
    "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
    "city": "ØµÙ†Ø¹Ø§Ø¡",
    "coords": {
      "lat": 15.3694,
      "lng": 44.1910
    },
    "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
    "isDefault": true,
    "isActive": true,
    "lastUsedAt": "2025-01-15T10:00:00.000Z",
    "usageCount": 15,
    "createdAt": "2025-01-01T00:00:00.000Z",
    "updatedAt": "2025-01-15T10:00:00.000Z"
  },
  "requestId": "req_addr_003"
}
```

### Response - Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù†ÙˆØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ

```json
{
  "success": true,
  "address": null,
  "message": "No addresses found. Please add an address first.",
  "requestId": "req_addr_003"
}
```

### ÙƒÙˆØ¯ Flutter

```dart
Future<Address?> getDefaultAddress() async {
  final response = await _dio.get('/addresses/default');

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    final addressData = apiResponse.data!['address'];
    return addressData != null ? Address.fromJson(addressData) : null;
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## 4. Ø¹Ù†ÙˆØ§Ù† Ù…Ø­Ø¯Ø¯

ÙŠØ³ØªØ±Ø¬Ø¹ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­Ø¯Ø¯ Ø¨Ø§Ù„Ù€ ID.

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `GET`
- **Endpoint:** `/addresses/:id`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "address": {
    "_id": "64addr123",
    "userId": "64user456",
    "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
    "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
    "city": "ØµÙ†Ø¹Ø§Ø¡",
    "coords": {
      "lat": 15.3694,
      "lng": 44.1910
    },
    "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
    "isDefault": true,
    "isActive": true,
    "lastUsedAt": "2025-01-15T10:00:00.000Z",
    "usageCount": 15,
    "createdAt": "2025-01-01T00:00:00.000Z",
    "updatedAt": "2025-01-15T10:00:00.000Z"
  },
  "requestId": "req_addr_004"
}
```

### ÙƒÙˆØ¯ Flutter

```dart
Future<Address> getAddress(String id) async {
  final response = await _dio.get('/addresses/$id');

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    return Address.fromJson(apiResponse.data!['address']);
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## 5. Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯

ÙŠÙ†Ø´Ø¦ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `POST`
- **Endpoint:** `/addresses`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Request Body

```json
{
  "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
  "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
  "city": "ØµÙ†Ø¹Ø§Ø¡",
  "coords": {
    "lat": 15.3694,
    "lng": 44.1910
  },
  "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
  "isDefault": true
}
```

**Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:**
- `coords` Ø¥Ø¬Ø¨Ø§Ø±ÙŠ (required)
- `label`, `line1`, `city` Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©
- `notes`, `isDefault` Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "message": "Address created successfully",
  "address": {
    "_id": "64addr123",
    "userId": "64user456",
    "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
    "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
    "city": "ØµÙ†Ø¹Ø§Ø¡",
    "coords": {
      "lat": 15.3694,
      "lng": 44.1910
    },
    "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
    "isDefault": true,
    "isActive": true,
    "usageCount": 0,
    "createdAt": "2025-01-15T10:00:00.000Z",
    "updatedAt": "2025-01-15T10:00:00.000Z"
  },
  "requestId": "req_addr_005"
}
```

### ÙƒÙˆØ¯ Flutter

```dart
Future<Address> createAddress({
  required String label,
  required String line1,
  required String city,
  required AddressCoords coords,
  String? notes,
  bool isDefault = false,
}) async {
  final response = await _dio.post('/addresses', data: {
    'label': label,
    'line1': line1,
    'city': city,
    'coords': coords.toJson(),
    if (notes != null) 'notes': notes,
    'isDefault': isDefault,
  });

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    return Address.fromJson(apiResponse.data!['address']);
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## 6. ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù†

ÙŠØ­Ø¯Ø« Ø¹Ù†ÙˆØ§Ù† Ù…ÙˆØ¬ÙˆØ¯.

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `PATCH`
- **Endpoint:** `/addresses/:id`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Request Body

```json
{
  "label": "Ø§Ù„Ù…Ù†Ø²Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
  "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
  "city": "ØµÙ†Ø¹Ø§Ø¡",
  "coords": {
    "lat": 15.3694,
    "lng": 44.1910
  },
  "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
  "isDefault": true,
  "isActive": true
}
```

**Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©** - ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØ­Ø¯ÙŠØ«Ù‡Ø§ ÙÙ‚Ø·.

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "message": "Address updated successfully",
  "address": {
    "_id": "64addr123",
    "userId": "64user456",
    "label": "Ø§Ù„Ù…Ù†Ø²Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
    "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
    "city": "ØµÙ†Ø¹Ø§Ø¡",
    "coords": {
      "lat": 15.3694,
      "lng": 44.1910
    },
    "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
    "isDefault": true,
    "isActive": true,
    "lastUsedAt": "2025-01-15T10:00:00.000Z",
    "usageCount": 15,
    "createdAt": "2025-01-01T00:00:00.000Z",
    "updatedAt": "2025-01-15T11:00:00.000Z"
  },
  "requestId": "req_addr_006"
}
```

### ÙƒÙˆØ¯ Flutter

```dart
Future<Address> updateAddress({
  required String id,
  String? label,
  String? line1,
  String? city,
  AddressCoords? coords,
  String? notes,
  bool? isDefault,
  bool? isActive,
}) async {
  final data = <String, dynamic>{};
  if (label != null) data['label'] = label;
  if (line1 != null) data['line1'] = line1;
  if (city != null) data['city'] = city;
  if (coords != null) data['coords'] = coords.toJson();
  if (notes != null) data['notes'] = notes;
  if (isDefault != null) data['isDefault'] = isDefault;
  if (isActive != null) data['isActive'] = isActive;

  final response = await _dio.patch('/addresses/$id', data: data);

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    return Address.fromJson(apiResponse.data!['address']);
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## 7. Ø­Ø°Ù Ø¹Ù†ÙˆØ§Ù†

ÙŠØ­Ø°Ù Ø¹Ù†ÙˆØ§Ù† (Ø­Ø°Ù Ù†Ø§Ø¹Ù…).

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `DELETE`
- **Endpoint:** `/addresses/:id`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "message": "Address deleted successfully",
  "result": {
    "deleted": true
  },
  "requestId": "req_addr_007"
}
```

### Errors

| Code | HTTP Status | Ø§Ù„ÙˆØµÙ |
|------|-------------|-------|
| `Address not found` | 404 | Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ |
| `Cannot delete your only address` | 400 | Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯ |

### ÙƒÙˆØ¯ Flutter

```dart
Future<bool> deleteAddress(String id) async {
  final response = await _dio.delete('/addresses/$id');

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    return apiResponse.data!['result']['deleted'] ?? false;
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## 8. ØªØ¹ÙŠÙŠÙ† ÙƒØ¹Ù†ÙˆØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ

ÙŠØ¹ÙŠÙ† Ø¹Ù†ÙˆØ§Ù† ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `POST`
- **Endpoint:** `/addresses/:id/set-default`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "message": "Default address set successfully",
  "address": {
    "_id": "64addr123",
    "userId": "64user456",
    "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
    "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
    "city": "ØµÙ†Ø¹Ø§Ø¡",
    "coords": {
      "lat": 15.3694,
      "lng": 44.1910
    },
    "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
    "isDefault": true,
    "isActive": true,
    "lastUsedAt": "2025-01-15T10:00:00.000Z",
    "usageCount": 15,
    "createdAt": "2025-01-01T00:00:00.000Z",
    "updatedAt": "2025-01-15T11:00:00.000Z"
  },
  "requestId": "req_addr_008"
}
```

### ÙƒÙˆØ¯ Flutter

```dart
Future<Address> setDefaultAddress(String id) async {
  final response = await _dio.post('/addresses/$id/set-default');

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    return Address.fromJson(apiResponse.data!['address']);
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## 9. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¹Ù†ÙˆØ§Ù† Ù…Ø­Ø°ÙˆÙ

ÙŠØ³ØªØ¹ÙŠØ¯ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­Ø°ÙˆÙ (Ø­Ø°Ù Ù†Ø§Ø¹Ù…).

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `POST`
- **Endpoint:** `/addresses/:id/restore`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "message": "Address restored successfully",
  "address": {
    "_id": "64addr123",
    "userId": "64user456",
    "label": "Ø§Ù„Ù…Ù†Ø²Ù„",
    "line1": "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ØªÙŠÙ†ØŒ Ø¨Ø¬ÙˆØ§Ø± Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù„Ø·Ø§Ù†",
    "city": "ØµÙ†Ø¹Ø§Ø¡",
    "coords": {
      "lat": 15.3694,
      "lng": 44.1910
    },
    "notes": "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„",
    "isDefault": false,
    "isActive": true,
    "lastUsedAt": "2025-01-15T10:00:00.000Z",
    "usageCount": 15,
    "createdAt": "2025-01-01T00:00:00.000Z",
    "updatedAt": "2025-01-15T11:00:00.000Z"
  },
  "requestId": "req_addr_009"
}
```

### Errors

| Code | HTTP Status | Ø§Ù„ÙˆØµÙ |
|------|-------------|-------|
| `Address not found` | 404 | Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ |
| `Address is not deleted` | 400 | Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„ÙŠØ³ Ù…Ø­Ø°ÙˆÙØ§Ù‹ |

### ÙƒÙˆØ¯ Flutter

```dart
Future<Address> restoreAddress(String id) async {
  final response = await _dio.post('/addresses/$id/restore');

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    return Address.fromJson(apiResponse.data!['address']);
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## 10. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ©

ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙŠØ®Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨

- **Method:** `GET`
- **Endpoint:** `/addresses/validate/:id`
- **Auth Required:** âœ… Ù†Ø¹Ù…
- **Cache:** âŒ Ù„Ø§

### Response - Ù†Ø¬Ø§Ø­

```json
{
  "success": true,
  "data": {
    "valid": true
  },
  "requestId": "req_addr_010"
}
```

### ÙƒÙˆØ¯ Flutter

```dart
Future<bool> validateAddressOwnership(String id) async {
  final response = await _dio.get('/addresses/validate/$id');

  final apiResponse = ApiResponse<Map<String, dynamic>>.fromJson(
    response.data,
    (json) => json as Map<String, dynamic>,
  );

  if (apiResponse.isSuccess) {
    return apiResponse.data!['valid'] ?? false;
  } else {
    throw ApiException(apiResponse.error!);
  }
}
```

---

## Models ÙÙŠ Flutter

### Ù…Ù„Ù: `lib/models/address/address_models.dart`

```dart
class Address {
  final String id;
  final String userId;
  final String label;
  final String line1;
  final String city;
  final AddressCoords coords;
  final String? notes;
  final bool isDefault;
  final bool isActive;
  final DateTime? lastUsedAt;
  final int usageCount;
  final DateTime createdAt;
  final DateTime updatedAt;

  Address({
    required this.id,
    required this.userId,
    required this.label,
    required this.line1,
    required this.city,
    required this.coords,
    this.notes,
    required this.isDefault,
    required this.isActive,
    this.lastUsedAt,
    required this.usageCount,
    required this.createdAt,
    required this.updatedAt,
  });

  factory Address.fromJson(Map<String, dynamic> json) {
    return Address(
      id: json['_id'],
      userId: json['userId'],
      label: json['label'] ?? '',
      line1: json['line1'] ?? '',
      city: json['city'] ?? '',
      coords: AddressCoords.fromJson(json['coords']),
      notes: json['notes'],
      isDefault: json['isDefault'] ?? false,
      isActive: json['isActive'] ?? true,
      lastUsedAt: json['lastUsedAt'] != null 
          ? DateTime.parse(json['lastUsedAt']) 
          : null,
      usageCount: json['usageCount'] ?? 0,
      createdAt: DateTime.parse(json['createdAt']),
      updatedAt: DateTime.parse(json['updatedAt']),
    );
  }

  String get fullAddress => '$line1, $city';
  String get shortAddress => city;

  bool get hasNotes => notes != null && notes!.isNotEmpty;
  bool get isRecentlyUsed => lastUsedAt != null && 
      DateTime.now().difference(lastUsedAt!).inDays < 7;
  bool get isFrequentlyUsed => usageCount > 10;
}

class AddressCoords {
  final double lat;
  final double lng;

  AddressCoords({
    required this.lat,
    required this.lng,
  });

  factory AddressCoords.fromJson(Map<String, dynamic> json) {
    return AddressCoords(
      lat: (json['lat'] ?? 0).toDouble(),
      lng: (json['lng'] ?? 0).toDouble(),
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'lat': lat,
      'lng': lng,
    };
  }

  bool get isValid => lat != 0 && lng != 0;
  String get displayString => '${lat.toStringAsFixed(6)}, ${lng.toStringAsFixed(6)}';
}
```

---

## ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©

1. **Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ù…Ø¨Ø³Ø·):**
   - `label`: ØªØ³Ù…ÙŠØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ù…Ø«Ù„: "Ø§Ù„Ù…Ù†Ø²Ù„", "Ø§Ù„Ù…ÙƒØªØ¨") - **Ø¥Ø¬Ø¨Ø§Ø±ÙŠ**
   - `line1`: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ØŒ Ø§Ù„ØªÙØ§ØµÙŠÙ„) - **Ø¥Ø¬Ø¨Ø§Ø±ÙŠ**
   - `city`: Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© - **Ø¥Ø¬Ø¨Ø§Ø±ÙŠ**
   - `coords`: Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ© (lat, lng) - **Ø¥Ø¬Ø¨Ø§Ø±ÙŠ**
   - `notes`: Ù…Ù„Ø§Ø­Ø¸Ø§Øª/ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… - **Ø§Ø®ØªÙŠØ§Ø±ÙŠ**

2. **Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (coords) Ø¥Ø¬Ø¨Ø§Ø±ÙŠ:**
   - ÙŠØ¬Ø¨ Ø¥Ø±Ø³Ø§Ù„ `coords` Ù…Ø¹ ÙƒÙ„ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯
   - Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø¹Ù†ÙˆØ§Ù† Ø¨Ø¯ÙˆÙ† Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
   - Ø§Ø³ØªØ®Ø¯Ù… Google Maps API Ø£Ùˆ Ø®Ø¯Ù…Ø© Ù…Ù…Ø§Ø«Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª

3. **Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:**
   - `usageCount`: Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
   - `lastUsedAt`: Ø¢Ø®Ø± Ù…Ø±Ø© Ø§Ø³ØªØ®Ø¯Ù… ÙÙŠÙ‡Ø§
   - `isRecentlyUsed`: Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø¤Ø®Ø±Ø§Ù‹ (Ø£Ù‚Ù„ Ù…Ù† 7 Ø£ÙŠØ§Ù…)
   - `isFrequentlyUsed`: Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙƒØ«Ø±Ø© (Ø£ÙƒØ«Ø± Ù…Ù† 10 Ù…Ø±Ø§Øª)

4. **Ø§Ù„Ø­Ø§Ù„Ø©:**
   - `isDefault`: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø£ÙˆÙ„ Ø¹Ù†ÙˆØ§Ù† ÙŠØµØ¨Ø­ Ø§ÙØªØ±Ø§Ø¶ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
   - `isActive`: Ù†Ø´Ø· Ø£Ù… Ù„Ø§
   - `hasNotes`: ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù„Ø§Ø­Ø¸Ø§Øª

5. **Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:**
   - Ø§Ø³ØªØ®Ø¯Ù… `fullAddress` Ù„Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„ (line1, city)
   - Ø§Ø³ØªØ®Ø¯Ù… `shortAddress` Ù„Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø®ØªØµØ± (city ÙÙ‚Ø·)
   - Ø§Ø¹Ø±Ø¶ `isRecentlyUsed` Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ù…Ø¤Ø®Ø±Ø§Ù‹
   - Ø§Ø¹Ø±Ø¶ `isFrequentlyUsed` Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ø¨ÙƒØ«Ø±Ø©

6. **Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ©:**
   - Ø§Ø³ØªØ®Ø¯Ù… `validateAddressOwnership()` Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
   - ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙŠØ®Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…

7. **Ø§Ù„Ø­Ø°Ù ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©:**
   - Ø§Ù„Ø­Ø°Ù Ù†Ø§Ø¹Ù… (soft delete)
   - **Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­ÙŠØ¯** - ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ø¯ÙŠÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø­Ø¯
   - ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
   - Ø§Ø³ØªØ®Ø¯Ù… `includeDeleted: true` Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©

8. **Ø§Ù„Ø£Ø¯Ø§Ø¡:**
   - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ endpoints ØªØªØ·Ù„Ø¨ Ù…ØµØ§Ø¯Ù‚Ø©
   - Ù„Ø§ ÙŠÙˆØ¬Ø¯ cache Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† (Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ©)
   - Ø§Ø³ØªØ®Ø¯Ù… `getActiveAddresses()` Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø·

9. **âš ï¸ ØªØºÙŠÙŠØ±Ø§Øª Ù…Ù‡Ù…Ø© Ø¹Ù† Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚:**
   - **ØªÙ… Ø¥Ø²Ø§Ù„Ø©**: `addressType`, `recipientName`, `recipientPhone`, `line2`, `region`, `country`, `postalCode`, `placeId`
   - **Ø§Ù„Ø¢Ù† Ø¥Ø¬Ø¨Ø§Ø±ÙŠ**: `coords` (ÙƒØ§Ù† Ø§Ø®ØªÙŠØ§Ø±ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚)
   - **Ø§Ù„Ø¨Ù†ÙŠØ© Ù…Ø¨Ø³Ø·Ø©**: ÙÙ‚Ø· Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (label, line1, city, coords, notes)

---

## ğŸ”„ Notes on Update

**Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**
1. âœ… ØªÙ… ØªØµØ­ÙŠØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ responses - Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ­Ø¯: `{ success, address/addresses, count?, message?, requestId }`
2. âœ… ØªÙ… ØªØ¨Ø³ÙŠØ· Ù†Ù…ÙˆØ°Ø¬ `Address` - Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Backend
3. âœ… ØªÙ… Ø¬Ø¹Ù„ `coords` Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ø§Ù„Ù€ create
4. âœ… ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ù€ delete response (result Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† data)
5. âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© error codes Ø§Ù„ÙØ¹Ù„ÙŠØ© (Cannot delete your only address, Address is not deleted)
6. âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø£ÙƒÙˆØ§Ø¯ Flutter Ù„ØªØ¹ÙƒØ³ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©

**Ù…Ù„ÙØ§Øª Backend Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©:**
- `backend/src/modules/addresses/addresses.controller.ts` - Ø¬Ù…ÙŠØ¹ endpoints
- `backend/src/modules/addresses/addresses.service.ts` - Ø§Ù„Ù…Ù†Ø·Ù‚ ÙˆØ§Ù„Ù€ validations
- `backend/src/modules/addresses/dto/address.dto.ts` - CreateAddressDto, UpdateAddressDto
- `backend/src/modules/addresses/schemas/address.schema.ts` - Address Schema

---

**Ø§Ù„ØªØ§Ù„ÙŠ:** [Ø®Ø¯Ù…Ø© Ø§Ù„Ø¨Ù†Ø±Ø§Øª (Banners)](./09-banners-service.md)

