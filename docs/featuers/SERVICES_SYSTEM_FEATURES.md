# مميزات نظام الخدمات والطلبات الشامل

## مقدمة عن النظام

نظام خدمات متقدم وشامل مصمم خصيصاً لمنصة خدمات الطاقة الشمسية يتيح للعملاء طلب خدمات المهندسين مع نظام عروض تنافسي وحساب المسافات التلقائي. النظام يدعم ثلاثة أدوار رئيسية: العملاء، المهندسون، والمشرفون مع إمكانيات متقدمة للتتبع والمراقبة.

## قسم الأدوار والصلاحيات

### نظام الأدوار المتعددة

#### 1. **دور العميل (Customer)**

**الصلاحيات:**
- صلاحية العميل محدودة بعمليات الطلب والمراجعة
- فصل واضح بين أدوار العميل والمهندس والمشرف
- نظام صلاحيات مرن وقابل للتخصيص حسب الحاجة

**المسؤوليات:**
- إنشاء طلبات الخدمة وتحديد التفاصيل المطلوبة
- مراجعة جميع العروض المقدمة من المهندسين
- قبول أو رفض العروض حسب الجودة والسعر المناسب
- تقييم الخدمات المكتملة بناءً على الجودة والاحترافية
- إلغاء الطلبات في المراحل المبكرة قبل التنفيذ

#### 2. **دور المهندس (Engineer)**
**المسؤوليات:**
- البحث عن الطلبات القريبة من موقعه
- تقديم عروض تنافسية للطلبات
- تعديل عروضه قبل القبول
- بدء وإنهاء العمل المكلف به
- مراجعة عروضه السابقة

#### 3. **دور المشرف (Admin)**
**المسؤوليات:**
- مراقبة جميع الطلبات والعروض
- إدارة حالات الطلبات يدوياً
- تعيين مهندسين لطلبات محددة
- إلغاء طلبات لأسباب إدارية
- مراجعة الإحصائيات والتقارير الشاملة

## قسم أنواع البيانات والحالات

### أنواع البيانات الرئيسية

#### 1. **طلب الخدمة (Service Request)**

**البيانات الأساسية:**
- معرف فريد للطلب ومعرف المستخدم الذي أنشأه
- عنوان وصفي ونوع الخدمة المطلوبة
- وصف مفصل للمشكلة أو المتطلبات
- صور مرفقة لتوضيح المشكلة

**الموقع والتوقيت:**
- ربط بعنوان محدد من نظام العناوين
- إحداثيات جغرافية دقيقة بتنسيق GeoJSON
- موعد محدد لتنفيذ الخدمة (اختياري)
- إمكانية جدولة الخدمة مسبقاً

**حالة الطلب:**
- تتبع حالة الطلب من الفتح حتى الإنجاز
- ربط بالمهندس المكلف بعد قبول العرض
- حفظ تفاصيل العرض المقبول

**التقييم:**
- نظام تقييم شامل من 1 إلى 5 نجوم
- تعليق نصي للتفاصيل والملاحظات
- تاريخ حفظ التقييم

**الملاحظات الإدارية:**
- إمكانية إضافة ملاحظات من قبل المشرفين
- تتبع تاريخ كل ملاحظة إدارية

**تواريخ النظام:**
- تاريخ إنشاء الطلب وآخر تحديث
- تتبع كامل لدورة حياة الطلب

#### 2. **عرض المهندس (Engineer Offer)**

**البيانات الأساسية:**
- معرف فريد للعرض وربطه بالطلب والمهندس
- تفاصيل العرض الأساسية مع السعر المقترح
- ملاحظات إضافية من المهندس

**الحسابات الجغرافية:**
- حساب تلقائي للمسافة بين موقع المهندس والطلب
- استخدام صيغة هافرساين لحساب دقيق للمسافات

**حالة العرض:**
- تتبع حالة العرض من التقديم حتى القبول أو الرفض
- إمكانية تعديل العرض قبل اتخاذ القرار

**تواريخ النظام:**
- تاريخ إنشاء العرض وآخر تحديث
- تتبع زمني كامل للعرض

## قسم حالات النظام

### حالات طلب الخدمة

| الحالة | الوصف | المسموح لـ |
|--------|-------|-----------|
| `OPEN` | طلب مفتوح جديد | العميل، المهندس، المشرف |
| `OFFERS_COLLECTING` | جمع العروض قيد التشغيل | العميل، المهندس، المشرف |
| `ASSIGNED` | تم تعيين مهندس | العميل، المهندس، المشرف |
| `IN_PROGRESS` | العمل قيد التنفيذ | العميل، المهندس، المشرف |
| `COMPLETED` | تم إنجاز العمل | العميل، المهندس، المشرف |
| `RATED` | تم التقييم | العميل، المهندس، المشرف |
| `CANCELLED` | تم إلغاء الطلب | العميل، المهندس، المشرف |

### حالات عرض المهندس

| الحالة | الوصف | المسموح لـ |
|--------|-------|-----------|
| `OFFERED` | عرض مقدم بانتظار الرد | المهندس، العميل، المشرف |
| `ACCEPTED` | تم قبول العرض | المهندس، العميل، المشرف |
| `REJECTED` | تم رفض العرض | المهندس، المشرف |
| `CANCELLED` | تم إلغاء العرض | المهندس، المشرف |

## قسم واجهات برمجة التطبيقات

### APIs حسب الأدوار

#### 1. **واجهات العميل (Customer APIs)**

**إنشاء طلب خدمة جديد:**
- إرسال طلب خدمة جديد مع التفاصيل الكاملة
- تحديد عنوان الطلب ونوع الخدمة والوصف المفصل
- ربط الطلب بعنوان محدد وموعد التنفيذ
- إمكانية إرفاق صور توضيحية للمشكلة

**مراجعة الطلبات:**
- عرض جميع طلبات الخدمة الخاصة بالعميل
- فلترة الطلبات حسب الحالة والتاريخ
- تفاصيل شاملة لكل طلب مقدم

**مراجعة العروض:**
- عرض جميع العروض المقدمة لطلب محدد
- مقارنة العروض حسب السعر والمسافة والتقييم
- تفاصيل كاملة لكل عرض مقدم من المهندسين

**قبول العروض:**
- قبول عرض محدد من المهندسين المتقدمين
- ربط المهندس بالطلب وتحديث الحالة
- إشعار فوري للمهندس المقبول

**إلغاء الطلبات:**
- إلغاء طلب خدمة في المراحل المبكرة
- إشعار جميع المهندسين الذين قدموا عروضاً
- حفظ سبب الإلغاء للمتابعة

**تقييم الخدمات:**
- تقييم الخدمة المكتملة بنجوم وتعليق
- مشاركة الخبرة مع المهندس والنظام
- مساعدة العملاء الآخرين في اتخاذ القرار

#### 2. **واجهات المهندس (Engineer APIs)**

**البحث عن الطلبات القريبة:**
- البحث عن طلبات خدمة قريبة من موقع المهندس الحالي
- تحديد نطاق البحث بالكيلومترات
- فلترة الطلبات حسب نوع الخدمة والحالة
- عرض المسافة المحسوبة لكل طلب

**تقديم العروض:**
- تقديم عرض سعر للطلبات المتاحة
- تحديد السعر والملاحظات الإضافية
- إرسال موقع المهندس الحالي لحساب المسافة
- إشعار فوري للعميل بتلقي العرض الجديد

**مراجعة العروض:**
- عرض جميع العروض المقدمة سابقاً من المهندس
- فلترة العروض حسب الحالة والتاريخ
- مراجعة تفاصيل كل عرض مقدم
- تتبع حالة كل عرض (مقبول، مرفوض، معلق)

**تعديل العروض:**
- تعديل العروض المقدمة قبل اتخاذ قرار العميل
- تحديث السعر أو الملاحظات
- إشعار العميل بالتغييرات في العرض
- حفظ تاريخ آخر تحديث للعرض

**بدء العمل:**
- إشعار نظامي ببدء تنفيذ الخدمة المكلفة
- تحديث حالة الطلب إلى قيد التنفيذ
- إشعار العميل ببدء العمل
- تتبع وقت البدء الفعلي للخدمة

**إنهاء العمل:**
- إشعار نظامي بإنجاز الخدمة بالكامل
- تحديث حالة الطلب إلى مكتمل
- إشعار العميل بإنجاز العمل
- طلب التقييم من العميل

#### 3. **واجهات المشرف (Admin APIs)**

**قائمة الطلبات الشاملة:**
- عرض جميع طلبات الخدمة في النظام
- فلترة متقدمة حسب الحالة ونوع الخدمة
- ترقيم النتائج لسهولة التصفح
- بحث سريع في قاعدة بيانات الطلبات

**تفاصيل الطلبات:**
- عرض تفاصيل كاملة لطلب خدمة محدد
- مراجعة التاريخ الكامل للطلب والتغييرات
- عرض جميع العروض المقدمة والمقبولة
- الوصول للملاحظات الإدارية والتعليقات

**مراجعة العروض:**
- عرض جميع العروض المقدمة لطلب محدد
- مقارنة شاملة بين العروض المختلفة
- مراجعة تفاصيل كل عرض مقدم
- تتبع حالة كل عرض على حدة

**تحديث حالة الطلبات:**
- تحديث حالة أي طلب يدوياً من قبل المشرف
- إضافة ملاحظات توضيحية للتغيير
- تتبع تاريخ وسبب كل تغيير في الحالة
- إشعار جميع الأطراف المعنية بالتغيير

**تعيين المهندسين:**
- تعيين مهندس محدد لطلب خدمة معين
- إضافة ملاحظات التعيين والأسباب
- إشعار فوري للمهندس بالتعيين الجديد
- تحديث حالة الطلب تلقائياً

**إلغاء الطلبات إدارياً:**
- إلغاء طلبات لأسباب إدارية مختلفة
- حفظ سبب مفصل للإلغاء
- إشعار جميع الأطراف المعنية
- حفظ السجل الكامل للإلغاء

**الإحصائيات الشاملة:**
- تقرير نظرة عامة شاملة للنظام
- إحصائيات مفصلة حسب الشهر والفترة الزمنية
- تحليل أداء النظام والمهندسين
- توقعات مستقبلية للطلبات والخدمات

## قسم نظام الحسابات والمسافات

### حساب المسافات التلقائي

#### 1. **صيغة هافرساين (Haversine Formula)**
- حساب دقيق للمسافة بين نقطتين على سطح الكرة الأرضية
- استخدام إحداثيات خط العرض وخط الطول للحساب الجغرافي
- دقة عالية في حساب المسافات بالكيلومترات
- أخذ انحناء الأرض في الاعتبار لحساب دقيق

**مثال عملي:**
- موقع طلب الخدمة: خط عرض 24.7136، خط طول 46.7382
- موقع المهندس: خط عرض 24.7200، خط طول 46.7400
- المسافة المحسوبة: 0.87 كيلومتر فقط
- دقة تصل إلى أجزاء من الكيلومتر

#### 2. **البحث بالقرب الجغرافي**
- البحث عن طلبات الخدمة في نطاق جغرافي محدد
- تحديد مركز البحث ونصف القطر بالكيلومترات
- ترتيب النتائج حسب القرب من موقع المهندس
- تحسين سرعة البحث باستخدام فهارس جغرافية متخصصة

**المزايا التقنية:**
- فهرسة جغرافية ثنائية الأبعاد للبحث السريع
- فلترة دقيقة حسب المسافة المحددة
- ترتيب تلقائي حسب القرب الجغرافي أولاً
- أداء محسن للبحث في قواعد البيانات الكبيرة

## قسم التقييم والمراجعة

### نظام التقييم الشامل

#### 1. **تقييم الخدمات**
- نظام تقييم شامل من 1 إلى 5 نجوم لكل خدمة مكتملة
- إمكانية إضافة تعليق نصي مفصل مع التقييم
- حفظ تاريخ التقييم للمراجعة والتحليل
- ربط التقييم بالمهندس والعميل والخدمة المحددة

#### 2. **إحصائيات المهندسين**
- إجمالي عدد المهندسين المسجلين في النظام
- حساب متوسط التقييم لكل مهندس من جميع الخدمات
- قياس معدل إنجاز الأعمال والمشاريع بنجاح
- حساب إجمالي الإيرادات المحققة من جميع الخدمات

#### 3. **إحصائيات العروض**
- إجمالي عدد العروض المقدمة في النظام
- نسبة العروض المقبولة من إجمالي العروض
- عدد العروض المعلقة في انتظار قرار العميل
- حساب إجمالي القيمة المالية لجميع العروض
- متوسط قيمة كل عرض مقدم في النظام

## قسم الإشعارات والتتبع

### نظام الإشعارات الذكي

#### 1. **أنواع الإشعارات**
- إشعار فتح طلب خدمة جديد في النظام
- إشعار تلقي عرض جديد على طلب خدمة
- إشعار قبول عرض مقدم من العميل
- إشعار رفض عرض مقدم من العميل
- إشعار بدء تنفيذ الخدمة المكلفة
- إشعار إنجاز الخدمة بالكامل
- إشعار تقييم الخدمة من العميل
- إشعار إلغاء طلب خدمة أو عرض

#### 2. **الإشعارات حسب الدور**

**للعملاء:**
- إشعار فوري بفتح طلب خدمة جديد في النظام
- إشعار بتلقي عرض جديد من مهندس على طلبهم
- إشعار بقبول عرضهم من قبل مهندس معين
- إشعار ببدء المهندس في تنفيذ الخدمة
- إشعار بإنجاز الخدمة بالكامل وطلب التقييم

**للمهندسين:**
- إشعار بطلبات خدمة جديدة قريبة من موقعهم الجغرافي
- إشعار بقبول عرضهم من قبل العميل
- إشعار ببدء العمل المكلف بهم رسمياً

**للمشرفين:**
- إشعار بطلبات خدمة جديدة تحتاج مراجعة إدارية
- إشعار بحالات استثنائية تحتاج تدخل إداري فوري

## قسم التقارير والإحصائيات

### التقارير الإدارية الشاملة

#### 1. **تقرير نظرة عامة**
- تقرير شامل يوضح الحالة العامة للنظام
- إحصائيات تفصيلية للطلبات حسب حالة كل منها
- نظرة على إجمالي العروض والمقبولة منها
- حساب متوسط وقت الاستجابة للطلبات الجديدة
- تحليل أكثر أنواع الخدمات طلباً وشعبية
- ترتيب المهندسين حسب الأعلى تقييماً وأداءً

#### 2. **تقرير الطلبات بالتفصيل**
- تحليل مفصل لتوزيع الطلبات عبر الزمن
- تجميع الطلبات حسب الشهر أو الأسبوع أو اليوم
- مقارنة مع الفترات الزمنية السابقة
- تحليل الاتجاهات الموسمية والدورية
- توقعات مستقبلية لأنماط الطلبات
- تحليل التغييرات والتطورات في السوق

#### 3. **تقرير أداء المهندسين**
- تقييم شامل لأداء كل مهندس في النظام
- حساب متوسط التقييم من جميع الخدمات المكتملة
- قياس معدل إنجاز الأعمال والمشاريع بنجاح
- حساب إجمالي الإيرادات المحققة من الخدمات
- إحصائيات مفصلة لعدد الطلبات المكتملة والمعدلات

## قسم الأمان والحماية

### الحماية متعددة الطبقات

#### 1. **حماية المصادقة**
- **JWT Authentication**: تشفير وحماية شاملة للجلسات
- **Role-based Access Control**: صلاحيات محددة لكل دور
- **Permission Guards**: حراسة دقيقة للوصول للموارد

#### 2. **حماية البيانات**
- **Input Validation**: التحقق من صحة جميع البيانات المدخلة
- **Sanitization**: تنظيف البيانات من الرموز الضارة
- **Rate Limiting**: تحديد معدل الطلبات لمنع الإساءة

#### 3. **حماية الموقع**
- **Geolocation Security**: التحقق من صحة المواقع المرسلة
- **Distance Validation**: التحقق من منطقية المسافات المحسوبة
- **IP Tracking**: تتبع محاولات الوصول المشبوهة

## قسم قابلية التوسع والمرونة

### تصميم مرن وقابل للتوسع

#### 1. **إضافة أنواع خدمات جديدة**
- إمكانية إضافة أنواع خدمات جديدة بسهولة
- تحديد فئة الخدمة والمدة المتوقعة
- تحديد المهارات المطلوبة لكل نوع خدمة
- تخصيص قواعد التعامل مع كل نوع خدمة

#### 2. **تخصيص خوارزميات الترتيب**
- ترتيب العروض حسب المسافة (الأقرب أولاً)
- ترتيب حسب السعر (الأرخص أولاً)
- ترتيب حسب التقييم (الأعلى تقييماً أولاً)
- ترتيب حسب الخبرة (الأكثر خبرة أولاً)

#### 3. **تكامل مع أنظمة خارجية**
- **نظام المستخدمين**: ربط مع ملفات المستخدمين الموجودة
- **نظام العناوين**: استخدام نظام العناوين الموحد
- **نظام التقييمات**: تكامل مع نظام التقييم العام
- **نظام الإشعارات**: إرسال إشعارات فورية للأطراف المعنية

## قسم البيئات والاختبار

### دعم جميع البيئات

#### 1. **البيئة التطويرية**
- **التسجيل المفصل**: سجلات شاملة للتتبع والتشخيص
- **اختبار سهل**: إمكانية اختبار جميع السيناريوهات
- **مرونة في البيانات**: قبول بيانات اختبار متنوعة

#### 2. **البيئة الإنتاجية**
- **الأداء المحسن**: استعلامات محسّنة وفهارس فعالة
- **التخزين المؤقت**: تسريع الاستجابة مع Redis
- **المراقبة المستمرة**: تتبع الأداء والأخطاء في الوقت الفعلي

## الخلاصة

نظام الخدمات هذا يوفر **حلول متكاملة ومتقدمة** لإدارة طلبات الخدمات بين العملاء والمهندسين مع نظام عروض تنافسي وحساب مسافات دقيق.

### نقاط القوة:
- ✅ **ثلاثة أدوار محددة** مع صلاحيات واضحة ومفصولة
- ✅ **حساب مسافات دقيق** باستخدام صيغة هافرساين المتقدمة
- ✅ **نظام عروض تنافسي** مع ترتيب ذكي حسب المسافة والسعر
- ✅ **تتبع شامل** لجميع مراحل الطلب من الفتح للتقييم
- ✅ **تقارير إدارية مفصلة** مع إحصائيات شاملة
- ✅ **حماية أمنية متقدمة** مع تشفير ورصد للتهديدات
- ✅ **قابلية التوسع** والتكيف مع احتياجات جديدة

### المميزات التقنية:
- 🗺️ **حساب مسافات دقيق** باستخدام إحداثيات GPS
- 📊 **إحصائيات شاملة** للأداء والكفاءة
- 🔔 **إشعارات ذكية** حسب الدور والحدث
- 🔒 **حماية متقدمة** من الهجمات والإساءة
- 📈 **مراقبة مستمرة** للأداء والجودة
- 🔧 **مرونة في التخصيص** والتطوير المستقبلي

هذا النظام يضمن **تجربة سلسة وفعالة** لجميع الأطراف المعنية مع **إدارة ذكية ومتقدمة** لعمليات طلب وتقديم الخدمات في مجال الطاقة الشمسية.
