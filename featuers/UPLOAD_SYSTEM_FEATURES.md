# مميزات نظام الرفع والوسائط الشامل

## مقدمة عن النظام

نظام رفع وإدارة الوسائط المتقدم مع تكامل كامل مع خدمة Bunny.net Storage Zone لتخزين الملفات بطريقة آمنة وقابلة للتوسع. النظام يدعم رفع الملفات الفردية والمتعددة مع إمكانيات متقدمة للتحقق من صحة الملفات، إدارة الملفات، والتنظيف التلقائي.

## قسم التكامل مع Bunny.net

### خدمة التخزين السحابي

#### 1. **إعداد Bunny.net Storage**
متغيرات البيئة المطلوبة للتكامل مع خدمة Bunny.net للتخزين السحابي:
- اسم منطقة التخزين (Storage Zone) المُنشأة في حساب Bunny.net
- مفتاح API الخاص بحساب Bunny.net للوصول البرمجي
- اسم المضيف الأساسي لخدمة التخزين
- اسم المضيف لشبكة توزيع المحتوى (CDN) لتحسين الأداء

#### 2. **خطوات الإعداد**
خطوات إعداد خدمة Bunny.net للتخزين السحابي:
1. إنشاء حساب جديد على موقع Bunny.net الرسمي
2. إنشاء منطقة تخزين (Storage Zone) جديدة في لوحة التحكم
3. الحصول على مفتاح API من إعدادات الحساب في لوحة التحكم
4. إعداد شبكة توزيع المحتوى (CDN) بشكل اختياري لتحسين سرعة التوزيع العالمي

## قسم أنواع البيانات والحقول

### بنية بيانات الوسائط

#### 1. **نموذج الوسائط (Media Schema)**

**البيانات الأساسية:**
- معرف فريد لكل وسائط في النظام
- رابط عام للوصول للوسائط من خلال الشبكة
- اسم الملف الأصلي كما تم رفعه من المستخدم
- اسم الملف بعد تخزينه في خدمة Bunny.net
- اسم وصفي للوسائط لسهولة التعرف عليها

**التصنيف والنوع:**
- فئة الوسائط (بانرات، منتجات، فئات، براندات، أخرى)
- نوع الملف (صورة، فيديو، مستند، أو أنواع أخرى)
- نوع MIME للملف لتحديد تنسيقه بدقة

**أبعاد وحجم الملف:**
- حجم الملف بالبايت لحساب مساحة التخزين
- أبعاد الصورة بالبكسل (العرض والارتفاع) للصور فقط
- قيمة hash فريدة للملف للكشف عن التكرار

**البيانات الوصفية:**
- وصف اختياري مفصل للوسائط
- وسوم متعددة للبحث والتصنيف السهل

**معلومات المستخدم:**
- معرف المستخدم الذي قام برفع الملف
- تتبع المسؤولية عن كل وسائط

**التتبع والاستخدام:**
- عدد مرات استخدام الوسائط في النظام
- قائمة بالمعرفات التي تستخدم هذه الوسائط

**إعدادات الخصوصية:**
- تحديد ما إذا كانت الوسائط عامة أم خاصة
- التحكم في إمكانية الوصول للوسائط

**الحذف الناعم (Soft Delete):**
- تاريخ الحذف الناعم للوسائط المحذوفة
- معرف المستخدم الذي قام بعملية الحذف

**تواريخ النظام:**
- تاريخ إنشاء سجل الوسائط
- تاريخ آخر تحديث للبيانات

#### 2. **فئات الوسائط (Media Categories)**
| الفئة | الوصف | أمثلة الاستخدام |
|-------|-------|-----------------|
| `banner` | بانرات وصور الترويج | الصفحة الرئيسية، الحملات الإعلانية |
| `product` | صور المنتجات | صور المنتجات في المتجر |
| `category` | صور الفئات | أيقونات وصور فئات المنتجات |
| `brand` | صور البراندات | شعارات ولوقو البراندات |
| `other` | أنواع أخرى | صور متنوعة أخرى |

#### 3. **أنواع الملفات المدعومة**
| نوع الملف | أنواع MIME المدعومة |
|-----------|---------------------|
| **الصور** | `image/jpeg`, `image/png`, `image/gif`, `image/webp` |
| **المستندات** | `application/pdf`, `application/msword`, `application/vnd.openxmlformats-officedocument.wordprocessingml.document` |

## قسم واجهات برمجة التطبيقات

### APIs المتاحة والمفصلة

#### 1. **رفع ملف واحد**
- رفع ملف واحد مع إمكانية تحديد المجلد والاسم المخصص
- دعم جميع أنواع الملفات المسموحة (صور، مستندات)
- إمكانية تحديد مجلد التخزين اختيارياً
- إمكانية تخصيص اسم الملف بدلاً من الاسم الأصلي

**الاستجابة:**
- حالة نجاح العملية (true/false)
- بيانات الملف المرفوع مع الرابط والمعلومات
- رابط عام للوصول للملف من خلال CDN
- اسم الملف المخزن وحجمه ونوعه

#### 2. **رفع ملفات متعددة**
- رفع عدة ملفات في طلب واحد (حد أقصى 10 ملفات)
- دعم نفس خيارات الرفع الفردي
- إمكانية تحديد مجلد مشترك لجميع الملفات
- معالجة كل ملف بشكل مستقل مع سجل نجاح/فشل

**الاستجابة:**
- حالة نجاح العملية لجميع الملفات
- قائمة ببيانات كل ملف مرفوع على حدة
- روابط عامة للوصول للملفات من خلال CDN
- معلومات شاملة لكل ملف (الاسم، الحجم، النوع)

#### 3. **حذف ملف**
- حذف ملف محدد من التخزين السحابي
- تحديد مسار الملف المطلوب حذفه
- حذف ناعم في قاعدة البيانات مع حذف فعلي من Bunny.net
- إشعار فوري بنتيجة عملية الحذف

#### 4. **الحصول على معلومات الملف**
- استرجاع معلومات مفصلة عن ملف محدد
- التحقق من وجود الملف في التخزين
- عرض حجم الملف وتاريخ آخر تعديل
- تحديد نوع محتوى الملف بدقة

**الاستجابة:**
- حالة نجاح العملية مع تأكيد وجود الملف
- حجم الملف بالبايت وتاريخ آخر تعديل
- نوع محتوى الملف (MIME type)
- معلومات إضافية عن حالة الملف

#### 5. **واجهات إدارة الوسائط**
- إنشاء سجل وسائط جديد في قاعدة البيانات
- تحديد الاسم والفئة والوصف والوسوم
- ضبط إعدادات الخصوصية (عام/خاص)

**قائمة الوسائط مع فلترة:**
- عرض قائمة بالوسائط مع إمكانية الفلترة
- تحديد الفئة والصفحة وعدد النتائج
- ترتيب النتائج حسب التاريخ أو الاستخدام

**تحديث معلومات الوسائط:**
- تعديل معلومات الوسائط الموجودة
- تحديث الاسم والوسوم والمعلومات
- حفظ تاريخ آخر تحديث

**حذف وسائط (ناعم):**
- حذف ناعم للوسائط من قاعدة البيانات
- الاحتفاظ بالملف في التخزين لفترة مؤقتة
- إمكانية استعادة الوسائط المحذوفة

**البحث في الوسائط:**
- بحث متقدم في جميع الوسائط المتاحة
- البحث بالنص في الأسماء والأوصاف والوسوم
- فلترة حسب الفئة ونوع الوسائط

## قسم التحقق من صحة الملفات

### آليات التحقق والأمان

#### 1. **قيود الملفات**
- حد أقصى لحجم كل ملف فردي: 10 ميجابايت
- حد أقصى لعدد الملفات في الرفع المتعدد: 10 ملفات
- أنواع الملفات المسموحة مقسمة حسب الفئات

**أنواع الملفات المسموحة:**
- الصور: JPEG، PNG، GIF، WebP
- المستندات: PDF، Microsoft Word، مستندات Word المحدثة

#### 2. **التحقق من صحة الملفات**
- فحص شامل لحجم الملف والتأكد من عدم تجاوز الحد المسموح
- التحقق من نوع الملف ومطابقته للأنواع المسموحة
- فحص محتوى الملف والتأكد من عدم كونه فارغاً

**خطوات التحقق:**
- قياس حجم الملف بالبايت ومقارنته بالحد الأقصى (10MB)
- فحص نوع MIME للملف والتأكد من وجوده في القائمة المسموحة
- التحقق من وجود محتوى فعلي في الملف وعدم كونه فارغاً
- رفض الملفات التي لا تستوفي أي من الشروط مع رسالة خطأ واضحة

## قسم إدارة الملفات والوسائط

### إدارة شاملة للملفات

#### 1. **توليد أسماء الملفات الفريدة**
- توليد أسماء فريدة للملفات لتجنب التداخل والكتابة فوق الملفات الموجودة
- استخراج امتداد الملف من الاسم الأصلي
- استخدام اسم مخصص إذا تم توفيره، أو استخدام الاسم الأصلي بدون الامتداد
- إضافة معرف فريد (UUID) لضمان عدم وجود ملفين بنفس الاسم

**مثال عملي:**
- الاسم الأصلي: "product-image.jpg"
- الاسم المخصص: "main-product"
- النتيجة: "معرف-فريد-main-product.jpg"
- ضمان عدم وجود تداخل في أسماء الملفات

#### 2. **تنظيم المجلدات**
- تنظيم الملفات في مجلدات متخصصة حسب الفئة والنوع
- فصل واضح بين أنواع الملفات المختلفة
- تسهيل عملية البحث والإدارة للملفات

**هيكل المجلدات:**
- مجلد المنتجات: لصور وملفات المنتجات
- مجلد الفئات: لصور فئات المنتجات وأيقوناتها
- مجلد البراندات: لشعارات ولوقو البراندات
- مجلد البانرات: لصور الترويج والإعلانات
- مجلد المستندات: للملفات النصية والوثائق
- مجلد المؤقت: للملفات المؤقتة والمسودات
- مجلد أخرى: للملفات التي لا تندرج تحت الفئات المحددة

**عملية الرفع:**
- تحديد المجلد المناسب حسب نوع الملف أو الفئة
- رفع الملف في المجلد المحدد في خدمة التخزين
- حفظ مسار الملف الكامل للرجوع إليه لاحقاً

## قسم الأمان والحماية

### حماية شاملة للنظام

#### 1. **حماية المصادقة**
- نظام مصادقة متقدم باستخدام رموز JWT للجلسات الآمنة
- التحكم في الوصول بناءً على الأدوار (Role-based Access Control)
- حماية مفاتيح API الخاصة بخدمة Bunny.net من الوصول غير المصرح به

#### 2. **حماية الملفات**
- التحقق الدقيق من أنواع الملفات المسموح برفعها فقط
- تحديد حدود صارمة لحجم الملفات المقبولة
- فحص شامل للملفات بحثاً عن البرمجيات الضارة والفيروسات
- منع رفع المحتوى الذي قد يحتوي على رموز ضارة أو محتوى غير آمن

#### 3. **تسجيل العمليات**
- تسجيل مفصل لجميع عمليات رفع وحذف الملفات
- حفظ معلومات شاملة عن كل عملية (النوع، اسم الملف، الحجم، نوع المحتوى، معرف المستخدم)
- ربط كل عملية بتاريخ ووقت دقيق للمراجعة والتتبع
- حفظ السجلات لفترة محددة لأغراض الأمان والمراجعة

## قسم الأداء والتحسين

### تحسينات الأداء والسرعة

#### 1. **تكامل CDN**
- استخدام شبكة توزيع المحتوى لتسريع تحميل الملفات عالمياً
- توليد روابط عامة مختصرة للملفات من خلال CDN
- خيار التبديل بين استخدام CDN أو الوصول المباشر للتخزين
- تحسين تجربة المستخدم من خلال تقليل زمن الاستجابة

**مزايا استخدام CDN:**
- تسريع كبير في تحميل الملفات للمستخدمين حول العالم
- تقليل الحمل والضغط على الخادم الرئيسي
- توفر عالي وموثوقية في التوزيع العالمي للملفات
- تقليل استهلاك النطاق الترددي للخادم الأساسي

#### 2. **التخزين المؤقت والضغط**
- ضغط تلقائي للصور لتقليل حجم الملف مع الحفاظ على الجودة
- تحسين جودة الصور حسب نوع الملف والاستخدام المقصود
- تقليل حجم الملفات لتوفير مساحة التخزين وزيادة سرعة التحميل

**مزايا الضغط:**
- تقليل حجم الملفات بنسبة تصل إلى 70% حسب نوع الصورة
- الحفاظ على جودة مقبولة للعرض والاستخدام
- تحسين سرعة تحميل الصفحات والتطبيقات
- توفير في تكاليف التخزين والنطاق الترددي

**التخزين المؤقت:**
- تخزين مؤقت لروابط الملفات لتقليل طلبات API
- تحديد فترة صلاحية للتخزين المؤقت (عادة ساعة واحدة)
- تقليل العبء على قاعدة البيانات والخادم
- تحسين الأداء العام للنظام

## قسم التنظيف والصيانة

### آليات التنظيف التلقائي

#### 1. **تنظيف الملفات المحذوفة**
- عملية حذف نهائي للملفات التي تم حذفها ناعماً من قاعدة البيانات
- البحث التلقائي عن الملفات المؤهلة للحذف النهائي
- حذف الملفات من خدمة Bunny.net Storage بالتزامن مع قاعدة البيانات
- إزالة السجلات من قاعدة البيانات بعد التأكد من حذف الملفات

**خطوات التنظيف:**
- البحث عن الملفات التي تحمل علامة "محذوف ناعماً"
- حذف الملف الفعلي من خدمة التخزين السحابي
- إزالة السجل من قاعدة البيانات نهائياً
- تحرير مساحة التخزين وتحسين الأداء

#### 2. **تنظيف الملفات المكررة**
- البحث عن الملفات المكررة في نظام التخزين
- حساب قيمة hash فريدة لكل ملف للكشف عن التكرار
- تحديد الملفات المكررة والاحتفاظ بالنسخة الأحدث فقط
- حذف النسخ المكررة من التخزين وقاعدة البيانات

**خطوات الكشف عن التكرار:**
- حساب hash لكل ملف مخزن في النظام
- مقارنة قيم الهاش للعثور على الملفات المتطابقة
- الاحتفاظ بالنسخة الأحدث من كل ملف مكرر
- حذف جميع النسخ الأخرى المكررة

#### 3. **تنظيف الملفات غير المستخدمة**
- البحث عن الملفات التي لم تستخدم لفترة زمنية محددة
- التحقق من عدم وجود أي مراجع للملف في قاعدة البيانات
- حذف الملفات غير المستخدمة من التخزين والسجلات
- تحرير مساحة التخزين وتحسين كفاءة النظام

**خطوات التنظيف:**
- تحديد الفترة الزمنية (مثل 90 يوماً) لعدم الاستخدام
- البحث عن الملفات التي لم يتم الوصول إليها خلال هذه الفترة
- التحقق من عدم وجود مراجع في جداول قاعدة البيانات
- حذف الملفات غير المستخدمة نهائياً

## قسم البحث والتصفح

### إمكانيات البحث المتقدمة

#### 1. **البحث في الوسائط**
- بحث متقدم بالنص الكامل في أسماء وأوصاف الوسائط
- فلترة النتائج حسب الفئة والحالة (عام/خاص)
- ترتيب النتائج حسب معايير مختلفة

**خيارات البحث المتقدم:**
- البحث بالنص الكامل في الأسماء والأوصاف والوسوم
- فلترة حسب فئة الوسائط (منتجات، فئات، براندات، إلخ)
- ترقيم النتائج لسهولة التصفح
- تحديد عدد النتائج في كل صفحة

**خيارات الترتيب:**
- ترتيب حسب تاريخ الإنشاء (الأحدث أولاً)
- ترتيب حسب عدد مرات الاستخدام (الأكثر استخداماً أولاً)
- ترتيب تصاعدي أو تنازلي حسب الحاجة

#### 2. **فهارس البحث المحسنة**
- إنشاء فهارس متخصصة لتحسين أداء عمليات البحث
- فهرسة مركبة للبحث حسب الفئة والتاريخ
- فهرسة نصية للبحث في الأسماء والأوصاف والوسوم
- فهرسة خاصة لقيم الهاش للكشف عن التكرار
- فهرسة حسب المستخدم الذي رفع الملف والتاريخ

**مزايا الفهارس:**
- تسريع عمليات البحث والفلترة بشكل كبير
- تحسين أداء قاعدة البيانات في الاستعلامات المعقدة
- تقليل زمن الاستجابة لعمليات البحث المتقدمة
- دعم البحث النصي الكامل في عدة حقول متزامنة

## قسم التكامل والاستخدام

### تكامل مع الأنظمة الأخرى

#### 1. **تكامل مع نظام المنتجات**
- رفع صور المنتجات تلقائياً عند إنشاء أو تحديث منتج
- معالجة متعددة لعدة صور في نفس الوقت
- حفظ مراجع الصور في سجل المنتج بعد الرفع
- ربط تلقائي بين المنتج والصور المرفوعة

**خطوات التكامل:**
- استقبال معرف المنتج وقائمة الصور المطلوب رفعها
- رفع كل صورة على حدة في مجلد المنتجات
- انتظار اكتمال جميع عمليات الرفع
- تحديث سجل المنتج بروابط الصور المرفوعة

#### 2. **تكامل مع نظام المستخدمين**
- تتبع شامل لنشاط رفع الملفات لكل مستخدم
- تسجيل مفصل لكل عملية رفع وحذف
- إرسال إشعارات للمشرفين عند الحاجة
- مراقبة استخدام مساحة التخزين لكل مستخدم

**خطوات التتبع:**
- حفظ معرف المستخدم مع كل ملف مرفوع
- تسجيل التاريخ والوقت لكل عملية
- مراقبة حدود الاستخدام لكل مستخدم
- إرسال تنبيهات عند تجاوز الحدود المسموحة

## قسم الأمان المتقدم

### حماية متقدمة للملفات

#### 1. **الحماية من الهجمات**
- حماية شاملة من هجمات حقن قواعد البيانات (SQL Injection)
- حماية من هجمات البرمجة عبر المواقع (Cross-Site Scripting)
- حماية من هجمات تزوير الطلبات (CSRF)
- تحديد معدل الطلبات لمنع محاولات الإساءة والإغراق

#### 2. **التحقق من الهوية**
- التحقق من صحة المستخدم ووجوده في النظام
- التحقق من امتلاك المستخدم للصلاحيات المطلوبة للعملية
- رفض الطلبات من المستخدمين غير المصرح لهم
- حماية من محاولات الوصول غير المصرح به

**خطوات التحقق:**
- التأكد من وجود المستخدم وصحة جلسته
- فحص دور المستخدم وصلاحياته للعملية المطلوبة
- رفض الطلب برسالة خطأ واضحة في حال عدم الصلاحية
- تسجيل محاولات الوصول غير المصرح به للمراجعة

#### 3. **مراقبة العمليات الحساسة**
- مراقبة دقيقة لعمليات الحذف والتعديل المهمة
- تسجيل مفصل للعمليات الحساسة مع جميع التفاصيل
- إرسال إشعارات فورية للمشرفين عند الحاجة
- حفظ سجل كامل للمراجعة والتدقيق الأمني

**خطوات المراقبة:**
- تحديد العمليات الحساسة (حذف، تعديل، رفع ملفات كبيرة)
- تسجيل جميع التفاصيل المهمة للعملية
- حفظ التاريخ والوقت بدقة لكل عملية
- إرسال تنبيهات أمنية عند اكتشاف أنشطة مشبوهة

## قسم البيئات والاختبار

### دعم جميع البيئات

#### 1. **البيئة التطويرية**
- **التسجيل المفصل**: سجلات شاملة للتتبع والتشخيص
- **اختبار سهل**: إمكانية اختبار جميع السيناريوهات
- **مرونة في البيانات**: قبول ملفات اختبار متنوعة

#### 2. **البيئة الإنتاجية**
- **الأداء المحسن**: استعلامات محسّنة وفهارس فعالة
- **التخزين المؤقت**: تسريع الاستجابة مع Redis
- **المراقبة المستمرة**: تتبع الأداء والأخطاء في الوقت الفعلي

## الخلاصة

نظام الرفع والوسائط هذا يوفر **حلول تخزين متقدمة وآمنة** مع تكامل كامل مع Bunny.net Storage Zone وإمكانيات إدارة شاملة للملفات.

### نقاط القوة:
- ✅ **تكامل كامل مع Bunny.net** للتخزين السحابي الآمن
- ✅ **رفع ملفات فردية ومتعددة** مع تحقق شامل من الصحة
- ✅ **إدارة وسائط متقدمة** مع تصنيف وتتبع للاستخدام
- ✅ **نظام أمان متعدد الطبقات** مع تشفير وحماية شاملة
- ✅ **أدوات تنظيف تلقائية** للملفات غير المستخدمة والمكررة
- ✅ **تكامل CDN** لتسريع التوزيع العالمي
- ✅ **قابلية التوسع** والتكيف مع احتياجات جديدة

### المميزات التقنية:
- 🗄️ **تخزين سحابي آمن** مع Bunny.net Storage Zone
- 📁 **إدارة مجلدات ذكية** مع تنظيم تلقائي حسب الفئات
- 🔒 **أمان متقدم** مع تشفير وحماية من الهجمات
- 🚀 **أداء محسن** مع CDN وتخزين مؤقت
- 🧹 **تنظيف تلقائي** للملفات غير المستخدمة
- 📊 **تتبع شامل** للاستخدام والأداء
- 🔍 **بحث متقدم** مع فلترة وترتيب ذكي
- 🔧 **مرونة في التخصيص** والتطوير المستقبلي

هذا النظام يضمن **تخزين آمن وفعال** لجميع أنواع الوسائط مع **إدارة ذكية ومتقدمة** و **أداء عالي** في منصة خدمات الطاقة الشمسية.
